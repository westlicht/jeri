{"version":3,"sources":["webpack://Jeri/webpack/universalModuleDefinition","webpack://Jeri/webpack/bootstrap","webpack://Jeri/external {\"root\":\"React\",\"commonjs2\":\"react\",\"commonjs\":\"react\",\"amd\":\"react\",\"umd\":\"react\"}","webpack://Jeri/./src/utils/linalg.ts","webpack://Jeri/../src/models/StyleTags.js","webpack://Jeri/../src/models/ThemeProvider.js","webpack://Jeri/../src/models/GlobalStyle.js","webpack://Jeri/./src/layers/Layer.ts","webpack://Jeri/./node_modules/react-is/index.js","webpack://Jeri/./src/utils/image-loading.ts","webpack://Jeri/external {\"root\":\"ReactDOM\",\"commonjs2\":\"react-dom\",\"commonjs\":\"react-dom\",\"amd\":\"react-dom\",\"umd\":\"react-dom\"}","webpack://Jeri/./node_modules/stylis/stylis.js","webpack://Jeri/./node_modules/memoize-one/dist/memoize-one.esm.js","webpack://Jeri/./src/components/ImageFrame.tsx","webpack://Jeri/./src/layers/ImageLayer.ts","webpack://Jeri/./src/layers/TextLayer.ts","webpack://Jeri/./src/layers/MouseLayer.ts","webpack://Jeri/./node_modules/stylis-rule-sheet/index.js","webpack://Jeri/./node_modules/@emotion/unitless/dist/unitless.browser.esm.js","webpack://Jeri/./node_modules/@emotion/memoize/dist/memoize.browser.esm.js","webpack://Jeri/./node_modules/@emotion/is-prop-valid/dist/is-prop-valid.browser.esm.js","webpack://Jeri/./src/jeri.tsx","webpack://Jeri/./build_npm/utils/exr-parser.worker.js","webpack://Jeri/./node_modules/normalize-wheel/index.js","webpack://Jeri/./node_modules/normalize-wheel/src/normalizeWheel.js","webpack://Jeri/./node_modules/normalize-wheel/src/UserAgent_DEPRECATED.js","webpack://Jeri/./node_modules/normalize-wheel/src/isEventSupported.js","webpack://Jeri/./node_modules/normalize-wheel/src/ExecutionEnvironment.js","webpack://Jeri/./node_modules/process/browser.js","webpack://Jeri/./node_modules/react-is/cjs/react-is.production.min.js","webpack://Jeri/./node_modules/prop-types/index.js","webpack://Jeri/./node_modules/prop-types/factoryWithThrowingShims.js","webpack://Jeri/./node_modules/prop-types/lib/ReactPropTypesSecret.js","webpack://Jeri/./src/components/ImageViewer/index.tsx","webpack://Jeri/./src/utils/number-aware-compare.ts","webpack://Jeri/./src/utils/fullscreen.ts","webpack://Jeri/./src/components/ImageViewer/HelpScreen.tsx","webpack://Jeri/./src/components/ImageFrameWithLoading.tsx","webpack://Jeri/./src/components/ImageViewer/navigation.tsx","webpack://Jeri/./node_modules/common-prefix/index.js"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__6__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","IDENTITY4x4","Float32Array","Matrix4x4","buffer","this","data","fromScaling","matrix","scaling","length","Error","forEach","scale","multiply","output","a","b","j","k","translate","translation","clone","invert","determinant","inverseDeterminant","Vector4","set","x","y","z","w","fromValues","vector","transformMat4","v","makeTextMarker","id","__VERSION__","ThemeContext","react__WEBPACK_IMPORTED_MODULE_2__","componentId","LossFunction","linalg_1","Layer","canvas","image","transformation","aspectMatrixBuffer","viewMatrixBuffer","resize","width","Math","floor","clientWidth","devicePixelRatio","height","clientHeight","getAspect","viewAspect","textAspect","getViewMatrix","aspect","lossFunctions","L1","L2","MAPE","MRSE","SMAPE","SSIM","lossFunctionFromString","keys","ExrParserWorker","pool","ExrParserPool","nWorkers","nextWorkerId","jobId","returnHandlers","workers","worker","push","onmessage","handleResult","parse","url","_this","Promise","resolve","reject","nextWorker","event","success","__assign","message","postMessage","callback","loadImage","suffix","split","pop","toLocaleLowerCase","loadExr","loadLdr","console","time","fetch","then","result","timeEnd","arrayBuffer","parseExr","Image","src","crossOrigin","onerror","error","onload","document","createElement","ctx","getContext","drawImage","nChannels","type","pixelColorCache","Map","getPixelColor","getColorFnc","ctx_1","X","Y","C","getImageData","ImageCache","images","downloading","contains","currentlyDownloading","size","load","store","imagePromise","options","nullptn","formatptn","colonptn","cursorptn","transformptn","animationptn","propertiesptn","elementptn","selectorptn","andptn","escapeptn","invalidptn","keyframeptn","plcholdrptn","readonlyptn","beforeptn","afterptn","tailptn","whiteptn","pseudoptn","writingptn","supportsptn","propertyptn","selfptn","pseudofmt","dimensionptn","imgsrcptn","webkit","moz","ms","SEMICOLON","CLOSEBRACES","OPENBRACES","OPENPARENTHESES","CLOSEPARENTHESES","OPENBRACKET","CLOSEBRACKET","NEWLINE","CARRIAGE","TAB","AT","SPACE","AND","DASH","UNDERSCORE","STAR","COMMA","COLON","SINGLEQUOTE","DOUBLEQUOTE","FOWARDSLASH","GREATERTHAN","PLUS","TILDE","NULL","FORMFEED","VERTICALTAB","KEYFRAME","MEDIA","SUPPORTS","PLACEHOLDER","READONLY","IMPORT","CHARSET","DOCUMENT","PAGE","column","line","pattern","cascade","prefix","escape","compress","semicolon","preserve","array","plugins","plugged","should","POSTS","PREPS","UNKWN","PROPS","BLCKS","ATRUL","unkwn","keyed","nscopealt","nscope","compile","parent","current","body","depth","selector","bracket","comment","parentheses","quote","first","second","code","tail","trail","peak","counter","context","atrule","pseudo","caret","format","insert","eof","eol","char","chars","child","out","children","flat","charCodeAt","replace","trim","charAt","delimited","substring","select","proxy","join","supports","vendor","padding","element","Array","elements","indexOf","selectors","scope","level","input","third","cache","index","hash","declare","list","items","isNaN","parseFloat","test","content","match","group","parents","at","next","stylis","constructor","use","plugin","simpleIsEqual","__webpack_exports__","resultFn","isEqual","lastThis","lastResult","lastArgs","calledOnce","isNewArgEqualToLast","newArg","_len","arguments","newArgs","_key","every","apply","React","ImageLayer_1","TextLayer_1","MouseLayer_1","styled_components_1","StretchingCanvas","default","templateObject_1","__makeTemplateObject","StretchingDiv","div","templateObject_2","ImageFrame","_super","props","defaultTransformation","handleTransformationChange","__extends","componentDidMount","imageLayer","imageLayerElement","textLayer","textLayerElement","mouseLayer","mouseLayerElement","enableMouseEvents","clearColor","setClearColor","onTransformationChange","updateCanvasProps","componentDidUpdate","prevProps","setEnableMouseEvents","componentWillUnmount","onPointAt","undefined","destruct","setDefaultTransformation","reset","setTransformation","getTransformation","render","ref","allowMovement","onTransform","previousProps","viewTransform","exposure","gamma","offset","setTonemapping","setImage","onPoint","Component","DrawMode","ViewTransform","Layer_1","fragmentShaderSource","None","Gamma22","K1S1","LDR","HDR","imageVertices","colorMapTexels","Uint8Array","compileShader","gl","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","defaultTonemapping","ImageLayer","tonemappingSettings","needsRerender","textures","checkRender","invalidate","getTexture","initWebGl","requestAnimationFrame","tonemapping","color","draw","cmapTexture","viewport","drawingBufferWidth","drawingBufferHeight","uniform1i","glUniforms","uniform1f","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","bindBuffer","ARRAY_BUFFER","quadVertexBuffer","vertexAttribPointer","glAttributes","vertexPosition","FLOAT","BYTES_PER_ELEMENT","vertexTextureCoordinate","imageHeight","imageWidth","drawMode","ColorMap","lossFunction","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","imageA","imASampler","TEXTURE1","imageB","imBSampler","TEXTURE2","cmapSampler","viewMatrix","uniformMatrix4fv","drawArrays","TRIANGLE_STRIP","getExtension","enable","DEPTH_TEST","program","initShaders","initQuadVertexBuffer","initAttributes","initUniforms","initCmapTexture","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","useProgram","createTexture","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","createBuffer","bufferData","STATIC_DRAW","attributes","getAttribLocation","enableVertexAttribArray","getUniformLocation","location","texture","LUMINANCE","RGB","NEAREST","image_loading_1","TextLayer","leftTop","rightBottom","mvMatrix","invMvMatrix","convertClipToRaster","px","py","qx","qy","lineHeight","fontSize","nx","ny","clearRect","font","max","min","convertRasterToClip","g","fillStyle","fillText","toFixed","xres","yres","normalizeWheel","MouseLayer","unsubscribe","panningState","unsubscribeFunctions","handleMouseMove","handleMouseDown","handleMouseUp","handleScroll","handlePointReporting","addEventListener","removeEventListener","broadcast","transformationCallback","pointCallback","fn","_a","relativeMousePosition","clientX","clientY","dx","previousMouse","dy","mousePosition","transformationAtStart","preventDefault","pixelY","mouse","deltaMatrix","scaleFactor","pow","imageCoordinates","canvasToImage","_b","getBoundingClientRect","left","top","point","inverseViewMatrix","insertRule","toSheet","block","e","delimiter","animationIterationCount","borderImageOutset","borderImageSlice","borderImageWidth","boxFlex","boxFlexGroup","boxOrdinalGroup","columnCount","columns","flex","flexGrow","flexPositive","flexShrink","flexNegative","flexOrder","gridRow","gridRowEnd","gridRowSpan","gridRowStart","gridColumn","gridColumnEnd","gridColumnSpan","gridColumnStart","msGridRow","msGridRowSpan","msGridColumn","msGridColumnSpan","fontWeight","opacity","order","orphans","tabSize","widows","zIndex","zoom","WebkitLineClamp","fillOpacity","floodOpacity","stopOpacity","strokeDasharray","strokeDashoffset","strokeMiterlimit","strokeOpacity","strokeWidth","reactPropsRegex","arg","memoize_browser_esm","prop","ReactDOM","ImageFrame_1","ImageViewer_1","ImageViewer","renderViewer","elem","baseUrl","sortMenu","removeCommonPrefix","framerates","component","Worker","UserAgent_DEPRECATED","isEventSupported","PIXEL_STEP","LINE_HEIGHT","PAGE_HEIGHT","sX","sY","pX","pY","detail","wheelDelta","wheelDeltaY","wheelDeltaX","axis","HORIZONTAL_AXIS","deltaY","deltaX","deltaMode","spinX","spinY","pixelX","getEventType","firefox","_ie","_firefox","_opera","_webkit","_chrome","_ie_real_version","_osx","_windows","_linux","_android","_win64","_iphone","_ipad","_native","_mobile","_populated","_populate","uas","navigator","userAgent","agent","exec","os","NaN","documentMode","trident","ver","ie","ieCompatibilityMode","ie64","opera","safari","chrome","windows","osx","linux","iphone","mobile","nativeApp","android","ipad","useHasFeature","ExecutionEnvironment","canUseDOM","implementation","hasFeature","eventNameSuffix","capture","eventName","isSupported","setAttribute","canUseWorkers","canUseEventListeners","attachEvent","canUseViewport","screen","isInWorker","cachedSetTimeout","cachedClearTimeout","process","defaultSetTimout","defaultClearTimeout","runTimeout","fun","setTimeout","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","timeout","len","run","marker","runClearTimeout","Item","noop","nextTick","args","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","for","f","h","q","u","$$typeof","typeOf","AsyncMode","ConcurrentMode","ContextConsumer","ContextProvider","Element","ForwardRef","Fragment","Lazy","Memo","Portal","Profiler","StrictMode","Suspense","isValidElementType","isAsyncMode","isConcurrentMode","isContextConsumer","isContextProvider","isElement","isForwardRef","isFragment","isLazy","isMemo","isPortal","isProfiler","isStrictMode","isSuspense","ReactPropTypesSecret","emptyFunction","shim","propName","componentName","propFullName","secret","err","getShim","isRequired","ReactPropTypes","bool","func","number","string","symbol","any","arrayOf","instanceOf","node","objectOf","oneOf","oneOfType","shape","exact","checkPropTypes","PropTypes","number_aware_compare_1","fullscreen_1","HelpScreen_1","ImageFrameWithLoading_1","navigation_1","MainDiv","ImageArea","SHIFT_IS_DOWN","ev","menuData","sortMenuRows","state","activeRow","selection","getDefaultSelection","slice","helpIsOpen","transformationNeedsUpdate","hasFocus","isPlaying","playbackPosition","framerateIndex","keyboardHandler","setFocus","unsetFocus","mainContainer","imageFrame","setState","componentWillReceiveProps","nextProps","validateSelection","rows","activeRows","imageSpec","className","map","row","NavRow","handleClick","navigateTo","active","tonemapGroup","frame","tree","res","find","sort","currentImage","currentSelection","entry","shift","item","getStringAtPos","position","isArray","img","config","lossMap","function","urlA","urlB","rowIndex","wishes","candidate","dumpTransformation","log","advanceAnimationFrame","currentPos","pos","delay","advanceF","actions","actionsUnderShift","goToNumber","goTo","toString","moveInLine","currentTitle","nextIndex","findIndex","ArrowLeft","ArrowRight","moveUpDown","nextRow","ArrowUp","ArrowDown","abs","changeExposure","multiplier","E","Escape","newIndex","metaKey","altKey","ctrlKey","shiftKey","defaultProps","splitPartsPattern","aComponents","bComponents","currentA","currentB","aAsInteger","parseInt","bAsInteger","requestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","ALLOW_KEYBOARD_INPUT","HelpScreenDiv","LoadingOverlay","ImageFrameWithLoading","requestId","currentRequest","isLoading","errorMsg","handleImageChange","shouldSetLoadingState","handledRequest","downloadImage","catch","spec","all","commonPrefix","reverse","NavLink","NavRowDiv","NavLinkNumber","span","templateObject_3","trimmedTitles","titlesInRow","prefix_1","suffix_1","lastIndexOf","onClick","strings","commonLength"],"mappings":"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","file":"jeri.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"react\"), require(\"react-dom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"Jeri\", [\"react\", \"react-dom\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Jeri\"] = factory(require(\"react\"), require(\"react-dom\"));\n\telse\n\t\troot[\"Jeri\"] = factory(root[\"React\"], root[\"ReactDOM\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__, __WEBPACK_EXTERNAL_MODULE__6__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","// Prototype identity matrix\nconst IDENTITY4x4 = new Float32Array(16);\nfor (let i = 0; i < 4; ++i) {\n    IDENTITY4x4[i + 4 * i] = 1.0;\n}\n\nexport class Matrix4x4 {\n\n    data: Float32Array;\n\n    static create(): Matrix4x4 {\n        return new Matrix4x4;\n    }\n\n    static fromScaling(matrix: Matrix4x4, scaling: number[]): void {\n        if (scaling.length !== 3) {\n            throw new Error('Matrix4x4.fromScaling requires a 3-dimentional vector as input');\n        }\n        scaling.forEach((scale, i) => {\n            matrix.data[i + 4 * i] = scale;\n        });\n    }\n\n    static multiply(output: Matrix4x4, a: Matrix4x4, b: Matrix4x4): void {\n        const data = new Float32Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n        for (let i = 0; i < 4; ++i) {\n            for (let j = 0; j < 4; ++j) {\n                for (let k = 0; k < 4; ++k) {\n                    data[4 * j + i] += a.data[4 * k + i] * b.data[4 * j + k];\n                }\n            }\n        }\n        output.data = data;\n    }\n\n    static scale(output: Matrix4x4, a: Matrix4x4, scale: number[]) {\n        if (scale.length !== 3) {\n            throw new Error('Matrix4x4.scale expects the third argument to have 3 numbers');\n        }\n        const data = new Float32Array(a.data);\n        for (let i = 0; i < 3; ++i) {\n            for (let j = 0; j < 4; ++j) {\n                data[4 * i + j] *= scale[i];\n            }\n        }\n        output.data = data;\n    }\n\n    static translate(output: Matrix4x4, a: Matrix4x4, translation: number[]) {\n        if (translation.length !== 3) {\n            throw new Error('Matrix4x4.translate expects the third argument to have 3 numbers');\n        }\n        const data = new Float32Array(a.data);\n        for (let i = 0; i < 4; ++i) {\n            for (let j = 0; j < 3; ++j) {\n                data[12 + i] += a.data[4 * j + i] * translation[j];\n            }\n        }\n        output.data = data;\n    }\n\n    static clone(a: Matrix4x4): Matrix4x4 {\n        return new Matrix4x4(a.data);\n    }\n\n    static invert(output: Matrix4x4, matrix: Matrix4x4): void {\n        const m = matrix.data;\n        const o = output.data;\n        // tslint:disable:whitespace\n        // tslint:disable:max-line-length\n        o[0]  = -m[7]*m[10]*m[13] + m[6]*m[11]*m[13] + m[7]*m[9]*m[14] - m[5]*m[11]*m[14] - m[6]*m[9]*m[15] + m[5]*m[10]*m[15];\n        o[1]  =  m[3]*m[10]*m[13] - m[2]*m[11]*m[13] - m[3]*m[9]*m[14] + m[1]*m[11]*m[14] + m[2]*m[9]*m[15] - m[1]*m[10]*m[15];\n        o[2]  = -m[3]*m[6]*m[13]  + m[2]*m[7]*m[13]  + m[3]*m[5]*m[14] - m[1]*m[7]*m[14]  - m[2]*m[5]*m[15] + m[1]*m[6]*m[15];\n        o[3]  =  m[3]*m[6]*m[9]   - m[2]*m[7]*m[9]   - m[3]*m[5]*m[10] + m[1]*m[7]*m[10]  + m[2]*m[5]*m[11] - m[1]*m[6]*m[11];\n        o[4]  =  m[7]*m[10]*m[12] - m[6]*m[11]*m[12] - m[7]*m[8]*m[14] + m[4]*m[11]*m[14] + m[6]*m[8]*m[15] - m[4]*m[10]*m[15];\n        o[5]  = -m[3]*m[10]*m[12] + m[2]*m[11]*m[12] + m[3]*m[8]*m[14] - m[0]*m[11]*m[14] - m[2]*m[8]*m[15] + m[0]*m[10]*m[15];\n        o[6]  =  m[3]*m[6]*m[12]  - m[2]*m[7]*m[12]  - m[3]*m[4]*m[14] + m[0]*m[7]*m[14]  + m[2]*m[4]*m[15] - m[0]*m[6]*m[15];\n        o[7]  = -m[3]*m[6]*m[8]   + m[2]*m[7]*m[8]   + m[3]*m[4]*m[10] - m[0]*m[7]*m[10]  - m[2]*m[4]*m[11] + m[0]*m[6]*m[11];\n        o[8]  = -m[7]*m[9]*m[12]  + m[5]*m[11]*m[12] + m[7]*m[8]*m[13] - m[4]*m[11]*m[13] - m[5]*m[8]*m[15] + m[4]*m[9]*m[15];\n        o[9]  =  m[3]*m[9]*m[12]  - m[1]*m[11]*m[12] - m[3]*m[8]*m[13] + m[0]*m[11]*m[13] + m[1]*m[8]*m[15] - m[0]*m[9]*m[15];\n        o[10] = -m[3]*m[5]*m[12]  + m[1]*m[7]*m[12]  + m[3]*m[4]*m[13] - m[0]*m[7]*m[13]  - m[1]*m[4]*m[15] + m[0]*m[5]*m[15];\n        o[11] =  m[3]*m[5]*m[8]   - m[1]*m[7]*m[8]   - m[3]*m[4]*m[9]  + m[0]*m[7]*m[9]   + m[1]*m[4]*m[11] - m[0]*m[5]*m[11];\n        o[12] =  m[6]*m[9]*m[12]  - m[5]*m[10]*m[12] - m[6]*m[8]*m[13] + m[4]*m[10]*m[13] + m[5]*m[8]*m[14] - m[4]*m[9]*m[14];\n        o[13] = -m[2]*m[9]*m[12]  + m[1]*m[10]*m[12] + m[2]*m[8]*m[13] - m[0]*m[10]*m[13] - m[1]*m[8]*m[14] + m[0]*m[9]*m[14];\n        o[14] =  m[2]*m[5]*m[12]  - m[1]*m[6]*m[12]  - m[2]*m[4]*m[13] + m[0]*m[6]*m[13]  + m[1]*m[4]*m[14] - m[0]*m[5]*m[14];\n        o[15] = -m[2]*m[5]*m[8]   + m[1]*m[6]*m[8]   + m[2]*m[4]*m[9]  - m[0]*m[6]*m[9]   - m[1]*m[4]*m[10] + m[0]*m[5]*m[10];\n        // tslint:enable:whitespace\n        // tslint:enable:max-line-length\n\n        const determinant = m[0] * o[0] + m[1] * o[4] + m[2] * o[8] + m[3] * o[12];\n\n        if (determinant === 0.0) {\n            throw new Error('Matrix is not invertible.');\n        }\n\n        const inverseDeterminant = 1.0 / determinant;\n\n        for (let i = 0; i < 16; ++i) {\n            o[i] *= inverseDeterminant;\n        }\n    }\n\n    constructor(buffer: Float32Array = IDENTITY4x4) {\n        this.data = new Float32Array(buffer);\n    }\n\n}\n\nexport class Vector4 {\n\n    data: Float32Array;\n\n    static create(): Vector4 {\n        return new Vector4;\n    }\n\n    static set(output: Vector4, x: number, y: number, z: number, w: number): void {\n        output.data[0] = x;\n        output.data[1] = y;\n        output.data[2] = z;\n        output.data[3] = w;\n    }\n\n    static fromValues(x: number, y: number, z: number, w: number): Vector4 {\n        const vector = new Vector4;\n        Vector4.set(vector, x, y, z, w);\n        return vector;\n    }\n\n    static transformMat4(output: Vector4, vector: Vector4, matrix: Matrix4x4) {\n        const v = vector.data;\n        const m = matrix.data;\n        const data = new Float32Array([0, 0, 0, 0]);\n        for (let i = 0; i < 4; ++i) {\n            for (let j = 0; j < 4; ++j) {\n                data[i] += v[j] * m[4 * j + i];\n            }\n        }\n        output.data = data;\n    }\n\n    constructor() {\n        this.data = new Float32Array([0, 0, 0, 0]);\n    }\n}\n\n// function assertEqual(a: mat4 | vec4, b: Matrix4x4 | Vector4, message: string): void {\n//     for (let i = 0; i < a.length; ++i) {\n//         if (Math.abs(a[i] - b.data[i]) > 0.001) {\n//             throw new Error('Failed:' + message + '\\n' + a + '\\n' + b.data);\n//         }\n//     }\n// }\n\n// function test() {\n//     const a = mat4.create();\n//     const b = Matrix4x4.create();\n\n//     assertEqual(a, b, 'after creation');\n\n//     for (let ii = 0; ii < 16; ++ii) {\n//         a[ii] = b.data[ii] = Math.random();\n//     }\n\n//     const c = mat4.create();\n//     const d = Matrix4x4.create();\n\n//     mat4.fromScaling(c, [4, 3, 2]);\n//     Matrix4x4.fromScaling(d, [4, 3, 2]);\n\n//     assertEqual(c, d, 'fromScaling');\n\n//     mat4.translate(c, a, [2, 3, 4]);\n//     Matrix4x4.translate(d, b, [2, 3, 4]);\n//     // assertEqual(a, b, 'after translation ab');\n//     assertEqual(c, d, 'after translation cd');\n\n//     mat4.scale(a, c, [2, 3, 4]);\n//     Matrix4x4.scale(b, d, [2, 3, 4]);\n//     assertEqual(a, b, 'after scaling ab');\n//     // assertEqual(c, d, 'after scaling cd');\n\n//     mat4.translate(c, a, [2, 3, 4]);\n//     Matrix4x4.translate(d, b, [2, 3, 4]);\n//     // assertEqual(a, b, 'after translation again ab');\n//     assertEqual(c, d, 'after translation again cd');\n\n//     mat4.invert(a, c);\n//     Matrix4x4.invert(b, d);\n//     assertEqual(a, b, 'after invert ab');\n//     assertEqual(c, d, 'after invert cd');\n\n//     const e = mat4.create();\n//     const f = Matrix4x4.create();\n\n//     mat4.multiply(e, c, a);\n//     Matrix4x4.multiply(f, d, b);\n//     assertEqual(e, f, 'after multiply ef');\n//     assertEqual(c, d, 'after multiply cd');\n//     assertEqual(a, b, 'after multiply ab');\n\n//     mat4.scale(a, c, [5, -3, 4]);\n//     Matrix4x4.scale(b, d, [5, -3, 4]);\n//     assertEqual(a, b, 'after scaling again ab');\n//     assertEqual(c, d, 'after scaling again cd');\n//     // assertEqual(c, d, 'after scaling cd');\n\n//     const q = mat4.clone(a);\n//     const i = Matrix4x4.clone(b);\n//     assertEqual(q, i, 'after cloning');\n\n//     const v1 = vec4.create();\n//     const w1 = Vector4.create();\n//     assertEqual(v1, w1, 'vectors after init');\n\n//     vec4.set(v1, 3, 4, 5, 6);\n//     Vector4.set(w1, 3, 4, 5, 6);\n//     assertEqual(v1, w1, 'vectors after set');\n\n//     const v2 = vec4.fromValues(6, 5, 4, 3);\n//     const w2 = Vector4.fromValues(6, 5, 4, 3);\n//     assertEqual(v2, w2, 'vectors after fromValues');\n\n//     vec4.transformMat4(v1, v2, a);\n//     Vector4.transformMat4(w1, w2, b);\n//     assertEqual(v1, w1, 'vectors after tranformMat4');\n// }\n","// @flow\n/* eslint-disable flowtype/object-type-delimiter */\n/* eslint-disable react/prop-types */\n\nimport React, { type Element } from 'react';\nimport { IS_BROWSER, DISABLE_SPEEDY, SC_ATTR, SC_VERSION_ATTR } from '../constants';\nimport StyledError from '../utils/error';\nimport { type ExtractedComp } from '../utils/extractCompsFromCSS';\nimport { splitByRules } from '../utils/stringifyRules';\nimport getNonce from '../utils/nonce';\n\nimport {\n  type Names,\n  addNameForId,\n  resetIdNames,\n  hasNameForId,\n  stringifyNames,\n  cloneNames,\n} from '../utils/styleNames';\n\nimport { sheetForTag, safeInsertRule, deleteRules } from '../utils/insertRuleHelpers';\n\ndeclare var __VERSION__: string;\n\nexport interface Tag<T> {\n  // $FlowFixMe: Doesn't seem to accept any combination w/ HTMLStyleElement for some reason\n  styleTag: HTMLStyleElement | null;\n  /* lists all ids of the tag */\n  getIds(): string[];\n  /* checks whether `name` is already injected for `id` */\n  hasNameForId(id: string, name: string): boolean;\n  /* inserts a marker to ensure the id's correct position in the sheet */\n  insertMarker(id: string): T;\n  /* inserts rules according to the ids markers */\n  insertRules(id: string, cssRules: string[], name: ?string): void;\n  /* removes all rules belonging to the id, keeping the marker around */\n  removeRules(id: string): void;\n  css(): string;\n  toHTML(additionalAttrs: ?string): string;\n  toElement(): Element<*>;\n  clone(): Tag<T>;\n  /* used in server side rendering to indicate that the rules in the tag have been flushed to HTML */\n  sealed: boolean;\n}\n\n/* this marker separates component styles and is important for rehydration */\nconst makeTextMarker = id => `\\n/* sc-component-id: ${id} */\\n`;\n\n/* add up all numbers in array up until and including the index */\nconst addUpUntilIndex = (sizes: number[], index: number): number => {\n  let totalUpToIndex = 0;\n  for (let i = 0; i <= index; i += 1) {\n    totalUpToIndex += sizes[i];\n  }\n\n  return totalUpToIndex;\n};\n\n/* create a new style tag after lastEl */\nconst makeStyleTag = (target: ?HTMLElement, tagEl: ?Node, insertBefore: ?boolean) => {\n  const el = document.createElement('style');\n  el.setAttribute(SC_ATTR, '');\n  el.setAttribute(SC_VERSION_ATTR, __VERSION__);\n\n  const nonce = getNonce();\n  if (nonce) {\n    el.setAttribute('nonce', nonce);\n  }\n\n  /* Work around insertRule quirk in EdgeHTML */\n  el.appendChild(document.createTextNode(''));\n\n  if (target && !tagEl) {\n    /* Append to target when no previous element was passed */\n    target.appendChild(el);\n  } else {\n    if (!tagEl || !target || !tagEl.parentNode) {\n      throw new StyledError(6);\n    }\n\n    /* Insert new style tag after the previous one */\n    tagEl.parentNode.insertBefore(el, insertBefore ? tagEl : tagEl.nextSibling);\n  }\n\n  return el;\n};\n\n/* takes a css factory function and outputs an html styled tag factory */\nconst wrapAsHtmlTag = (css: () => string, names: Names) => (additionalAttrs: ?string): string => {\n  const nonce = getNonce();\n  const attrs = [\n    nonce && `nonce=\"${nonce}\"`,\n    `${SC_ATTR}=\"${stringifyNames(names)}\"`,\n    `${SC_VERSION_ATTR}=\"${__VERSION__}\"`,\n    additionalAttrs,\n  ];\n\n  const htmlAttr = attrs.filter(Boolean).join(' ');\n  return `<style ${htmlAttr}>${css()}</style>`;\n};\n\n/* takes a css factory function and outputs an element factory */\nconst wrapAsElement = (css: () => string, names: Names) => () => {\n  const props = {\n    [SC_ATTR]: stringifyNames(names),\n    [SC_VERSION_ATTR]: __VERSION__,\n  };\n\n  const nonce = getNonce();\n  if (nonce) {\n    // $FlowFixMe\n    props.nonce = nonce;\n  }\n\n  // eslint-disable-next-line react/no-danger\n  return <style {...props} dangerouslySetInnerHTML={{ __html: css() }} />;\n};\n\nconst getIdsFromMarkersFactory = (markers: Object) => (): string[] => Object.keys(markers);\n\n/* speedy tags utilise insertRule */\nconst makeSpeedyTag = (el: HTMLStyleElement, getImportRuleTag: ?() => Tag<any>): Tag<number> => {\n  const names: Names = (Object.create(null): Object);\n  const markers = Object.create(null);\n  const sizes: number[] = [];\n\n  const extractImport = getImportRuleTag !== undefined;\n  /* indicates whether getImportRuleTag was called */\n  let usedImportRuleTag = false;\n\n  const insertMarker = id => {\n    const prev = markers[id];\n    if (prev !== undefined) {\n      return prev;\n    }\n\n    markers[id] = sizes.length;\n    sizes.push(0);\n    resetIdNames(names, id);\n\n    return markers[id];\n  };\n\n  const insertRules = (id, cssRules, name) => {\n    const marker = insertMarker(id);\n    const sheet = sheetForTag(el);\n    const insertIndex = addUpUntilIndex(sizes, marker);\n\n    let injectedRules = 0;\n    const importRules = [];\n    const cssRulesSize = cssRules.length;\n\n    for (let i = 0; i < cssRulesSize; i += 1) {\n      const cssRule = cssRules[i];\n      let mayHaveImport = extractImport; /* @import rules are reordered to appear first */\n      if (mayHaveImport && cssRule.indexOf('@import') !== -1) {\n        importRules.push(cssRule);\n      } else if (safeInsertRule(sheet, cssRule, insertIndex + injectedRules)) {\n        mayHaveImport = false;\n        injectedRules += 1;\n      }\n    }\n\n    if (extractImport && importRules.length > 0) {\n      usedImportRuleTag = true;\n      // $FlowFixMe\n      getImportRuleTag().insertRules(`${id}-import`, importRules);\n    }\n\n    sizes[marker] += injectedRules; /* add up no of injected rules */\n    addNameForId(names, id, name);\n  };\n\n  const removeRules = id => {\n    const marker = markers[id];\n    if (marker === undefined) return;\n\n    const size = sizes[marker];\n    const sheet = sheetForTag(el);\n    const removalIndex = addUpUntilIndex(sizes, marker) - 1;\n    deleteRules(sheet, removalIndex, size);\n    sizes[marker] = 0;\n    resetIdNames(names, id);\n\n    if (extractImport && usedImportRuleTag) {\n      // $FlowFixMe\n      getImportRuleTag().removeRules(`${id}-import`);\n    }\n  };\n\n  const css = () => {\n    const { cssRules } = sheetForTag(el);\n    let str = '';\n\n    // eslint-disable-next-line guard-for-in\n    for (const id in markers) {\n      str += makeTextMarker(id);\n      const marker = markers[id];\n      const end = addUpUntilIndex(sizes, marker);\n      const size = sizes[marker];\n      for (let i = end - size; i < end; i += 1) {\n        const rule = cssRules[i];\n        if (rule !== undefined) {\n          str += rule.cssText;\n        }\n      }\n    }\n\n    return str;\n  };\n\n  return {\n    clone() {\n      throw new StyledError(5);\n    },\n    css,\n    getIds: getIdsFromMarkersFactory(markers),\n    hasNameForId: hasNameForId(names),\n    insertMarker,\n    insertRules,\n    removeRules,\n    sealed: false,\n    styleTag: el,\n    toElement: wrapAsElement(css, names),\n    toHTML: wrapAsHtmlTag(css, names),\n  };\n};\n\nconst makeTextNode = id => document.createTextNode(makeTextMarker(id));\n\nconst makeBrowserTag = (el: HTMLStyleElement, getImportRuleTag: ?() => Tag<any>): Tag<Text> => {\n  const names = (Object.create(null): Object);\n  const markers = Object.create(null);\n\n  const extractImport = getImportRuleTag !== undefined;\n\n  /* indicates whether getImportRuleTag was called */\n  let usedImportRuleTag = false;\n\n  const insertMarker = id => {\n    const prev = markers[id];\n    if (prev !== undefined) {\n      return prev;\n    }\n\n    markers[id] = makeTextNode(id);\n    el.appendChild(markers[id]);\n    names[id] = Object.create(null);\n\n    return markers[id];\n  };\n\n  const insertRules = (id, cssRules, name) => {\n    const marker = insertMarker(id);\n    const importRules = [];\n    const cssRulesSize = cssRules.length;\n\n    for (let i = 0; i < cssRulesSize; i += 1) {\n      const rule = cssRules[i];\n      let mayHaveImport = extractImport;\n      if (mayHaveImport && rule.indexOf('@import') !== -1) {\n        importRules.push(rule);\n      } else {\n        mayHaveImport = false;\n        const separator = i === cssRulesSize - 1 ? '' : ' ';\n        marker.appendData(`${rule}${separator}`);\n      }\n    }\n\n    addNameForId(names, id, name);\n\n    if (extractImport && importRules.length > 0) {\n      usedImportRuleTag = true;\n      // $FlowFixMe\n      getImportRuleTag().insertRules(`${id}-import`, importRules);\n    }\n  };\n\n  const removeRules = id => {\n    const marker = markers[id];\n    if (marker === undefined) return;\n\n    /* create new empty text node and replace the current one */\n    const newMarker = makeTextNode(id);\n    el.replaceChild(newMarker, marker);\n    markers[id] = newMarker;\n    resetIdNames(names, id);\n\n    if (extractImport && usedImportRuleTag) {\n      // $FlowFixMe\n      getImportRuleTag().removeRules(`${id}-import`);\n    }\n  };\n\n  const css = () => {\n    let str = '';\n\n    // eslint-disable-next-line guard-for-in\n    for (const id in markers) {\n      str += markers[id].data;\n    }\n\n    return str;\n  };\n\n  return {\n    clone() {\n      throw new StyledError(5);\n    },\n    css,\n    getIds: getIdsFromMarkersFactory(markers),\n    hasNameForId: hasNameForId(names),\n    insertMarker,\n    insertRules,\n    removeRules,\n    sealed: false,\n    styleTag: el,\n    toElement: wrapAsElement(css, names),\n    toHTML: wrapAsHtmlTag(css, names),\n  };\n};\n\nconst makeServerTag = (namesArg, markersArg): Tag<[string]> => {\n  const names = namesArg === undefined ? (Object.create(null): Object) : namesArg;\n  const markers = markersArg === undefined ? Object.create(null) : markersArg;\n\n  const insertMarker = id => {\n    const prev = markers[id];\n    if (prev !== undefined) {\n      return prev;\n    }\n\n    return (markers[id] = ['']);\n  };\n\n  const insertRules = (id, cssRules, name) => {\n    const marker = insertMarker(id);\n    marker[0] += cssRules.join(' ');\n    addNameForId(names, id, name);\n  };\n\n  const removeRules = id => {\n    const marker = markers[id];\n    if (marker === undefined) return;\n    marker[0] = '';\n    resetIdNames(names, id);\n  };\n\n  const css = () => {\n    let str = '';\n    // eslint-disable-next-line guard-for-in\n    for (const id in markers) {\n      const cssForId = markers[id][0];\n      if (cssForId) {\n        str += makeTextMarker(id) + cssForId;\n      }\n    }\n    return str;\n  };\n\n  const clone = () => {\n    const namesClone = cloneNames(names);\n    const markersClone = Object.create(null);\n\n    // eslint-disable-next-line guard-for-in\n    for (const id in markers) {\n      markersClone[id] = [markers[id][0]];\n    }\n\n    return makeServerTag(namesClone, markersClone);\n  };\n\n  const tag = {\n    clone,\n    css,\n    getIds: getIdsFromMarkersFactory(markers),\n    hasNameForId: hasNameForId(names),\n    insertMarker,\n    insertRules,\n    removeRules,\n    sealed: false,\n    styleTag: null,\n    toElement: wrapAsElement(css, names),\n    toHTML: wrapAsHtmlTag(css, names),\n  };\n\n  return tag;\n};\n\nexport const makeTag = (\n  target: ?HTMLElement,\n  tagEl: ?HTMLStyleElement,\n  forceServer?: boolean,\n  insertBefore?: boolean,\n  getImportRuleTag?: () => Tag<any>\n): Tag<any> => {\n  if (IS_BROWSER && !forceServer) {\n    const el = makeStyleTag(target, tagEl, insertBefore);\n\n    if (DISABLE_SPEEDY) {\n      return makeBrowserTag(el, getImportRuleTag);\n    } else {\n      return makeSpeedyTag(el, getImportRuleTag);\n    }\n  }\n\n  return makeServerTag();\n};\n\nexport const rehydrate = (\n  tag: Tag<any>,\n  els: HTMLStyleElement[],\n  extracted: ExtractedComp[]\n): void => {\n  /* add all extracted components to the new tag */\n  for (let i = 0, len = extracted.length; i < len; i += 1) {\n    const { componentId, cssFromDOM } = extracted[i];\n    const cssRules = splitByRules(cssFromDOM);\n    tag.insertRules(componentId, cssRules);\n  }\n\n  /* remove old HTMLStyleElements, since they have been rehydrated */\n  for (let i = 0, len = els.length; i < len; i += 1) {\n    const el = els[i];\n    if (el.parentNode) {\n      el.parentNode.removeChild(el);\n    }\n  }\n};\n","// @flow\nimport React, { createContext, Component, type Element } from 'react';\nimport memoize from 'memoize-one';\nimport StyledError from '../utils/error';\nimport isFunction from '../utils/isFunction';\n\nexport type Theme = { [key: string]: mixed };\n\ntype Props = {\n  children?: Element<any>,\n  theme: Theme | ((outerTheme: Theme) => void),\n};\n\nexport const ThemeContext = createContext();\n\nexport const ThemeConsumer = ThemeContext.Consumer;\n\n/**\n * Provide a theme to an entire react component tree via context\n */\nexport default class ThemeProvider extends Component<Props> {\n  getContext: (theme: Theme | ((outerTheme: Theme) => void), outerTheme?: Theme) => Theme;\n\n  renderInner: Function;\n\n  constructor(props: Props) {\n    super(props);\n    this.getContext = memoize(this.getContext.bind(this));\n    this.renderInner = this.renderInner.bind(this);\n  }\n\n  render() {\n    if (!this.props.children) return null;\n\n    return <ThemeContext.Consumer>{this.renderInner}</ThemeContext.Consumer>;\n  }\n\n  renderInner(outerTheme?: Theme) {\n    const context = this.getContext(this.props.theme, outerTheme);\n\n    return (\n      <ThemeContext.Provider value={context}>\n        {React.Children.only(this.props.children)}\n      </ThemeContext.Provider>\n    );\n  }\n\n  /**\n   * Get the theme from the props, supporting both (outerTheme) => {}\n   * as well as object notation\n   */\n  getTheme(theme: (outerTheme: ?Theme) => void, outerTheme: ?Theme) {\n    if (isFunction(theme)) {\n      const mergedTheme = theme(outerTheme);\n\n      if (\n        process.env.NODE_ENV !== 'production' &&\n        (mergedTheme === null || Array.isArray(mergedTheme) || typeof mergedTheme !== 'object')\n      ) {\n        throw new StyledError(7);\n      }\n\n      return mergedTheme;\n    }\n\n    if (theme === null || Array.isArray(theme) || typeof theme !== 'object') {\n      throw new StyledError(8);\n    }\n\n    return { ...outerTheme, ...theme };\n  }\n\n  getContext(theme: (outerTheme: ?Theme) => void, outerTheme?: Theme) {\n    return this.getTheme(theme, outerTheme);\n  }\n}\n","// @flow\nimport { EMPTY_ARRAY } from '../utils/empties';\nimport flatten from '../utils/flatten';\nimport isStaticRules from '../utils/isStaticRules';\nimport stringifyRules from '../utils/stringifyRules';\nimport StyleSheet from './StyleSheet';\n\nimport type { RuleSet } from '../types';\n\nexport default class GlobalStyle {\n  componentId: string;\n\n  isStatic: boolean;\n\n  rules: RuleSet;\n\n  constructor(rules: RuleSet, componentId: string) {\n    this.rules = rules;\n    this.componentId = componentId;\n    this.isStatic = isStaticRules(rules, EMPTY_ARRAY);\n\n    if (!StyleSheet.master.hasId(componentId)) {\n      StyleSheet.master.deferredInject(componentId, []);\n    }\n  }\n\n  createStyles(executionContext: Object, styleSheet: StyleSheet) {\n    const flatCSS = flatten(this.rules, executionContext, styleSheet);\n    const css = stringifyRules(flatCSS, '');\n\n    styleSheet.inject(this.componentId, css);\n  }\n\n  removeStyles(styleSheet: StyleSheet) {\n    const { componentId } = this;\n    if (styleSheet.hasId(componentId)) {\n      styleSheet.remove(componentId);\n    }\n  }\n\n  // TODO: overwrite in-place instead of remove+create?\n  renderStyles(executionContext: Object, styleSheet: StyleSheet) {\n    this.removeStyles(styleSheet);\n    this.createStyles(executionContext, styleSheet);\n  }\n}\n","import { Matrix4x4 } from '../utils/linalg';\nimport { Image } from '../utils/image-loading';\n\nexport interface ImageDifference {\n  type: 'Difference';\n  imageA: Image;\n  imageB: Image;\n  width: number;\n  height: number;\n  nChannels: number;\n  lossFunction: LossFunction;\n}\n\nexport type Input = Image | ImageDifference;\n\nexport default class Layer {\n  protected transformation: Matrix4x4 = Matrix4x4.create();\n\n  private aspectMatrixBuffer: Matrix4x4 = Matrix4x4.create(); // To prevent memory allocation in the render loop\n  private viewMatrixBuffer: Matrix4x4 = Matrix4x4.create(); // To prevent memory allocation in the render loop\n\n  constructor(protected canvas: HTMLCanvasElement, protected image: Input) {\n    this.image = image;\n    this.resize();\n  }\n\n  /**\n   * Resize the canvas size if its elements size in the browser changed\n   * @return whether anything changed\n   */\n  protected resize(): boolean {\n    const width = Math.floor(this.canvas.clientWidth * window.devicePixelRatio);\n    const height = Math.floor(this.canvas.clientHeight * window.devicePixelRatio);\n    if (this.canvas.width !== width || this.canvas.height !== height) {\n      this.canvas.width = width;\n      this.canvas.height = height;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Compute the scalings in X and Y make sure the (-1,1) x (-1,1) box has the aspect ratio of the image\n   * and is positioned centerally in the canvas\n   */\n  protected getAspect(): {x: number, y: number} {\n    const viewAspect = this.canvas.clientWidth / this.canvas.clientHeight;\n    const textAspect = this.image.width / this.image.height;\n    let aspect: { x: number, y: number };\n    if (viewAspect > textAspect) {\n      aspect = { x: textAspect / viewAspect, y: 1.0 };\n    } else {\n      aspect = { x: 1.0, y: viewAspect / textAspect };\n    }\n    return aspect;\n  }\n\n  /**\n   * Compute the view matrix from the current transformation and the shape of the window\n   */\n  protected getViewMatrix(): Matrix4x4 {\n    const aspect = this.getAspect();\n    Matrix4x4.fromScaling(this.aspectMatrixBuffer, [aspect.x, aspect.y, 1.0]);\n    Matrix4x4.multiply(this.viewMatrixBuffer, this.aspectMatrixBuffer, this.transformation);\n    return this.viewMatrixBuffer;\n  }\n}\n\nexport enum LossFunction {\n  L1 = 1,\n  L2 = 2,\n  MAPE = 3,\n  MRSE = 4,\n  SMAPE = 5,\n  SSIM = 6,\n}\n\nconst lossFunctions = {\n  'L1': LossFunction.L1,\n  'L2': LossFunction.L2,\n  'MAPE': LossFunction.MAPE,\n  'MRSE': LossFunction.MRSE,\n  'SMAPE': LossFunction.SMAPE,\n  'SSIM': LossFunction.SSIM,\n};\n\nexport function lossFunctionFromString(name: string): LossFunction {\n  if (lossFunctions.hasOwnProperty(name)) {\n    return lossFunctions[name];\n  } else {\n    throw Error(`Loss function ${name} is invalid. Available options: ${Object.keys(lossFunctions)}`);\n  }\n}\n","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-is.production.min.js');\n} else {\n  module.exports = require('./cjs/react-is.development.js');\n}\n","export type Image = LdrImage | HdrImage;\n\nexport interface HdrImage {\n    type: 'HdrImage';\n    url: string;\n    width: number;\n    height: number;\n    nChannels: number;\n    data: Float32Array;\n}\n\nexport interface LdrImage {\n    type: 'LdrImage';\n    url: string;\n    width: number;\n    height: number;\n    nChannels: number;\n    data: HTMLImageElement;\n}\n\nimport ExrParserWorker = require('worker-loader!./exr-parser.worker.js');\n\n/**\n * A pool of exr parsing webworkers that get assigned tasks in a round-robin fashion.\n */\nclass ExrParserPool {\n    private workers: Worker[];\n    /** To divide the work equally, keep track of the worker that got the previous job. */\n    private nextWorkerId: number = 0;\n    /** Each job that is sent to a worker gets a unique jobId. */\n    private jobId: number = 0;\n    /** After sending a job to a web worker, we register a return handler for when data comes back  */\n    private returnHandlers: {[x: string]: Function } = {};\n\n    constructor(private nWorkers: number) {\n        this.workers = [];\n        for (let i = 0; i < nWorkers; ++i) {\n            const worker = new ExrParserWorker();\n            this.workers.push(worker);\n            worker.onmessage = this.handleResult.bind(this);\n        }\n    }\n\n    /**\n     * Parse raw EXR data using by assigning the task to a web worker in the pool\n     */\n    parse(url: string, data: ArrayBuffer): Promise<HdrImage> {\n        return new Promise((resolve, reject) => {\n            const worker = this.nextWorker();\n            const jobId = this.jobId++;\n            this.returnHandlers[jobId] = (event: MessageEvent) => {\n                if (event.data.success) {\n                    resolve({ url, ...event.data.image } as HdrImage);\n                } else {\n                    reject(new Error(event.data.message as string));\n                }\n            };\n            worker.postMessage({ jobId, data }, [data]);\n        });\n    }\n\n    /**\n     * Handler that gets called whenever a result comes back from the webworkers\n     * It looks up the corresponding handler by the jobId.\n     */\n    handleResult(event: MessageEvent) {\n        if (event.data.jobId != null) {\n            const callback = this.returnHandlers[event.data.jobId];\n            delete this.returnHandlers[event.data.jobId];\n            callback(event);\n        } else {\n            throw new Error(`Got a message from the webworker without job id.`);\n        }\n    }\n\n    /**\n     * Get the web worker whose turn it is\n     */\n    private nextWorker(): Worker {\n        const worker = this.workers[this.nextWorkerId];\n        this.nextWorkerId = (this.nextWorkerId + 1) % this.nWorkers;\n        return worker;\n    }\n}\n\nconst pool = new ExrParserPool(2);\nfunction parseExr(url: string, data: ArrayBuffer): Promise<HdrImage> {\n    return pool.parse(url, data);\n}\n\nexport function loadImage(url: string): Promise<Image> {\n    const suffix = url.split('.').pop();\n    if (suffix && suffix.toLocaleLowerCase() === 'exr') {\n        return loadExr(url);\n    } else {\n        return loadLdr(url);\n    }\n}\n\nexport function loadExr(url: string): Promise<HdrImage> {\n    console.time(`Downloading '${url}'`); // tslint:disable-line\n    return fetch(url)\n        .then(result => {\n            console.timeEnd(`Downloading '${url}'`); // tslint:disable-line\n            return result;\n        })\n        .then(result => result.arrayBuffer())\n        .then(data => parseExr(url, data));\n}\n\nexport function loadLdr(url: string): Promise<LdrImage> {\n    console.time(`Downloading '${url}'`); // tslint:disable-line\n    return new Promise((resolve, reject) => {\n        const image = new Image();\n        image.src = url;\n        image.crossOrigin = 'anonymous';\n        image.onerror = (error) => reject(new Error(`Failed to load '${url}'.`));\n        image.onload = () => {\n            console.timeEnd(`Downloading '${url}'`); // tslint:disable-line\n            try {\n                const canvas = document.createElement('canvas');\n                canvas.width = image.width;\n                canvas.height = image.height;\n                const ctx = canvas.getContext('2d');\n                if (!ctx) {\n                    reject(new Error('Failed to get 2d canvas context.'));\n                    return;\n                }\n                ctx.drawImage(image, 0, 0);\n                resolve({\n                    url: url,\n                    width: image.width,\n                    height: image.height,\n                    nChannels: 4,\n                    data: image,\n                    type: 'LdrImage',\n                } as LdrImage);\n            } catch (error) {\n                reject(new Error(`Failed to load image '${url}': ${error}`));\n            }\n        };\n    });\n}\n\nconst pixelColorCache: Map<Image, Function> = new Map();\n/**\n * Extract a pixel's color\n * Caches data for LDR images\n * @param image image\n * @param x pixel's x coordinate\n * @param y pixel's y coordinate\n * @param c color channel (r=0, g=1, b=2)\n */\nexport function getPixelColor(image: Image, x: number, y: number, c: number) {\n    if (image.type === 'HdrImage') {\n        return image.data[(x + y * image.width) * image.nChannels + c];\n    } else {\n        let getColorFnc = pixelColorCache.get(image);\n        if (getColorFnc == null) {\n            const canvas = document.createElement('canvas');\n            canvas.width = image.width;\n            canvas.height = image.height;\n            const ctx = canvas.getContext('2d');\n            if (!ctx) {\n                throw new Error('Failed to create 2d context to retrieve LDR image data');\n            }\n            ctx.drawImage(image.data, 0, 0, image.width, image.height);\n            getColorFnc = (X: number, Y: number, C: number) => ctx.getImageData(X, Y, 1, 1).data[C] / 256;\n            pixelColorCache.set(image, getColorFnc);\n        }\n        return getColorFnc(x, y, c);\n    }\n}\n\nexport class ImageCache {\n\n    private images: { [x: string]: Image } = {};\n    private downloading: { [x: string]: Promise<Image> } = {};\n\n    contains(url: string): boolean {\n        return this.images.hasOwnProperty(url);\n    }\n\n    currentlyDownloading(url: string): boolean {\n        return this.downloading.hasOwnProperty(url);\n    }\n\n    size(): number {\n        return Object.keys(this.images).length;\n    }\n\n    get(url: string): Promise<Image> {\n        if (this.contains(url)) {\n            // console.log(`Image ${url} was in cache.`); // tslint:disable-line\n            return Promise.resolve(this.images[url]);\n        } else if (this.currentlyDownloading(url)) {\n            return this.downloading[url];\n        } else {\n            // console.log(`Image ${url} is downloaded.`); // tslint:disable-line\n            return this.load(url);\n        }\n    }\n\n    private store(url: string, image: Image): Image {\n        if (this.currentlyDownloading(url)) {\n            delete this.currentlyDownloading[url];\n        }\n        this.images[url] = image;\n        return image;\n    }\n\n    private load(url: string) {\n        const imagePromise = loadImage(url);\n        this.downloading[url] = imagePromise;\n        return imagePromise\n            .then((image: Image) => this.store(url, image));\n    }\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__6__;","/*\n *          __        ___\n *    _____/ /___  __/ (_)____\n *   / ___/ __/ / / / / / ___/\n *  (__  ) /_/ /_/ / / (__  )\n * /____/\\__/\\__, /_/_/____/\n *          /____/\n *\n * light - weight css preprocessor @licence MIT\n */\n(function (factory) {/* eslint-disable */\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? (module['exports'] = factory(null)) :\n\t\ttypeof define === 'function' && define['amd'] ? define(factory(null)) :\n\t\t\t(window['stylis'] = factory(null))\n}(/** @param {*=} options */function factory (options) {/* eslint-disable */\n\n\t'use strict'\n\n\t/**\n\t * Notes\n\t *\n\t * The ['<method name>'] pattern is used to support closure compiler\n\t * the jsdoc signatures are also used to the same effect\n\t *\n\t * ----\n\t *\n\t * int + int + int === n4 [faster]\n\t *\n\t * vs\n\t *\n\t * int === n1 && int === n2 && int === n3\n\t *\n\t * ----\n\t *\n\t * switch (int) { case ints...} [faster]\n\t *\n\t * vs\n\t *\n\t * if (int == 1 && int === 2 ...)\n\t *\n\t * ----\n\t *\n\t * The (first*n1 + second*n2 + third*n3) format used in the property parser\n\t * is a simple way to hash the sequence of characters\n\t * taking into account the index they occur in\n\t * since any number of 3 character sequences could produce duplicates.\n\t *\n\t * On the other hand sequences that are directly tied to the index of the character\n\t * resolve a far more accurate measure, it's also faster\n\t * to evaluate one condition in a switch statement\n\t * than three in an if statement regardless of the added math.\n\t *\n\t * This allows the vendor prefixer to be both small and fast.\n\t */\n\n\tvar nullptn = /^\\0+/g /* matches leading null characters */\n\tvar formatptn = /[\\0\\r\\f]/g /* matches new line, null and formfeed characters */\n\tvar colonptn = /: */g /* splits animation rules */\n\tvar cursorptn = /zoo|gra/ /* assert cursor varient */\n\tvar transformptn = /([,: ])(transform)/g /* vendor prefix transform, older webkit */\n\tvar animationptn = /,+\\s*(?![^(]*[)])/g /* splits multiple shorthand notation animations */\n\tvar propertiesptn = / +\\s*(?![^(]*[)])/g /* animation properties */\n\tvar elementptn = / *[\\0] */g /* selector elements */\n\tvar selectorptn = /,\\r+?/g /* splits selectors */\n\tvar andptn = /([\\t\\r\\n ])*\\f?&/g /* match & */\n\tvar escapeptn = /:global\\(((?:[^\\(\\)\\[\\]]*|\\[.*\\]|\\([^\\(\\)]*\\))*)\\)/g /* matches :global(.*) */\n\tvar invalidptn = /\\W+/g /* removes invalid characters from keyframes */\n\tvar keyframeptn = /@(k\\w+)\\s*(\\S*)\\s*/ /* matches @keyframes $1 */\n\tvar plcholdrptn = /::(place)/g /* match ::placeholder varient */\n\tvar readonlyptn = /:(read-only)/g /* match :read-only varient */\n\tvar beforeptn = /\\s+(?=[{\\];=:>])/g /* matches \\s before ] ; = : */\n\tvar afterptn = /([[}=:>])\\s+/g /* matches \\s after characters [ } = : */\n\tvar tailptn = /(\\{[^{]+?);(?=\\})/g /* matches tail semi-colons ;} */\n\tvar whiteptn = /\\s{2,}/g /* matches repeating whitespace */\n\tvar pseudoptn = /([^\\(])(:+) */g /* pseudo element */\n\tvar writingptn = /[svh]\\w+-[tblr]{2}/ /* match writing mode property values */\n\tvar gradientptn = /([\\w-]+t\\()/g /* match *gradient property */\n\tvar supportsptn = /\\(\\s*(.*)\\s*\\)/g /* match supports (groups) */\n\tvar propertyptn = /([\\s\\S]*?);/g /* match properties leading semicolon */\n\tvar selfptn = /-self|flex-/g /* match flex- and -self in align-self: flex-*; */\n\tvar pseudofmt = /[^]*?(:[rp][el]a[\\w-]+)[^]*/ /* extrats :readonly or :placholder from selector */\n\tvar trimptn = /[ \\t]+$/ /* match tail whitspace */\n\tvar dimensionptn = /stretch|:\\s*\\w+\\-(?:conte|avail)/ /* match max/min/fit-content, fill-available */\n\tvar imgsrcptn = /([^-])(image-set\\()/\n\n\t/* vendors */\n\tvar webkit = '-webkit-'\n\tvar moz = '-moz-'\n\tvar ms = '-ms-'\n\n\t/* character codes */\n\tvar SEMICOLON = 59 /* ; */\n\tvar CLOSEBRACES = 125 /* } */\n\tvar OPENBRACES = 123 /* { */\n\tvar OPENPARENTHESES = 40 /* ( */\n\tvar CLOSEPARENTHESES = 41 /* ) */\n\tvar OPENBRACKET = 91 /* [ */\n\tvar CLOSEBRACKET = 93 /* ] */\n\tvar NEWLINE = 10 /* \\n */\n\tvar CARRIAGE = 13 /* \\r */\n\tvar TAB = 9 /* \\t */\n\tvar AT = 64 /* @ */\n\tvar SPACE = 32 /*   */\n\tvar AND = 38 /* & */\n\tvar DASH = 45 /* - */\n\tvar UNDERSCORE = 95 /* _ */\n\tvar STAR = 42 /* * */\n\tvar COMMA = 44 /* , */\n\tvar COLON = 58 /* : */\n\tvar SINGLEQUOTE = 39 /* ' */\n\tvar DOUBLEQUOTE = 34 /* \" */\n\tvar FOWARDSLASH = 47 /* / */\n\tvar GREATERTHAN = 62 /* > */\n\tvar PLUS = 43 /* + */\n\tvar TILDE = 126 /* ~ */\n\tvar NULL = 0 /* \\0 */\n\tvar FORMFEED = 12 /* \\f */\n\tvar VERTICALTAB = 11 /* \\v */\n\n\t/* special identifiers */\n\tvar KEYFRAME = 107 /* k */\n\tvar MEDIA = 109 /* m */\n\tvar SUPPORTS = 115 /* s */\n\tvar PLACEHOLDER = 112 /* p */\n\tvar READONLY = 111 /* o */\n\tvar IMPORT = 105 /* <at>i */\n\tvar CHARSET = 99 /* <at>c */\n\tvar DOCUMENT = 100 /* <at>d */\n\tvar PAGE = 112 /* <at>p */\n\n\tvar column = 1 /* current column */\n\tvar line = 1 /* current line numebr */\n\tvar pattern = 0 /* :pattern */\n\n\tvar cascade = 1 /* #id h1 h2 vs h1#id h2#id  */\n\tvar prefix = 1 /* vendor prefix */\n\tvar escape = 1 /* escape :global() pattern */\n\tvar compress = 0 /* compress output */\n\tvar semicolon = 0 /* no/semicolon option */\n\tvar preserve = 0 /* preserve empty selectors */\n\n\t/* empty reference */\n\tvar array = []\n\n\t/* plugins */\n\tvar plugins = []\n\tvar plugged = 0\n\tvar should = null\n\n\t/* plugin context */\n\tvar POSTS = -2\n\tvar PREPS = -1\n\tvar UNKWN = 0\n\tvar PROPS = 1\n\tvar BLCKS = 2\n\tvar ATRUL = 3\n\n\t/* plugin newline context */\n\tvar unkwn = 0\n\n\t/* keyframe animation */\n\tvar keyed = 1\n\tvar key = ''\n\n\t/* selector namespace */\n\tvar nscopealt = ''\n\tvar nscope = ''\n\n\t/**\n\t * Compile\n\t *\n\t * @param {Array<string>} parent\n\t * @param {Array<string>} current\n\t * @param {string} body\n\t * @param {number} id\n\t * @param {number} depth\n\t * @return {string}\n\t */\n\tfunction compile (parent, current, body, id, depth) {\n\t\tvar bracket = 0 /* brackets [] */\n\t\tvar comment = 0 /* comments /* // or /* */\n\t\tvar parentheses = 0 /* functions () */\n\t\tvar quote = 0 /* quotes '', \"\" */\n\n\t\tvar first = 0 /* first character code */\n\t\tvar second = 0 /* second character code */\n\t\tvar code = 0 /* current character code */\n\t\tvar tail = 0 /* previous character code */\n\t\tvar trail = 0 /* character before previous code */\n\t\tvar peak = 0 /* previous non-whitespace code */\n\n\t\tvar counter = 0 /* count sequence termination */\n\t\tvar context = 0 /* track current context */\n\t\tvar atrule = 0 /* track @at-rule context */\n\t\tvar pseudo = 0 /* track pseudo token index */\n\t\tvar caret = 0 /* current character index */\n\t\tvar format = 0 /* control character formating context */\n\t\tvar insert = 0 /* auto semicolon insertion */\n\t\tvar invert = 0 /* inverted selector pattern */\n\t\tvar length = 0 /* generic length address */\n\t\tvar eof = body.length /* end of file(length) */\n\t\tvar eol = eof - 1 /* end of file(characters) */\n\n\t\tvar char = '' /* current character */\n\t\tvar chars = '' /* current buffer of characters */\n\t\tvar child = '' /* next buffer of characters */\n\t\tvar out = '' /* compiled body */\n\t\tvar children = '' /* compiled children */\n\t\tvar flat = '' /* compiled leafs */\n\t\tvar selector /* generic selector address */\n\t\tvar result /* generic address */\n\n\t\t// ...build body\n\t\twhile (caret < eof) {\n\t\t\tcode = body.charCodeAt(caret)\n\n\t\t\t// eof varient\n\t\t\tif (caret === eol) {\n\t\t\t\t// last character + noop context, add synthetic padding for noop context to terminate\n\t\t\t\tif (comment + quote + parentheses + bracket !== 0) {\n\t\t\t\t\tif (comment !== 0) {\n\t\t\t\t\t\tcode = comment === FOWARDSLASH ? NEWLINE : FOWARDSLASH\n\t\t\t\t\t}\n\n\t\t\t\t\tquote = parentheses = bracket = 0\n\t\t\t\t\teof++\n\t\t\t\t\teol++\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (comment + quote + parentheses + bracket === 0) {\n\t\t\t\t// eof varient\n\t\t\t\tif (caret === eol) {\n\t\t\t\t\tif (format > 0) {\n\t\t\t\t\t\tchars = chars.replace(formatptn, '')\n\t\t\t\t\t}\n\n\t\t\t\t\tif (chars.trim().length > 0) {\n\t\t\t\t\t\tswitch (code) {\n\t\t\t\t\t\t\tcase SPACE:\n\t\t\t\t\t\t\tcase TAB:\n\t\t\t\t\t\t\tcase SEMICOLON:\n\t\t\t\t\t\t\tcase CARRIAGE:\n\t\t\t\t\t\t\tcase NEWLINE: {\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\tchars += body.charAt(caret)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcode = SEMICOLON\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// auto semicolon insertion\n\t\t\t\tif (insert === 1) {\n\t\t\t\t\tswitch (code) {\n\t\t\t\t\t\t// false flags\n\t\t\t\t\t\tcase OPENBRACES:\n\t\t\t\t\t\tcase CLOSEBRACES:\n\t\t\t\t\t\tcase SEMICOLON:\n\t\t\t\t\t\tcase DOUBLEQUOTE:\n\t\t\t\t\t\tcase SINGLEQUOTE:\n\t\t\t\t\t\tcase OPENPARENTHESES:\n\t\t\t\t\t\tcase CLOSEPARENTHESES:\n\t\t\t\t\t\tcase COMMA: {\n\t\t\t\t\t\t\tinsert = 0\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// ignore\n\t\t\t\t\t\tcase TAB:\n\t\t\t\t\t\tcase CARRIAGE:\n\t\t\t\t\t\tcase NEWLINE:\n\t\t\t\t\t\tcase SPACE: {\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// valid\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\tinsert = 0\n\t\t\t\t\t\t\tlength = caret\n\t\t\t\t\t\t\tfirst = code\n\t\t\t\t\t\t\tcaret--\n\t\t\t\t\t\t\tcode = SEMICOLON\n\n\t\t\t\t\t\t\twhile (length < eof) {\n\t\t\t\t\t\t\t\tswitch (body.charCodeAt(length++)) {\n\t\t\t\t\t\t\t\t\tcase NEWLINE:\n\t\t\t\t\t\t\t\t\tcase CARRIAGE:\n\t\t\t\t\t\t\t\t\tcase SEMICOLON: {\n\t\t\t\t\t\t\t\t\t\t++caret\n\t\t\t\t\t\t\t\t\t\tcode = first\n\t\t\t\t\t\t\t\t\t\tlength = eof\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tcase COLON: {\n\t\t\t\t\t\t\t\t\t\tif (format > 0) {\n\t\t\t\t\t\t\t\t\t\t\t++caret\n\t\t\t\t\t\t\t\t\t\t\tcode = first\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tcase OPENBRACES: {\n\t\t\t\t\t\t\t\t\t\tlength = eof\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// token varient\n\t\t\t\tswitch (code) {\n\t\t\t\t\tcase OPENBRACES: {\n\t\t\t\t\t\tchars = chars.trim()\n\t\t\t\t\t\tfirst = chars.charCodeAt(0)\n\t\t\t\t\t\tcounter = 1\n\t\t\t\t\t\tlength = ++caret\n\n\t\t\t\t\t\twhile (caret < eof) {\n\t\t\t\t\t\t\tswitch (code = body.charCodeAt(caret)) {\n\t\t\t\t\t\t\t\tcase OPENBRACES: {\n\t\t\t\t\t\t\t\t\tcounter++\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcase CLOSEBRACES: {\n\t\t\t\t\t\t\t\t\tcounter--\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcase FOWARDSLASH: {\n\t\t\t\t\t\t\t\t\tswitch (second = body.charCodeAt(caret + 1)) {\n\t\t\t\t\t\t\t\t\t\t// /*, //\n\t\t\t\t\t\t\t\t\t\tcase STAR:\n\t\t\t\t\t\t\t\t\t\tcase FOWARDSLASH: {\n\t\t\t\t\t\t\t\t\t\t\tcaret = delimited(second, caret, eol, body)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// given \"[\" === 91 & \"]\" === 93 hence forth 91 + 1 + 1 === 93\n\t\t\t\t\t\t\t\tcase OPENBRACKET: {\n\t\t\t\t\t\t\t\t\tcode++\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// given \"(\" === 40 & \")\" === 41 hence forth 40 + 1 === 41\n\t\t\t\t\t\t\t\tcase OPENPARENTHESES: {\n\t\t\t\t\t\t\t\t\tcode++\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// quote tail delimiter is identical to the head delimiter hence noop,\n\t\t\t\t\t\t\t\t// fallthrough clauses have been shifted to the correct tail delimiter\n\t\t\t\t\t\t\t\tcase DOUBLEQUOTE:\n\t\t\t\t\t\t\t\tcase SINGLEQUOTE: {\n\t\t\t\t\t\t\t\t\twhile (caret++ < eol) {\n\t\t\t\t\t\t\t\t\t\tif (body.charCodeAt(caret) === code) {\n\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (counter === 0) {\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcaret++\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tchild = body.substring(length, caret)\n\n\t\t\t\t\t\tif (first === NULL) {\n\t\t\t\t\t\t\tfirst = (chars = chars.replace(nullptn, '').trim()).charCodeAt(0)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tswitch (first) {\n\t\t\t\t\t\t\t// @at-rule\n\t\t\t\t\t\t\tcase AT: {\n\t\t\t\t\t\t\t\tif (format > 0) {\n\t\t\t\t\t\t\t\t\tchars = chars.replace(formatptn, '')\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tsecond = chars.charCodeAt(1)\n\n\t\t\t\t\t\t\t\tswitch (second) {\n\t\t\t\t\t\t\t\t\tcase DOCUMENT:\n\t\t\t\t\t\t\t\t\tcase MEDIA:\n\t\t\t\t\t\t\t\t\tcase SUPPORTS:\n\t\t\t\t\t\t\t\t\tcase DASH: {\n\t\t\t\t\t\t\t\t\t\tselector = current\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t\t\tselector = array\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tchild = compile(current, selector, child, second, depth+1)\n\t\t\t\t\t\t\t\tlength = child.length\n\n\t\t\t\t\t\t\t\t// preserve empty @at-rule\n\t\t\t\t\t\t\t\tif (preserve > 0 && length === 0) {\n\t\t\t\t\t\t\t\t\tlength = chars.length\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// execute plugins, @at-rule context\n\t\t\t\t\t\t\t\tif (plugged > 0) {\n\t\t\t\t\t\t\t\t\tselector = select(array, chars, invert)\n\t\t\t\t\t\t\t\t\tresult = proxy(ATRUL, child, selector, current, line, column, length, second, depth, id)\n\t\t\t\t\t\t\t\t\tchars = selector.join('')\n\n\t\t\t\t\t\t\t\t\tif (result !== void 0) {\n\t\t\t\t\t\t\t\t\t\tif ((length = (child = result.trim()).length) === 0) {\n\t\t\t\t\t\t\t\t\t\t\tsecond = 0\n\t\t\t\t\t\t\t\t\t\t\tchild = ''\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (length > 0) {\n\t\t\t\t\t\t\t\t\tswitch (second) {\n\t\t\t\t\t\t\t\t\t\tcase SUPPORTS: {\n\t\t\t\t\t\t\t\t\t\t\tchars = chars.replace(supportsptn, supports)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcase DOCUMENT:\n\t\t\t\t\t\t\t\t\t\tcase MEDIA:\n\t\t\t\t\t\t\t\t\t\tcase DASH: {\n\t\t\t\t\t\t\t\t\t\t\tchild = chars + '{' + child + '}'\n\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tcase KEYFRAME: {\n\t\t\t\t\t\t\t\t\t\t\tchars = chars.replace(keyframeptn, '$1 $2' + (keyed > 0 ? key : ''))\n\t\t\t\t\t\t\t\t\t\t\tchild = chars + '{' + child + '}'\n\n\t\t\t\t\t\t\t\t\t\t\tif (prefix === 1 || (prefix === 2 && vendor('@'+child, 3))) {\n\t\t\t\t\t\t\t\t\t\t\t\tchild = '@' + webkit + child + '@' + child\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tchild = '@' + child\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t\t\t\tchild = chars + child\n\n\t\t\t\t\t\t\t\t\t\t\tif (id === PAGE) {\n\t\t\t\t\t\t\t\t\t\t\t\tchild = (out += child, '')\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tchild = ''\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// selector\n\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\tchild = compile(current, select(current, chars, invert), child, id, depth+1)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tchildren += child\n\n\t\t\t\t\t\t// reset\n\t\t\t\t\t\tcontext = 0\n\t\t\t\t\t\tinsert = 0\n\t\t\t\t\t\tpseudo = 0\n\t\t\t\t\t\tformat = 0\n\t\t\t\t\t\tinvert = 0\n\t\t\t\t\t\tatrule = 0\n\t\t\t\t\t\tchars = ''\n\t\t\t\t\t\tchild = ''\n\t\t\t\t\t\tcode = body.charCodeAt(++caret)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase CLOSEBRACES:\n\t\t\t\t\tcase SEMICOLON: {\n\t\t\t\t\t\tchars = (format > 0 ? chars.replace(formatptn, '') : chars).trim()\n\n\t\t\t\t\t\tif ((length = chars.length) > 1) {\n\t\t\t\t\t\t\t// monkey-patch missing colon\n\t\t\t\t\t\t\tif (pseudo === 0) {\n\t\t\t\t\t\t\t\tfirst = chars.charCodeAt(0)\n\n\t\t\t\t\t\t\t\t// first character is a letter or dash, buffer has a space character\n\t\t\t\t\t\t\t\tif ((first === DASH || first > 96 && first < 123)) {\n\t\t\t\t\t\t\t\t\tlength = (chars = chars.replace(' ', ':')).length\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// execute plugins, property context\n\t\t\t\t\t\t\tif (plugged > 0) {\n\t\t\t\t\t\t\t\tif ((result = proxy(PROPS, chars, current, parent, line, column, out.length, id, depth, id)) !== void 0) {\n\t\t\t\t\t\t\t\t\tif ((length = (chars = result.trim()).length) === 0) {\n\t\t\t\t\t\t\t\t\t\tchars = '\\0\\0'\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfirst = chars.charCodeAt(0)\n\t\t\t\t\t\t\tsecond = chars.charCodeAt(1)\n\n\t\t\t\t\t\t\tswitch (first) {\n\t\t\t\t\t\t\t\tcase NULL: {\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcase AT: {\n\t\t\t\t\t\t\t\t\tif (second === IMPORT || second === CHARSET) {\n\t\t\t\t\t\t\t\t\t\tflat += chars + body.charAt(caret)\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t\tif (chars.charCodeAt(length-1) === COLON) {\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tout += property(chars, first, second, chars.charCodeAt(2))\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// reset\n\t\t\t\t\t\tcontext = 0\n\t\t\t\t\t\tinsert = 0\n\t\t\t\t\t\tpseudo = 0\n\t\t\t\t\t\tformat = 0\n\t\t\t\t\t\tinvert = 0\n\t\t\t\t\t\tchars = ''\n\t\t\t\t\t\tcode = body.charCodeAt(++caret)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// parse characters\n\t\t\tswitch (code) {\n\t\t\t\tcase CARRIAGE:\n\t\t\t\tcase NEWLINE: {\n\t\t\t\t\t// auto insert semicolon\n\t\t\t\t\tif (comment + quote + parentheses + bracket + semicolon === 0) {\n\t\t\t\t\t\t// valid non-whitespace characters that\n\t\t\t\t\t\t// may precede a newline\n\t\t\t\t\t\tswitch (peak) {\n\t\t\t\t\t\t\tcase CLOSEPARENTHESES:\n\t\t\t\t\t\t\tcase SINGLEQUOTE:\n\t\t\t\t\t\t\tcase DOUBLEQUOTE:\n\t\t\t\t\t\t\tcase AT:\n\t\t\t\t\t\t\tcase TILDE:\n\t\t\t\t\t\t\tcase GREATERTHAN:\n\t\t\t\t\t\t\tcase STAR:\n\t\t\t\t\t\t\tcase PLUS:\n\t\t\t\t\t\t\tcase FOWARDSLASH:\n\t\t\t\t\t\t\tcase DASH:\n\t\t\t\t\t\t\tcase COLON:\n\t\t\t\t\t\t\tcase COMMA:\n\t\t\t\t\t\t\tcase SEMICOLON:\n\t\t\t\t\t\t\tcase OPENBRACES:\n\t\t\t\t\t\t\tcase CLOSEBRACES: {\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t// current buffer has a colon\n\t\t\t\t\t\t\t\tif (pseudo > 0) {\n\t\t\t\t\t\t\t\t\tinsert = 1\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// terminate line comment\n\t\t\t\t\tif (comment === FOWARDSLASH) {\n\t\t\t\t\t\tcomment = 0\n\t\t\t\t\t} else if (cascade + context === 0 && id !== KEYFRAME && chars.length > 0) {\n\t\t\t\t\t\tformat = 1\n\t\t\t\t\t\tchars += '\\0'\n\t\t\t\t\t}\n\n\t\t\t\t\t// execute plugins, newline context\n\t\t\t\t\tif (plugged * unkwn > 0) {\n\t\t\t\t\t\tproxy(UNKWN, chars, current, parent, line, column, out.length, id, depth, id)\n\t\t\t\t\t}\n\n\t\t\t\t\t// next line, reset column position\n\t\t\t\t\tcolumn = 1\n\t\t\t\t\tline++\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tcase SEMICOLON:\n\t\t\t\tcase CLOSEBRACES: {\n\t\t\t\t\tif (comment + quote + parentheses + bracket === 0) {\n\t\t\t\t\t\tcolumn++\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\t// increment column position\n\t\t\t\t\tcolumn++\n\n\t\t\t\t\t// current character\n\t\t\t\t\tchar = body.charAt(caret)\n\n\t\t\t\t\t// remove comments, escape functions, strings, attributes and prepare selectors\n\t\t\t\t\tswitch (code) {\n\t\t\t\t\t\tcase TAB:\n\t\t\t\t\t\tcase SPACE: {\n\t\t\t\t\t\t\tif (quote + bracket + comment === 0) {\n\t\t\t\t\t\t\t\tswitch (tail) {\n\t\t\t\t\t\t\t\t\tcase COMMA:\n\t\t\t\t\t\t\t\t\tcase COLON:\n\t\t\t\t\t\t\t\t\tcase TAB:\n\t\t\t\t\t\t\t\t\tcase SPACE: {\n\t\t\t\t\t\t\t\t\t\tchar = ''\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t\t\tif (code !== SPACE) {\n\t\t\t\t\t\t\t\t\t\t\tchar = ' '\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// escape breaking control characters\n\t\t\t\t\t\tcase NULL: {\n\t\t\t\t\t\t\tchar = '\\\\0'\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase FORMFEED: {\n\t\t\t\t\t\t\tchar = '\\\\f'\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase VERTICALTAB: {\n\t\t\t\t\t\t\tchar = '\\\\v'\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// &\n\t\t\t\t\t\tcase AND: {\n\t\t\t\t\t\t\t// inverted selector pattern i.e html &\n\t\t\t\t\t\t\tif (quote + comment + bracket === 0 && cascade > 0) {\n\t\t\t\t\t\t\t\tinvert = 1\n\t\t\t\t\t\t\t\tformat = 1\n\t\t\t\t\t\t\t\tchar = '\\f' + char\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// ::p<l>aceholder, l\n\t\t\t\t\t\t// :read-on<l>y, l\n\t\t\t\t\t\tcase 108: {\n\t\t\t\t\t\t\tif (quote + comment + bracket + pattern === 0 && pseudo > 0) {\n\t\t\t\t\t\t\t\tswitch (caret - pseudo) {\n\t\t\t\t\t\t\t\t\t// ::placeholder\n\t\t\t\t\t\t\t\t\tcase 2: {\n\t\t\t\t\t\t\t\t\t\tif (tail === PLACEHOLDER && body.charCodeAt(caret-3) === COLON) {\n\t\t\t\t\t\t\t\t\t\t\tpattern = tail\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// :read-only\n\t\t\t\t\t\t\t\t\tcase 8: {\n\t\t\t\t\t\t\t\t\t\tif (trail === READONLY) {\n\t\t\t\t\t\t\t\t\t\t\tpattern = trail\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// :<pattern>\n\t\t\t\t\t\tcase COLON: {\n\t\t\t\t\t\t\tif (quote + comment + bracket === 0) {\n\t\t\t\t\t\t\t\tpseudo = caret\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// selectors\n\t\t\t\t\t\tcase COMMA: {\n\t\t\t\t\t\t\tif (comment + parentheses + quote + bracket === 0) {\n\t\t\t\t\t\t\t\tformat = 1\n\t\t\t\t\t\t\t\tchar += '\\r'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// quotes\n\t\t\t\t\t\tcase DOUBLEQUOTE:\n\t\t\t\t\t\tcase SINGLEQUOTE: {\n\t\t\t\t\t\t\tif (comment === 0) {\n\t\t\t\t\t\t\t\tquote = quote === code ? 0 : (quote === 0 ? code : quote)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// attributes\n\t\t\t\t\t\tcase OPENBRACKET: {\n\t\t\t\t\t\t\tif (quote + comment + parentheses === 0) {\n\t\t\t\t\t\t\t\tbracket++\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase CLOSEBRACKET: {\n\t\t\t\t\t\t\tif (quote + comment + parentheses === 0) {\n\t\t\t\t\t\t\t\tbracket--\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// functions\n\t\t\t\t\t\tcase CLOSEPARENTHESES: {\n\t\t\t\t\t\t\tif (quote + comment + bracket === 0) {\n\t\t\t\t\t\t\t\tparentheses--\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase OPENPARENTHESES: {\n\t\t\t\t\t\t\tif (quote + comment + bracket === 0) {\n\t\t\t\t\t\t\t\tif (context === 0) {\n\t\t\t\t\t\t\t\t\tswitch (tail*2 + trail*3) {\n\t\t\t\t\t\t\t\t\t\t// :matches\n\t\t\t\t\t\t\t\t\t\tcase 533: {\n\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t// :global, :not, :nth-child etc...\n\t\t\t\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t\t\t\tcounter = 0\n\t\t\t\t\t\t\t\t\t\t\tcontext = 1\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tparentheses++\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcase AT: {\n\t\t\t\t\t\t\tif (comment + parentheses + quote + bracket + pseudo + atrule === 0) {\n\t\t\t\t\t\t\t\tatrule = 1\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// block/line comments\n\t\t\t\t\t\tcase STAR:\n\t\t\t\t\t\tcase FOWARDSLASH: {\n\t\t\t\t\t\t\tif (quote + bracket + parentheses > 0) {\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tswitch (comment) {\n\t\t\t\t\t\t\t\t// initialize line/block comment context\n\t\t\t\t\t\t\t\tcase 0: {\n\t\t\t\t\t\t\t\t\tswitch (code*2 + body.charCodeAt(caret+1)*3) {\n\t\t\t\t\t\t\t\t\t\t// //\n\t\t\t\t\t\t\t\t\t\tcase 235: {\n\t\t\t\t\t\t\t\t\t\t\tcomment = FOWARDSLASH\n\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t// /*\n\t\t\t\t\t\t\t\t\t\tcase 220: {\n\t\t\t\t\t\t\t\t\t\t\tlength = caret\n\t\t\t\t\t\t\t\t\t\t\tcomment = STAR\n\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// end block comment context\n\t\t\t\t\t\t\t\tcase STAR: {\n\t\t\t\t\t\t\t\t\tif (code === FOWARDSLASH && tail === STAR && length + 2 !== caret) {\n\t\t\t\t\t\t\t\t\t\t// /*<!> ... */, !\n\t\t\t\t\t\t\t\t\t\tif (body.charCodeAt(length+2) === 33) {\n\t\t\t\t\t\t\t\t\t\t\tout += body.substring(length, caret+1)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tchar = ''\n\t\t\t\t\t\t\t\t\t\tcomment = 0\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// ignore comment blocks\n\t\t\t\t\tif (comment === 0) {\n\t\t\t\t\t\t// aggressive isolation mode, divide each individual selector\n\t\t\t\t\t\t// including selectors in :not function but excluding selectors in :global function\n\t\t\t\t\t\tif (cascade + quote + bracket + atrule === 0 && id !== KEYFRAME && code !== SEMICOLON) {\n\t\t\t\t\t\t\tswitch (code) {\n\t\t\t\t\t\t\t\tcase COMMA:\n\t\t\t\t\t\t\t\tcase TILDE:\n\t\t\t\t\t\t\t\tcase GREATERTHAN:\n\t\t\t\t\t\t\t\tcase PLUS:\n\t\t\t\t\t\t\t\tcase CLOSEPARENTHESES:\n\t\t\t\t\t\t\t\tcase OPENPARENTHESES: {\n\t\t\t\t\t\t\t\t\tif (context === 0) {\n\t\t\t\t\t\t\t\t\t\t// outside of an isolated context i.e nth-child(<...>)\n\t\t\t\t\t\t\t\t\t\tswitch (tail) {\n\t\t\t\t\t\t\t\t\t\t\tcase TAB:\n\t\t\t\t\t\t\t\t\t\t\tcase SPACE:\n\t\t\t\t\t\t\t\t\t\t\tcase NEWLINE:\n\t\t\t\t\t\t\t\t\t\t\tcase CARRIAGE: {\n\t\t\t\t\t\t\t\t\t\t\t\tchar = char + '\\0'\n\t\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t\t\t\t\tchar = '\\0' + char + (code === COMMA ? '' : '\\0')\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tformat = 1\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// within an isolated context, sleep untill it's terminated\n\t\t\t\t\t\t\t\t\t\tswitch (code) {\n\t\t\t\t\t\t\t\t\t\t\tcase OPENPARENTHESES: {\n\t\t\t\t\t\t\t\t\t\t\t\t// :globa<l>(\n\t\t\t\t\t\t\t\t\t\t\t\tif (pseudo + 7 === caret && tail === 108) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tpseudo = 0\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tcontext = ++counter\n\t\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tcase CLOSEPARENTHESES: {\n\t\t\t\t\t\t\t\t\t\t\t\tif ((context = --counter) === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tformat = 1\n\t\t\t\t\t\t\t\t\t\t\t\t\tchar += '\\0'\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcase TAB:\n\t\t\t\t\t\t\t\tcase SPACE: {\n\t\t\t\t\t\t\t\t\tswitch (tail) {\n\t\t\t\t\t\t\t\t\t\tcase NULL:\n\t\t\t\t\t\t\t\t\t\tcase OPENBRACES:\n\t\t\t\t\t\t\t\t\t\tcase CLOSEBRACES:\n\t\t\t\t\t\t\t\t\t\tcase SEMICOLON:\n\t\t\t\t\t\t\t\t\t\tcase COMMA:\n\t\t\t\t\t\t\t\t\t\tcase FORMFEED:\n\t\t\t\t\t\t\t\t\t\tcase TAB:\n\t\t\t\t\t\t\t\t\t\tcase SPACE:\n\t\t\t\t\t\t\t\t\t\tcase NEWLINE:\n\t\t\t\t\t\t\t\t\t\tcase CARRIAGE: {\n\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t\t\t\t// ignore in isolated contexts\n\t\t\t\t\t\t\t\t\t\t\tif (context === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\tformat = 1\n\t\t\t\t\t\t\t\t\t\t\t\tchar += '\\0'\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// concat buffer of characters\n\t\t\t\t\t\tchars += char\n\n\t\t\t\t\t\t// previous non-whitespace character code\n\t\t\t\t\t\tif (code !== SPACE && code !== TAB) {\n\t\t\t\t\t\t\tpeak = code\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// tail character codes\n\t\t\ttrail = tail\n\t\t\ttail = code\n\n\t\t\t// visit every character\n\t\t\tcaret++\n\t\t}\n\n\t\tlength = out.length\n\n\t\t// preserve empty selector\n \t\tif (preserve > 0) {\n \t\t\tif (length === 0 && children.length === 0 && (current[0].length === 0) === false) {\n \t\t\t\tif (id !== MEDIA || (current.length === 1 && (cascade > 0 ? nscopealt : nscope) === current[0])) {\n\t\t\t\t\tlength = current.join(',').length + 2\n \t\t\t\t}\n \t\t\t}\n\t\t}\n\n\t\tif (length > 0) {\n\t\t\t// cascade isolation mode?\n\t\t\tselector = cascade === 0 && id !== KEYFRAME ? isolate(current) : current\n\n\t\t\t// execute plugins, block context\n\t\t\tif (plugged > 0) {\n\t\t\t\tresult = proxy(BLCKS, out, selector, parent, line, column, length, id, depth, id)\n\n\t\t\t\tif (result !== void 0 && (out = result).length === 0) {\n\t\t\t\t\treturn flat + out + children\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tout = selector.join(',') + '{' + out + '}'\n\n\t\t\tif (prefix*pattern !== 0) {\n\t\t\t\tif (prefix === 2 && !vendor(out, 2))\n\t\t\t\t\tpattern = 0\n\n\t\t\t\tswitch (pattern) {\n\t\t\t\t\t// ::read-only\n\t\t\t\t\tcase READONLY: {\n\t\t\t\t\t\tout = out.replace(readonlyptn, ':'+moz+'$1')+out\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\t// ::placeholder\n\t\t\t\t\tcase PLACEHOLDER: {\n\t\t\t\t\t\tout = (\n\t\t\t\t\t\t\tout.replace(plcholdrptn, '::' + webkit + 'input-$1') +\n\t\t\t\t\t\t\tout.replace(plcholdrptn, '::' + moz + '$1') +\n\t\t\t\t\t\t\tout.replace(plcholdrptn, ':' + ms + 'input-$1') + out\n\t\t\t\t\t\t)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tpattern = 0\n\t\t\t}\n\t\t}\n\n\t\treturn flat + out + children\n\t}\n\n\t/**\n\t * Select\n\t *\n\t * @param {Array<string>} parent\n\t * @param {string} current\n\t * @param {number} invert\n\t * @return {Array<string>}\n\t */\n\tfunction select (parent, current, invert) {\n\t\tvar selectors = current.trim().split(selectorptn)\n\t\tvar out = selectors\n\n\t\tvar length = selectors.length\n\t\tvar l = parent.length\n\n\t\tswitch (l) {\n\t\t\t// 0-1 parent selectors\n\t\t\tcase 0:\n\t\t\tcase 1: {\n\t\t\t\tfor (var i = 0, selector = l === 0 ? '' : parent[0] + ' '; i < length; ++i) {\n\t\t\t\t\tout[i] = scope(selector, out[i], invert, l).trim()\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\t// >2 parent selectors, nested\n\t\t\tdefault: {\n\t\t\t\tfor (var i = 0, j = 0, out = []; i < length; ++i) {\n\t\t\t\t\tfor (var k = 0; k < l; ++k) {\n\t\t\t\t\t\tout[j++] = scope(parent[k] + ' ', selectors[i], invert, l).trim()\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn out\n\t}\n\n\t/**\n\t * Scope\n\t *\n\t * @param {string} parent\n\t * @param {string} current\n\t * @param {number} invert\n\t * @param {number} level\n\t * @return {string}\n\t */\n\tfunction scope (parent, current, invert, level) {\n\t\tvar selector = current\n\t\tvar code = selector.charCodeAt(0)\n\n\t\t// trim leading whitespace\n\t\tif (code < 33) {\n\t\t\tcode = (selector = selector.trim()).charCodeAt(0)\n\t\t}\n\n\t\tswitch (code) {\n\t\t\t// &\n\t\t\tcase AND: {\n\t\t\t\tswitch (cascade + level) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\tcase 1: {\n\t\t\t\t\t\tif (parent.trim().length === 0) {\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\treturn selector.replace(andptn, '$1'+parent.trim())\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\t// :\n\t\t\tcase COLON: {\n\t\t\t\tswitch (selector.charCodeAt(1)) {\n\t\t\t\t\t// g in :global\n\t\t\t\t\tcase 103: {\n\t\t\t\t\t\tif (escape > 0 && cascade > 0) {\n\t\t\t\t\t\t\treturn selector.replace(escapeptn, '$1').replace(andptn, '$1'+nscope)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\t// :hover\n\t\t\t\t\t\treturn parent.trim() + selector.replace(andptn, '$1'+parent.trim())\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\t// html &\n\t\t\t\tif (invert*cascade > 0 && selector.indexOf('\\f') > 0) {\n\t\t\t\t\treturn selector.replace(andptn, (parent.charCodeAt(0) === COLON ? '' : '$1')+parent.trim())\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn parent + selector\n\t}\n\n\t/**\n\t * Property\n\t *\n\t * @param {string} input\n\t * @param {number} first\n\t * @param {number} second\n\t * @param {number} third\n\t * @return {string}\n\t */\n\tfunction property (input, first, second, third) {\n\t\tvar index = 0\n\t\tvar out = input + ';'\n\t\tvar hash = (first*2) + (second*3) + (third*4)\n\t\tvar cache\n\n\t\t// animation: a, n, i characters\n\t\tif (hash === 944) {\n\t\t\treturn animation(out)\n\t\t} else if (prefix === 0 || (prefix === 2 && !vendor(out, 1))) {\n\t\t\treturn out\n\t\t}\n\n\t\t// vendor prefix\n\t\tswitch (hash) {\n\t\t\t// text-decoration/text-size-adjust/text-shadow/text-align/text-transform: t, e, x\n\t\t\tcase 1015: {\n\t\t\t\t// text-shadow/text-align/text-transform, a\n\t\t\t\treturn out.charCodeAt(10) === 97 ? webkit + out + out : out\n\t\t\t}\n\t\t\t// filter/fill f, i, l\n\t\t\tcase 951: {\n\t\t\t\t// filter, t\n\t\t\t\treturn out.charCodeAt(3) === 116 ? webkit + out + out : out\n\t\t\t}\n\t\t\t// color/column, c, o, l\n\t\t\tcase 963: {\n\t\t\t\t// column, n\n\t\t\t\treturn out.charCodeAt(5) === 110 ? webkit + out + out : out\n\t\t\t}\n\t\t\t// box-decoration-break, b, o, x\n\t\t\tcase 1009: {\n\t\t\t\tif (out.charCodeAt(4) !== 100) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\t// mask, m, a, s\n\t\t\t// clip-path, c, l, i\n\t\t\tcase 969:\n\t\t\tcase 942: {\n\t\t\t\treturn webkit + out + out\n\t\t\t}\n\t\t\t// appearance: a, p, p\n\t\t\tcase 978: {\n\t\t\t\treturn webkit + out + moz + out + out\n\t\t\t}\n\t\t\t// hyphens: h, y, p\n\t\t\t// user-select: u, s, e\n\t\t\tcase 1019:\n\t\t\tcase 983: {\n\t\t\t\treturn webkit + out + moz + out + ms + out + out\n\t\t\t}\n\t\t\t// background/backface-visibility, b, a, c\n\t\t\tcase 883: {\n\t\t\t\t// backface-visibility, -\n\t\t\t\tif (out.charCodeAt(8) === DASH) {\n\t\t\t\t\treturn webkit + out + out\n\t\t\t\t}\n\n\t\t\t\t// image-set(...)\n\t\t\t\tif (out.indexOf('image-set(', 11) > 0) {\n\t\t\t\t\treturn out.replace(imgsrcptn, '$1'+webkit+'$2') + out\n\t\t\t\t}\n\n\t\t\t\treturn out\n\t\t\t}\n\t\t\t// flex: f, l, e\n\t\t\tcase 932: {\n\t\t\t\tif (out.charCodeAt(4) === DASH) {\n\t\t\t\t\tswitch (out.charCodeAt(5)) {\n\t\t\t\t\t\t// flex-grow, g\n\t\t\t\t\t\tcase 103: {\n\t\t\t\t\t\t\treturn webkit + 'box-' + out.replace('-grow', '') + webkit + out + ms + out.replace('grow', 'positive') + out\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// flex-shrink, s\n\t\t\t\t\t\tcase 115: {\n\t\t\t\t\t\t\treturn webkit + out + ms + out.replace('shrink', 'negative') + out\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// flex-basis, b\n\t\t\t\t\t\tcase 98: {\n\t\t\t\t\t\t\treturn webkit + out + ms + out.replace('basis', 'preferred-size') + out\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn webkit + out + ms + out + out\n\t\t\t}\n\t\t\t// order: o, r, d\n\t\t\tcase 964: {\n\t\t\t\treturn webkit + out + ms + 'flex' + '-' + out + out\n\t\t\t}\n\t\t\t// justify-items/justify-content, j, u, s\n\t\t\tcase 1023: {\n\t\t\t\t// justify-content, c\n\t\t\t\tif (out.charCodeAt(8) !== 99) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tcache = out.substring(out.indexOf(':', 15)).replace('flex-', '').replace('space-between', 'justify')\n\t\t\t\treturn webkit + 'box-pack' + cache + webkit + out + ms + 'flex-pack' + cache + out\n\t\t\t}\n\t\t\t// cursor, c, u, r\n\t\t\tcase 1005: {\n\t\t\t\treturn cursorptn.test(out) ? out.replace(colonptn, ':' + webkit) + out.replace(colonptn, ':' + moz) + out : out\n\t\t\t}\n\t\t\t// writing-mode, w, r, i\n\t\t\tcase 1000: {\n\t\t\t\tcache = out.substring(13).trim()\n\t\t\t\tindex = cache.indexOf('-') + 1\n\n\t\t\t\tswitch (cache.charCodeAt(0)+cache.charCodeAt(index)) {\n\t\t\t\t\t// vertical-lr\n\t\t\t\t\tcase 226: {\n\t\t\t\t\t\tcache = out.replace(writingptn, 'tb')\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\t// vertical-rl\n\t\t\t\t\tcase 232: {\n\t\t\t\t\t\tcache = out.replace(writingptn, 'tb-rl')\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\t// horizontal-tb\n\t\t\t\t\tcase 220: {\n\t\t\t\t\t\tcache = out.replace(writingptn, 'lr')\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\treturn out\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn webkit + out + ms + cache + out\n\t\t\t}\n\t\t\t// position: sticky\n\t\t\tcase 1017: {\n\t\t\t\tif (out.indexOf('sticky', 9) === -1) {\n\t\t\t\t\treturn out\n\t\t\t\t}\n\t\t\t}\n\t\t\t// display(flex/inline-flex/inline-box): d, i, s\n\t\t\tcase 975: {\n\t\t\t\tindex = (out = input).length - 10\n\t\t\t\tcache = (out.charCodeAt(index) === 33 ? out.substring(0, index) : out).substring(input.indexOf(':', 7) + 1).trim()\n\n\t\t\t\tswitch (hash = cache.charCodeAt(0) + (cache.charCodeAt(7)|0)) {\n\t\t\t\t\t// inline-\n\t\t\t\t\tcase 203: {\n\t\t\t\t\t\t// inline-box\n\t\t\t\t\t\tif (cache.charCodeAt(8) < 111) {\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// inline-box/sticky\n\t\t\t\t\tcase 115: {\n\t\t\t\t\t\tout = out.replace(cache, webkit+cache)+';'+out\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\t// inline-flex\n\t\t\t\t\t// flex\n\t\t\t\t\tcase 207:\n\t\t\t\t\tcase 102: {\n\t\t\t\t\t\tout = (\n\t\t\t\t\t\t\tout.replace(cache, webkit+(hash > 102 ? 'inline-' : '')+'box')+';'+\n\t\t\t\t\t\t\tout.replace(cache, webkit+cache)+';'+\n\t\t\t\t\t\t\tout.replace(cache, ms+cache+'box')+';'+\n\t\t\t\t\t\t\tout\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn out + ';'\n\t\t\t}\n\t\t\t// align-items, align-center, align-self: a, l, i, -\n\t\t\tcase 938: {\n\t\t\t\tif (out.charCodeAt(5) === DASH) {\n\t\t\t\t\tswitch (out.charCodeAt(6)) {\n\t\t\t\t\t\t// align-items, i\n\t\t\t\t\t\tcase 105: {\n\t\t\t\t\t\t\tcache = out.replace('-items', '')\n\t\t\t\t\t\t\treturn webkit + out + webkit + 'box-' + cache + ms + 'flex-' + cache + out\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// align-self, s\n\t\t\t\t\t\tcase 115: {\n\t\t\t\t\t\t\treturn webkit + out + ms + 'flex-item-' + out.replace(selfptn, '') + out\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// align-content\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\treturn webkit + out + ms + 'flex-line-pack' + out.replace('align-content', '').replace(selfptn, '') + out\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\t// min/max\n\t\t\tcase 973:\n\t\t\tcase 989: {\n\t\t\t\t// min-/max- height/width/block-size/inline-size\n\t\t\t\tif (out.charCodeAt(3) !== DASH || out.charCodeAt(4) === 122) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\t// height/width: min-content / width: max-content\n\t\t\tcase 931:\n\t\t\tcase 953: {\n\t\t\t\tif (dimensionptn.test(input) === true) {\n\t\t\t\t\t// stretch\n\t\t\t\t\tif ((cache = input.substring(input.indexOf(':') + 1)).charCodeAt(0) === 115)\n\t\t\t\t\t\treturn property(input.replace('stretch', 'fill-available'), first, second, third).replace(':fill-available', ':stretch')\n\t\t\t\t\telse\n\t\t\t\t\t\treturn out.replace(cache, webkit + cache) + out.replace(cache, moz + cache.replace('fill-', '')) + out\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\t// transform, transition: t, r, a\n\t\t\tcase 962: {\n\t\t\t\tout = webkit + out + (out.charCodeAt(5) === 102 ? ms + out : '') + out\n\n\t\t\t\t// transitions\n\t\t\t\tif (second + third === 211 && out.charCodeAt(13) === 105 && out.indexOf('transform', 10) > 0) {\n\t\t\t\t\treturn out.substring(0, out.indexOf(';', 27) + 1).replace(transformptn, '$1' + webkit + '$2') + out\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\treturn out\n\t}\n\n\t/**\n\t * Vendor\n\t *\n\t * @param {string} content\n\t * @param {number} context\n\t * @return {boolean}\n\t */\n\tfunction vendor (content, context) {\n\t\tvar index = content.indexOf(context === 1 ? ':' : '{')\n\t\tvar key = content.substring(0, context !== 3 ? index : 10)\n\t\tvar value = content.substring(index + 1, content.length - 1)\n\n\t\treturn should(context !== 2 ? key : key.replace(pseudofmt, '$1'), value, context)\n\t}\n\n\t/**\n\t * Supports\n\t *\n\t * @param {string} match\n\t * @param {string} group\n\t * @return {string}\n\t */\n\tfunction supports (match, group) {\n\t\tvar out = property(group, group.charCodeAt(0), group.charCodeAt(1), group.charCodeAt(2))\n\n\t\treturn out !== group+';' ? out.replace(propertyptn, ' or ($1)').substring(4) : '('+group+')'\n\t}\n\n\t/**\n\t * Animation\n\t *\n\t * @param {string} input\n\t * @return {string}\n\t */\n\tfunction animation (input) {\n\t\tvar length = input.length\n\t\tvar index = input.indexOf(':', 9) + 1\n\t\tvar declare = input.substring(0, index).trim()\n\t\tvar out = input.substring(index, length-1).trim()\n\n\t\tswitch (input.charCodeAt(9)*keyed) {\n\t\t\tcase 0: {\n\t\t\t\tbreak\n\t\t\t}\n\t\t\t// animation-*, -\n\t\t\tcase DASH: {\n\t\t\t\t// animation-name, n\n\t\t\t\tif (input.charCodeAt(10) !== 110) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\t// animation/animation-name\n\t\t\tdefault: {\n\t\t\t\t// split in case of multiple animations\n\t\t\t\tvar list = out.split((out = '', animationptn))\n\n\t\t\t\tfor (var i = 0, index = 0, length = list.length; i < length; index = 0, ++i) {\n\t\t\t\t\tvar value = list[i]\n\t\t\t\t\tvar items = value.split(propertiesptn)\n\n\t\t\t\t\twhile (value = items[index]) {\n\t\t\t\t\t\tvar peak = value.charCodeAt(0)\n\n\t\t\t\t\t\tif (keyed === 1 && (\n\t\t\t\t\t\t\t// letters\n\t\t\t\t\t\t\t(peak > AT && peak < 90) || (peak > 96 && peak < 123) || peak === UNDERSCORE ||\n\t\t\t\t\t\t\t// dash but not in sequence i.e --\n\t\t\t\t\t\t\t(peak === DASH && value.charCodeAt(1) !== DASH)\n\t\t\t\t\t\t)) {\n\t\t\t\t\t\t\t// not a number/function\n\t\t\t\t\t\t\tswitch (isNaN(parseFloat(value)) + (value.indexOf('(') !== -1)) {\n\t\t\t\t\t\t\t\tcase 1: {\n\t\t\t\t\t\t\t\t\tswitch (value) {\n\t\t\t\t\t\t\t\t\t\t// not a valid reserved keyword\n\t\t\t\t\t\t\t\t\t\tcase 'infinite': case 'alternate': case 'backwards': case 'running':\n\t\t\t\t\t\t\t\t\t\tcase 'normal': case 'forwards': case 'both': case 'none': case 'linear':\n\t\t\t\t\t\t\t\t\t\tcase 'ease': case 'ease-in': case 'ease-out': case 'ease-in-out':\n\t\t\t\t\t\t\t\t\t\tcase 'paused': case 'reverse': case 'alternate-reverse': case 'inherit':\n\t\t\t\t\t\t\t\t\t\tcase 'initial': case 'unset': case 'step-start': case 'step-end': {\n\t\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\t\t\t\tvalue += key\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titems[index++] = value\n\t\t\t\t\t}\n\n\t\t\t\t\tout += (i === 0 ? '' : ',') + items.join(' ')\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tout = declare + out + ';'\n\n\t\tif (prefix === 1 || (prefix === 2 && vendor(out, 1)))\n\t\t\treturn webkit + out + out\n\n\t\treturn out\n\t}\n\n\t/**\n\t * Isolate\n\t *\n\t * @param {Array<string>} current\n\t */\n\tfunction isolate (current) {\n\t\tfor (var i = 0, length = current.length, selector = Array(length), padding, element; i < length; ++i) {\n\t\t\t// split individual elements in a selector i.e h1 h2 === [h1, h2]\n\t\t\tvar elements = current[i].split(elementptn)\n\t\t\tvar out = ''\n\n\t\t\tfor (var j = 0, size = 0, tail = 0, code = 0, l = elements.length; j < l; ++j) {\n\t\t\t\t// empty element\n\t\t\t\tif ((size = (element = elements[j]).length) === 0 && l > 1) {\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\n\t\t\t\ttail = out.charCodeAt(out.length-1)\n\t\t\t\tcode = element.charCodeAt(0)\n\t\t\t\tpadding = ''\n\n\t\t\t\tif (j !== 0) {\n\t\t\t\t\t// determine if we need padding\n\t\t\t\t\tswitch (tail) {\n\t\t\t\t\t\tcase STAR:\n\t\t\t\t\t\tcase TILDE:\n\t\t\t\t\t\tcase GREATERTHAN:\n\t\t\t\t\t\tcase PLUS:\n\t\t\t\t\t\tcase SPACE:\n\t\t\t\t\t\tcase OPENPARENTHESES:  {\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\tpadding = ' '\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tswitch (code) {\n\t\t\t\t\tcase AND: {\n\t\t\t\t\t\telement = padding + nscopealt\n\t\t\t\t\t}\n\t\t\t\t\tcase TILDE:\n\t\t\t\t\tcase GREATERTHAN:\n\t\t\t\t\tcase PLUS:\n\t\t\t\t\tcase SPACE:\n\t\t\t\t\tcase CLOSEPARENTHESES:\n\t\t\t\t\tcase OPENPARENTHESES: {\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase OPENBRACKET: {\n\t\t\t\t\t\telement = padding + element + nscopealt\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase COLON: {\n\t\t\t\t\t\tswitch (element.charCodeAt(1)*2 + element.charCodeAt(2)*3) {\n\t\t\t\t\t\t\t// :global\n\t\t\t\t\t\t\tcase 530: {\n\t\t\t\t\t\t\t\tif (escape > 0) {\n\t\t\t\t\t\t\t\t\telement = padding + element.substring(8, size - 1)\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// :hover, :nth-child(), ...\n\t\t\t\t\t\t\tdefault: {\n\t\t\t\t\t\t\t\tif (j < 1 || elements[j-1].length < 1) {\n\t\t\t\t\t\t\t\t\telement = padding + nscopealt + element\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tcase COMMA: {\n\t\t\t\t\t\tpadding = ''\n\t\t\t\t\t}\n\t\t\t\t\tdefault: {\n\t\t\t\t\t\tif (size > 1 && element.indexOf(':') > 0) {\n\t\t\t\t\t\t\telement = padding + element.replace(pseudoptn, '$1' + nscopealt + '$2')\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\telement = padding + element + nscopealt\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tout += element\n\t\t\t}\n\n\t\t\tselector[i] = out.replace(formatptn, '').trim()\n\t\t}\n\n\t\treturn selector\n\t}\n\n\t/**\n\t * Proxy\n\t *\n\t * @param {number} context\n\t * @param {string} content\n\t * @param {Array<string>} selectors\n\t * @param {Array<string>} parents\n\t * @param {number} line\n\t * @param {number} column\n\t * @param {number} length\n\t * @param {number} id\n\t * @param {number} depth\n\t * @param {number} at\n\t * @return {(string|void|*)}\n\t */\n\tfunction proxy (context, content, selectors, parents, line, column, length, id, depth, at) {\n\t\tfor (var i = 0, out = content, next; i < plugged; ++i) {\n\t\t\tswitch (next = plugins[i].call(stylis, context, out, selectors, parents, line, column, length, id, depth, at)) {\n\t\t\t\tcase void 0:\n\t\t\t\tcase false:\n\t\t\t\tcase true:\n\t\t\t\tcase null: {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\tdefault: {\n\t\t\t\t\tout = next\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (out !== content) {\n\t\t  return out\n\t\t}\n\t}\n\n\t/**\n\t * @param {number} code\n\t * @param {number} index\n\t * @param {number} length\n\t * @param {string} body\n\t * @return {number}\n\t */\n\tfunction delimited (code, index, length, body) {\n\t\tfor (var i = index + 1; i < length; ++i) {\n\t\t\tswitch (body.charCodeAt(i)) {\n\t\t\t\t// /*\n\t\t\t\tcase FOWARDSLASH: {\n\t\t\t\t\tif (code === STAR) {\n\t\t\t\t\t\tif (body.charCodeAt(i - 1) === STAR &&  index + 2 !== i) {\n\t\t\t\t\t\t\treturn i + 1\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\t// //\n\t\t\t\tcase NEWLINE: {\n\t\t\t\t\tif (code === FOWARDSLASH) {\n\t\t\t\t\t\treturn i + 1\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn i\n\t}\n\n\t/**\n\t * @param {number} type\n\t * @param {number} index\n\t * @param {number} length\n\t * @param {number} find\n\t * @param {string} body\n\t * @return {number}\n\t */\n\tfunction match (type, index, length, body) {\n\t\tfor (var i = index + 1; i < length; ++i) {\n\t\t\tswitch (body.charCodeAt(i)) {\n\t\t\t\tcase type: {\n\t\t\t\t\treturn i\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn i\n\t}\n\n\t/**\n\t * Minify\n\t *\n\t * @param {(string|*)} output\n\t * @return {string}\n\t */\n\tfunction minify (output) {\n\t\treturn output\n\t\t\t.replace(formatptn, '')\n\t\t\t.replace(beforeptn, '')\n\t\t\t.replace(afterptn, '$1')\n\t\t\t.replace(tailptn, '$1')\n\t\t\t.replace(whiteptn, ' ')\n\t}\n\n\t/**\n\t * Use\n\t *\n\t * @param {(Array<function(...?)>|function(...?)|number|void)?} plugin\n\t */\n\tfunction use (plugin) {\n\t\tswitch (plugin) {\n\t\t\tcase void 0:\n\t\t\tcase null: {\n\t\t\t\tplugged = plugins.length = 0\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tdefault: {\n\t\t\t\tif (typeof plugin === 'function') {\n\t\t\t\t\tplugins[plugged++] = plugin\n\t\t\t\t}\telse if (typeof plugin === 'object') {\n\t\t\t\t\tfor (var i = 0, length = plugin.length; i < length; ++i) {\n\t\t\t\t\t\tuse(plugin[i])\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tunkwn = !!plugin|0\n\t\t\t\t}\n\t\t\t}\n \t\t}\n\n \t\treturn use\n\t}\n\n\t/**\n\t * Set\n\t *\n\t * @param {*} options\n\t */\n\tfunction set (options) {\n\t\tfor (var name in options) {\n\t\t\tvar value = options[name]\n\t\t\tswitch (name) {\n\t\t\t\tcase 'keyframe': keyed = value|0; break\n\t\t\t\tcase 'global': escape = value|0; break\n\t\t\t\tcase 'cascade': cascade = value|0; break\n\t\t\t\tcase 'compress': compress = value|0; break\n\t\t\t\tcase 'semicolon': semicolon = value|0; break\n\t\t\t\tcase 'preserve': preserve = value|0; break\n\t\t\t\tcase 'prefix':\n\t\t\t\t\tshould = null\n\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\tprefix = 0\n\t\t\t\t\t} else if (typeof value !== 'function') {\n\t\t\t\t\t\tprefix = 1\n\t\t\t\t\t} else {\n\t\t\t\t\t\tprefix = 2\n\t\t\t\t\t\tshould = value\n\t\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn set\n\t}\n\n\t/**\n\t * Stylis\n\t *\n\t * @param {string} selector\n\t * @param {string} input\n\t * @return {*}\n\t */\n\tfunction stylis (selector, input) {\n\t\tif (this !== void 0 && this.constructor === stylis) {\n\t\t\treturn factory(selector)\n\t\t}\n\n\t\t// setup\n\t\tvar ns = selector\n\t\tvar code = ns.charCodeAt(0)\n\n\t\t// trim leading whitespace\n\t\tif (code < 33) {\n\t\t\tcode = (ns = ns.trim()).charCodeAt(0)\n\t\t}\n\n\t\t// keyframe/animation namespace\n\t\tif (keyed > 0) {\n\t\t\tkey = ns.replace(invalidptn, code === OPENBRACKET ? '' : '-')\n\t\t}\n\n\t\t// reset, used to assert if a plugin is moneky-patching the return value\n\t\tcode = 1\n\n\t\t// cascade/isolate\n\t\tif (cascade === 1) {\n\t\t\tnscope = ns\n\t\t} else {\n\t\t\tnscopealt = ns\n\t\t}\n\n\t\tvar selectors = [nscope]\n\t\tvar result\n\n\t\t// execute plugins, pre-process context\n\t\tif (plugged > 0) {\n\t\t\tresult = proxy(PREPS, input, selectors, selectors, line, column, 0, 0, 0, 0)\n\n\t\t\tif (result !== void 0 && typeof result === 'string') {\n\t\t\t\tinput = result\n\t\t\t}\n\t\t}\n\n\t\t// build\n\t\tvar output = compile(array, selectors, input, 0, 0)\n\n\t\t// execute plugins, post-process context\n\t\tif (plugged > 0) {\n\t\t\tresult = proxy(POSTS, output, selectors, selectors, line, column, output.length, 0, 0, 0)\n\n\t\t\t// bypass minification\n\t\t\tif (result !== void 0 && typeof(output = result) !== 'string') {\n\t\t\t\tcode = 0\n\t\t\t}\n\t\t}\n\n\t\t// reset\n\t\tkey = ''\n\t\tnscope = ''\n\t\tnscopealt = ''\n\t\tpattern = 0\n\t\tline = 1\n\t\tcolumn = 1\n\n\t\treturn compress*code === 0 ? output : minify(output)\n\t}\n\n\tstylis['use'] = use\n\tstylis['set'] = set\n\n\tif (options !== void 0) {\n\t\tset(options)\n\t}\n\n\treturn stylis\n}));\n","var simpleIsEqual = function simpleIsEqual(a, b) {\n  return a === b;\n};\n\nfunction index (resultFn, isEqual) {\n  if (isEqual === void 0) {\n    isEqual = simpleIsEqual;\n  }\n\n  var lastThis;\n  var lastArgs = [];\n  var lastResult;\n  var calledOnce = false;\n\n  var isNewArgEqualToLast = function isNewArgEqualToLast(newArg, index) {\n    return isEqual(newArg, lastArgs[index]);\n  };\n\n  var result = function result() {\n    for (var _len = arguments.length, newArgs = new Array(_len), _key = 0; _key < _len; _key++) {\n      newArgs[_key] = arguments[_key];\n    }\n\n    if (calledOnce && lastThis === this && newArgs.length === lastArgs.length && newArgs.every(isNewArgEqualToLast)) {\n      return lastResult;\n    }\n\n    lastResult = resultFn.apply(this, newArgs);\n    calledOnce = true;\n    lastThis = this;\n    lastArgs = newArgs;\n    return lastResult;\n  };\n\n  return result;\n}\n\nexport default index;\n","import * as React from 'react';\nimport { Matrix4x4 } from '../utils/linalg';\n\nimport ImageLayer from '../layers/ImageLayer';\nimport TextLayer from '../layers/TextLayer';\nimport MouseLayer from '../layers/MouseLayer';\nimport { Input as ImageInput } from '../layers/Layer';\n\nimport styled from 'styled-components';\n\nconst StretchingCanvas = styled.canvas`\n  position: absolute;\n  top: 0; bottom: 0;\n  left: 0; right: 0;\n  width: 100%; height: 100%;\n`;\nconst StretchingDiv = styled.div`\n  position: absolute;\n  top: 0; bottom: 0;\n  left: 0; right: 0;\n  width: 100%; height: 100%;\n`;\n\nexport interface ImageFrameProps {\n    image: ImageInput;\n    viewTransform: number;\n    clearColor: number[];\n    exposure: number;\n    gamma: number;\n    offset: number;\n    allowMovement: boolean;\n    /** Optional callback to be called when the mouse moves */\n    onPoint?: (x: number, y: number) => void;\n    /** Optional callback to be called when the canvas is panned or zoomed */\n    onTransform?: (transformation: Matrix4x4) => void;\n    enableMouseEvents: boolean;\n}\n\n/**\n * An image frame that deals with mouse movement for padding and zooming\n */\nexport default class ImageFrame extends React.Component<ImageFrameProps, {}> {\n  private imageLayerElement: HTMLCanvasElement;\n  private textLayerElement: HTMLCanvasElement;\n  private mouseLayerElement: HTMLCanvasElement;\n\n  private imageLayer: ImageLayer;\n  private textLayer: TextLayer;\n  private mouseLayer: MouseLayer;\n\n  private transformation: Matrix4x4 = Matrix4x4.create();\n\n  /** Where to go back when reset() is called */\n  private defaultTransformation: Matrix4x4 = Matrix4x4.create();\n\n  constructor(props: ImageFrameProps) {\n    super(props);\n    this.handleTransformationChange = this.handleTransformationChange.bind(this);\n  }\n\n  componentDidMount() {\n    this.imageLayer = new ImageLayer(this.imageLayerElement, this.props.image);\n    this.textLayer = new TextLayer(this.textLayerElement, this.props.image);\n    this.mouseLayer = new MouseLayer(this.mouseLayerElement, this.props.image, this.props.enableMouseEvents);\n\n    if (this.props.clearColor) {\n      this.imageLayer.setClearColor(this.props.clearColor);\n    }\n\n    this.mouseLayer.onTransformationChange(this.handleTransformationChange);\n\n    this.updateCanvasProps();\n    this.handleTransformationChange(this.transformation);\n  }\n\n  componentDidUpdate(prevProps: ImageFrameProps) {\n    this.updateCanvasProps(prevProps);\n    this.mouseLayer.setEnableMouseEvents(this.props.enableMouseEvents);\n  }\n\n  componentWillUnmount() {\n    this.mouseLayer.onPointAt(undefined);\n    this.mouseLayer.onTransformationChange(undefined);\n    this.mouseLayer.destruct();\n  }\n\n  /** Set the default transformation that calling reset() will result in */\n  setDefaultTransformation(transformation: Matrix4x4) {\n    this.defaultTransformation = transformation;\n  }\n\n  reset() {\n    this.handleTransformationChange(this.defaultTransformation);\n  }\n\n  setTransformation(transformation: Matrix4x4) {\n    this.handleTransformationChange(transformation);\n  }\n\n  getTransformation(): Matrix4x4 {\n    return this.transformation;\n  }\n\n  render() {\n    return (\n      <StretchingDiv>\n        <StretchingCanvas ref={(x: HTMLCanvasElement) => this.imageLayerElement = x} />\n        <StretchingCanvas ref={(x: HTMLCanvasElement) => this.textLayerElement = x} />\n        <StretchingCanvas ref={(x: HTMLCanvasElement) => this.mouseLayerElement = x} />\n      </StretchingDiv>\n    );\n  }\n\n  private handleTransformationChange(transformation: Matrix4x4) {\n    if (this.props.allowMovement) {\n      this.transformation = transformation;\n      this.imageLayer.setTransformation(transformation);\n      this.textLayer.setTransformation(transformation);\n      this.mouseLayer.setTransformation(transformation);\n      if (this.props.onTransform != null) {\n        this.props.onTransform(transformation);\n      }\n    }\n  }\n\n  private updateCanvasProps(previousProps: ImageFrameProps | null = null) {\n    if (!previousProps ||\n        previousProps.viewTransform !== this.props.viewTransform ||\n        previousProps.exposure !== this.props.exposure ||\n        previousProps.gamma !== this.props.gamma ||\n        previousProps.offset !== this.props.offset) {\n      this.imageLayer.setTonemapping({\n        viewTransform: this.props.viewTransform,\n        exposure: this.props.exposure,\n        offset: this.props.offset,\n        gamma: this.props.gamma\n      });\n    }\n    if (!previousProps || previousProps.image !== this.props.image) {\n      this.imageLayer.setImage(this.props.image);\n      this.textLayer.setImage(this.props.image);\n      this.mouseLayer.setImage(this.props.image);\n    }\n    this.mouseLayer.onPointAt(this.props.onPoint);\n  }\n}\n","import { Matrix4x4 } from '../utils/linalg';\nimport { Image } from '../utils/image-loading';\nimport Layer, { Input, LossFunction } from './Layer';\n\nenum DrawMode {\n  LDR = 0,\n  HDR = 1,\n  ColorMap = 2,\n}\n\nenum ViewTransform {\n  None = -1,\n  Gamma22 = 0,\n  K1S1 = 1,\n}\n\nconst vertexShaderSource = `\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\nuniform mat4 viewMatrix;\nvoid main(void) {\n    gl_Position = viewMatrix * vec4(aVertexPosition, 1.0);\n    vTextureCoord = aTextureCoord;\n}`;\n\nconst fragmentShaderSource = `\nprecision mediump float;\nuniform int viewTransform;\nuniform float exposure;\nuniform float offset;\nuniform float gamma;\nuniform int mode;\nuniform int nChannels;\nuniform int lossFunction;\nuniform int imageHeight; // Height and width are used to access neighboring pixels\nuniform int imageWidth;\nvarying vec2 vTextureCoord;\nuniform sampler2D imASampler;\nuniform sampler2D imBSampler;\nuniform sampler2D cmapSampler;\n\nvec3 lookupOffset(sampler2D sampler, vec2 position, vec2 offset) {\n    // Read neighbouring pixels from an image texture\n    // Takes 'position' (range 0 - 1) and an integer pixel offset 'offset'\n    vec2 imageSize = vec2(imageWidth, imageHeight);\n    return texture2D(sampler, position + offset / imageSize).rgb;\n}\n\nfloat log10(float a) {\n  const float logBase10 = 1.0 / log2( 10.0 );\n\n  return log2(a) * logBase10;\n}\n\nfloat luminance(vec3 rgb) {\n  return dot(vec3(0.2126, 0.7152, 0.0722), rgb);\n}\n\nvec3 GOG(vec3 rgb, float gain, float offset, float gamma) {\n  return pow(gain * rgb + offset, vec3(1.0 / gamma));\n}\n\nfloat logEncodingLogC(float a) {\n  float LogC = a >= 0.01059106816664 ? 0.385537 + 0.2471896 * log10(a * 5.555556 + 0.052272) : a * 5.367655 + 0.092809;\n\n  return LogC;\n}\n\nfloat sigmoidK1S1(float a) {\n  float sigmoid = 1.0 / (1.0 + pow(2.718281828459045, -8.9 * (a - 0.435)));\n\n  return sigmoid;\n}\n\nvec3 viewTransformNone(vec3 rgb) {\n  return rgb;\n}\n\nvec3 viewTransformGamma22(vec3 rgb) {\n  const float exponent = 1.0 / 2.2;\n\n  return pow(max(rgb, 0.0), vec3(exponent, exponent, exponent));\n}\n\nvec3 viewTransformK1S1(vec3 rgb) {\n  vec3 LogC = vec3(logEncodingLogC(rgb.x), logEncodingLogC(rgb.y), logEncodingLogC(rgb.z));\n\n  return vec3(sigmoidK1S1(LogC.x), sigmoidK1S1(LogC.y), sigmoidK1S1(LogC.z));\n}\n\nvec3 applyViewTransform(vec3 rgb, int which) {\n  if (which == ${ViewTransform.None}) {\n    return viewTransformNone(rgb);\n  } else if (which == ${ViewTransform.Gamma22}) {\n    return viewTransformGamma22(rgb);\n  } else if (which == ${ViewTransform.K1S1}) {\n    return viewTransformK1S1(rgb);\n  }\n}\n\nvoid main(void) {\n    vec3 col;\n    vec2 position = vec2(vTextureCoord.s, vTextureCoord.t);\n    if (lossFunction == ${LossFunction.L1}) {\n        col = texture2D(imASampler, position).rgb;\n        col = col - texture2D(imBSampler, position).rgb;\n        col = abs(col);\n    } else if (lossFunction == ${LossFunction.MAPE}) {\n        vec3 img = texture2D(imASampler, position).rgb;\n        vec3 ref = texture2D(imBSampler, position).rgb;\n        vec3 diff = img - ref;\n        col = abs(diff) / (abs(ref) + 1e-2);\n    } else if (lossFunction == ${LossFunction.SMAPE}) {\n        vec3 img = texture2D(imASampler, position).rgb;\n        vec3 ref = texture2D(imBSampler, position).rgb;\n        vec3 diff = img - ref;\n        col = 2.0 * abs(diff) / (abs(ref) + abs(img) + 2e-2);\n    } else if (lossFunction == ${LossFunction.MRSE}) {\n        vec3 img = texture2D(imASampler, position).rgb;\n        vec3 ref = texture2D(imBSampler, position).rgb;\n        vec3 diff = img - ref;\n        col = diff * diff / (ref * ref + 1e-4);\n    } else if (lossFunction == ${LossFunction.L2}) {\n        vec3 img = texture2D(imASampler, position).rgb;\n        vec3 ref = texture2D(imBSampler, position).rgb;\n        vec3 diff = img - ref;\n        col = diff * diff;\n    } else if (lossFunction == ${LossFunction.SSIM}) {\n        const int windowRadius = 2; // We use a symmetric 5x5 window as opposed to the customary 8x8 (wiki)\n        const float L = 1.; // The dynamic range\n        const float k1 = 0.01, k2 = 0.03; // Default constants\n        const float c1 = (k1*L)*(k1*L), c2 = (k2*L)*(k2*L);\n        const float n = float((2 * windowRadius + 1) * (2 * windowRadius + 1));\n\n        // Compute means and standard deviations of both images\n        float aSum, aaSum, bSum, bbSum, abSum;\n        for (int x = 0; x <= 2 * windowRadius; ++x) {\n            for (int y = 0; y <= 2 * windowRadius; ++y) {\n                vec2 offset = vec2(float(x - windowRadius), float(y - windowRadius));\n                float a = luminance(applyViewTransform(lookupOffset(imASampler, position, offset), viewTransform));\n                float b = luminance(applyViewTransform(lookupOffset(imBSampler, position, offset), viewTransform));\n                aSum += a; bSum += b;\n                aaSum += a * a; bbSum += b * b;\n                abSum += a * b;\n            }\n        }\n        float aMean = aSum / n, bMean = bSum / n;\n        float aVar = (aaSum - n * aMean * aMean) / (n + 1.);\n        float bVar = (bbSum - n * bMean * bMean) / (n + 1.);\n        float abCovar = (abSum - n * aMean * bMean) / (n + 1.);\n\n        float numerator = (2. * aMean * bMean + c1) * (2. * abCovar + c2);\n        float denominator = (aMean * aMean + bMean * bMean + c1) * (aVar + bVar + c2);\n        float ssim = numerator / denominator;\n        col = vec3(1. - ssim, 1. - ssim, 1. - ssim);\n    } else {\n        col = texture2D(imASampler, position).rgb;\n        if (nChannels == 1) {\n            col = vec3(col.r, col.r, col.r);\n        }\n    }\n\n    if (mode == ${DrawMode.LDR}) {\n        col = pow(col, vec3(2.2));\n        col = GOG(col, exposure, offset, gamma);\n        col = applyViewTransform(col, viewTransform);\n    } else if (mode == ${DrawMode.HDR}) {\n        col = GOG(col, exposure, offset, gamma);\n        col = applyViewTransform(col, viewTransform);\n    } else {\n        float avg = (col.r + col.g + col.b) * 0.3333333333 * exposure;\n        col = texture2D(cmapSampler, vec2(avg, 0.0)).rgb;\n    }\n\n    gl_FragColor = vec4(col, 1.0);\n}`;\n\nconst imageVertices = new Float32Array([\n  // X   Y     Z      U    V\n  -1.0, -1.0,  0.0,   0.0, 1.0,\n  -1.0,  1.0,  0.0,   0.0, 0.0,\n   1.0, -1.0,  0.0,   1.0, 1.0,\n   1.0,  1.0,  0.0,   1.0, 0.0,\n]);\n\nconst colorMapTexels = new Uint8Array([\n  0, 0, 3, 255,\n  23, 15, 60, 255,\n  67, 15, 117, 255,\n  113, 31, 129, 255,\n  158, 46, 126, 255,\n  205, 63, 112, 255,\n  240, 96, 93, 255,\n  253, 149, 103, 255,\n  254, 201, 141, 255,\n  251, 252, 191, 255,\n]);\n\nfunction compileShader(code: string, type: number, gl: WebGLRenderingContext): WebGLShader {\n    const shader = gl.createShader(type);\n    if (!shader) {\n      throw new Error('Creating shader failed.');\n    }\n    gl.shaderSource(shader, code);\n    gl.compileShader(shader);\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      throw new Error(`Compiling shader failed with error '${gl.getShaderInfoLog(shader)}'.`);\n    }\n    return shader;\n}\n\ninterface WebGlAttributes {\n  vertexPosition: number;\n  vertexTextureCoordinate: number;\n}\n\ninterface WebGlUniforms {\n  drawMode: WebGLUniformLocation;\n  lossFunction: WebGLUniformLocation;\n  nChannels: WebGLUniformLocation;\n  viewMatrix: WebGLUniformLocation;\n  imASampler: WebGLUniformLocation;\n  imBSampler: WebGLUniformLocation;\n  cmapSampler: WebGLUniformLocation;\n  viewTransform: WebGLUniformLocation;\n  exposure: WebGLUniformLocation;\n  offset: WebGLUniformLocation;\n  gamma: WebGLUniformLocation;\n  imageWidth: WebGLUniformLocation;\n  imageHeight: WebGLUniformLocation;\n}\n\nexport interface TonemappingSettings {\n  viewTransform: number;\n  offset: number;\n  gamma: number;\n  exposure: number;\n}\nconst defaultTonemapping: TonemappingSettings = { viewTransform: 0.0, exposure: 1.0, gamma: 1.0, offset: 0.0 };\n\n/**\n * Image Layer\n */\nexport default class ImageLayer extends Layer {\n  private tonemappingSettings: TonemappingSettings = defaultTonemapping;\n\n  private needsRerender: boolean = true;\n\n  private gl: WebGLRenderingContext;\n  private glAttributes: WebGlAttributes;\n  private glUniforms: WebGlUniforms;\n  private quadVertexBuffer: WebGLBuffer;\n  private cmapTexture: WebGLTexture;\n  private textures: Map<string, WebGLTexture>;\n\n  constructor(canvas: HTMLCanvasElement, image: Input) {\n    super(canvas, image);\n\n    this.textures = new Map();\n\n    // Make sure 'this' is available even when these methods are passed as a callback\n    this.checkRender = this.checkRender.bind(this);\n    this.invalidate  = this.invalidate.bind(this);\n    this.getTexture = this.getTexture.bind(this);\n\n    this.initWebGl(canvas);\n\n    // Draw for the first time\n    this.needsRerender = true;\n    requestAnimationFrame(this.checkRender);\n  }\n\n  setTransformation(transformation: Matrix4x4) {\n    this.transformation = transformation;\n    this.invalidate();\n  }\n\n  setTonemapping(tonemapping: TonemappingSettings) {\n    this.tonemappingSettings = tonemapping;\n    this.invalidate();\n  }\n\n  setImage(image: Input) {\n    this.image = image;\n    this.invalidate();\n  }\n\n  setClearColor(color: number[]) {\n    if (this.gl) {\n      if (color.length === 3) {\n        this.gl.clearColor(color[0], color[1], color[2], 1.0);\n      } else if (color.length === 1) {\n        this.gl.clearColor(color[0], color[0], color[0], 1.0);\n      }\n    }\n  }\n\n  /**\n   * Force a new draw the next frame\n   */\n  invalidate() {\n    this.needsRerender = true;\n  }\n\n  /**\n   * Render loop, will draw when this component is invalidated with\n   * this.needsRerender = true;\n   * or when the size of the container changed\n   */\n  private checkRender() {\n    if (this.resize() || this.needsRerender) {\n      this.needsRerender = false;\n      this.draw();\n    }\n    requestAnimationFrame(this.checkRender);\n  }\n\n  /**\n   * Paint a new image\n   */\n  private draw() {\n    if (!this.cmapTexture) {\n      throw new Error('Textures need to be initialized before calling draw()');\n    }\n    this.gl.viewport(0, 0, this.gl.drawingBufferWidth, this.gl.drawingBufferHeight);\n\n    this.gl.uniform1i(this.glUniforms.viewTransform, this.tonemappingSettings.viewTransform);\n    this.gl.uniform1f(this.glUniforms.exposure, this.tonemappingSettings.exposure);\n    this.gl.uniform1f(this.glUniforms.offset, this.tonemappingSettings.offset);\n    this.gl.uniform1f(this.glUniforms.gamma, this.tonemappingSettings.gamma);\n\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT); // tslint:disable-line\n\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.quadVertexBuffer);\n    this.gl.vertexAttribPointer(\n      this.glAttributes.vertexPosition,\n      3,\n      this.gl.FLOAT,\n      false,\n      5 * imageVertices.BYTES_PER_ELEMENT,\n      0\n    );\n    this.gl.vertexAttribPointer(\n      this.glAttributes.vertexTextureCoordinate,\n      2,\n      this.gl.FLOAT,\n      false,\n      5 * imageVertices.BYTES_PER_ELEMENT, // stride\n      3 * imageVertices.BYTES_PER_ELEMENT  // offset\n    );\n\n    this.gl.uniform1i(this.glUniforms.imageHeight, this.image.height);\n    this.gl.uniform1i(this.glUniforms.imageWidth, this.image.width);\n\n    if (this.image.type === 'Difference') {\n      this.gl.uniform1i(this.glUniforms.drawMode, DrawMode.ColorMap);\n      this.gl.uniform1i(this.glUniforms.lossFunction, this.image.lossFunction);\n      this.gl.activeTexture(this.gl.TEXTURE0);\n      this.gl.bindTexture(this.gl.TEXTURE_2D, this.getTexture(this.image.imageA));\n      this.gl.uniform1i(this.glUniforms.imASampler, 0);\n      this.gl.activeTexture(this.gl.TEXTURE1);\n      this.gl.bindTexture(this.gl.TEXTURE_2D, this.getTexture(this.image.imageB));\n      this.gl.uniform1i(this.glUniforms.imBSampler, 1);\n    } else {\n      if (this.image.nChannels === 1) {\n        this.gl.uniform1i(this.glUniforms.drawMode, DrawMode.ColorMap);\n      } else if (this.image.type === 'HdrImage') {\n        this.gl.uniform1i(this.glUniforms.drawMode, DrawMode.HDR);\n      } else {\n        this.gl.uniform1i(this.glUniforms.drawMode, DrawMode.LDR);\n      }\n      this.gl.uniform1i(this.glUniforms.lossFunction, 0);\n      this.gl.activeTexture(this.gl.TEXTURE0);\n      this.gl.bindTexture(this.gl.TEXTURE_2D, this.getTexture(this.image));\n      this.gl.uniform1i(this.glUniforms.imASampler, 0);\n      this.gl.activeTexture(this.gl.TEXTURE1);\n      this.gl.bindTexture(this.gl.TEXTURE_2D, this.getTexture(this.image));\n      this.gl.uniform1i(this.glUniforms.imBSampler, 1);\n    }\n\n    this.gl.activeTexture(this.gl.TEXTURE2);\n    this.gl.bindTexture(this.gl.TEXTURE_2D, this.cmapTexture);\n    this.gl.uniform1i(this.glUniforms.cmapSampler, 2);\n\n    this.gl.uniform1i(this.glUniforms.nChannels, this.image.nChannels);\n\n    const viewMatrix = this.getViewMatrix();\n    this.gl.uniformMatrix4fv(this.glUniforms.viewMatrix, false, viewMatrix.data);\n    this.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 4);\n  }\n\n  private initWebGl(canvas: HTMLCanvasElement) {\n    this.gl = canvas.getContext('webgl') as WebGLRenderingContext;\n\n    if (!this.gl) {\n      throw new Error('Please upgrade your browser to one that supports WebGL.');\n    }\n\n    if (!this.gl.getExtension('OES_texture_float')) {\n      throw new Error('Your browser does not supports WebGL FLoating Point Textures.');\n    }\n\n    this.gl.clearColor(0.25, 0.25, 0.25, 1.0);\n    this.gl.enable(this.gl.DEPTH_TEST);\n\n    const program = this.initShaders();\n    this.quadVertexBuffer = this.initQuadVertexBuffer();\n    this.glAttributes = this.initAttributes(program);\n    this.glUniforms = this.initUniforms(program);\n    this.cmapTexture = this.initCmapTexture();\n  }\n\n  private initShaders(): WebGLProgram {\n    const vertexShader = compileShader(vertexShaderSource, this.gl.VERTEX_SHADER, this.gl);\n    const fragmentShader = compileShader(fragmentShaderSource, this.gl.FRAGMENT_SHADER, this.gl);\n\n    const program = this.gl.createProgram();\n    if (!program) {\n      throw new Error('Creating program failed.');\n    }\n    this.gl.attachShader(program, vertexShader);\n    this.gl.attachShader(program, fragmentShader);\n    this.gl.linkProgram(program);\n    if (!this.gl.getProgramParameter(program, this.gl.LINK_STATUS)) {\n      throw new Error(`Linking program failed with error '${this.gl.getProgramInfoLog(program)}'.`);\n    }\n    this.gl.useProgram(program);\n    return program;\n  }\n\n  private initCmapTexture(): WebGLTexture {\n    const cmapTexture = this.gl.createTexture();\n    this.gl.bindTexture(this.gl.TEXTURE_2D, cmapTexture);\n    this.gl.texImage2D(\n      this.gl.TEXTURE_2D,\n      0,\n      this.gl.RGBA,\n      colorMapTexels.length / 4,\n      1,\n      0,\n      this.gl.RGBA,\n      this.gl.UNSIGNED_BYTE,\n      colorMapTexels\n    );\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n    if (!cmapTexture) {\n      throw new Error('Failed to initialize color map texture.');\n    }\n    return cmapTexture;\n  }\n\n  private initQuadVertexBuffer(): WebGLBuffer {\n    const buffer = this.gl.createBuffer();\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, buffer);\n    this.gl.bufferData(this.gl.ARRAY_BUFFER, imageVertices, this.gl.STATIC_DRAW);\n    this.gl.bindBuffer(this.gl.ARRAY_BUFFER, null);\n    if (!buffer) {\n      throw new Error('Failed to initialize quad vertex buffer.');\n    }\n    return buffer;\n  }\n\n  private initAttributes(program: WebGLProgram): WebGlAttributes {\n    const attributes = {\n      vertexPosition: this.gl.getAttribLocation(program, 'aVertexPosition'),\n      vertexTextureCoordinate: this.gl.getAttribLocation(program, 'aTextureCoord'),\n    };\n    this.gl.enableVertexAttribArray(attributes.vertexPosition);\n    this.gl.enableVertexAttribArray(attributes.vertexTextureCoordinate);\n    return attributes;\n  }\n\n  private initUniforms(program: WebGLProgram) {\n    let getUniformLocation = (name: string) => {\n      let location = this.gl.getUniformLocation(program, name);\n      if (!location) {\n        throw new Error(`Failed to get uniform location for '${name}'.`);\n      }\n      return location;\n    };\n    return {\n      drawMode: getUniformLocation('mode'),\n      lossFunction: getUniformLocation('lossFunction'),\n      nChannels: getUniformLocation('nChannels'),\n      viewMatrix: getUniformLocation('viewMatrix'),\n      imASampler: getUniformLocation('imASampler'),\n      imBSampler: getUniformLocation('imBSampler'),\n      cmapSampler: getUniformLocation('cmapSampler'),\n      viewTransform: getUniformLocation('viewTransform'),\n      exposure: getUniformLocation('exposure'),\n      offset: getUniformLocation('offset'),\n      gamma: getUniformLocation('gamma'),\n      imageWidth: getUniformLocation('imageWidth'),\n      imageHeight: getUniformLocation('imageHeight'),\n    };\n  }\n\n  private createTexture(image: Image): WebGLTexture {\n    const texture = this.gl.createTexture();\n    if (!texture) {\n      throw new Error('Failed to initialize image texture');\n    }\n    this.gl.bindTexture(this.gl.TEXTURE_2D, texture);\n    if (image.type === 'HdrImage') {\n      if (image.nChannels === 1) {\n          this.gl.texImage2D(\n            this.gl.TEXTURE_2D,\n            0,\n            this.gl.LUMINANCE,\n            image.width,\n            image.height,\n            0,\n            this.gl.LUMINANCE,\n            this.gl.FLOAT,\n            image.data\n          );\n      } else if (image.nChannels === 3) {\n          this.gl.texImage2D(\n            this.gl.TEXTURE_2D,\n            0,\n            this.gl.RGB,\n            image.width,\n            image.height,\n            0,\n            this.gl.RGB,\n            this.gl.FLOAT,\n            image.data\n          );\n      } else {\n        throw new Error(`Don't know what to do with ${image.nChannels} image channels.`);\n      }\n    } else {\n      this.gl.texImage2D(\n        this.gl.TEXTURE_2D,\n        0,\n        this.gl.RGBA,\n        this.gl.RGBA,\n        this.gl.UNSIGNED_BYTE,\n        image.data\n      );\n    }\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST);\n    this.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST);\n    this.gl.bindTexture(this.gl.TEXTURE_2D, null);\n    return texture;\n  }\n\n  private getTexture(image: Image) {\n    let texture = this.textures.get(image.url);\n    if (!texture) {\n      texture = this.createTexture(image);\n      this.textures.set(image.url, texture);\n    }\n    return texture;\n  }\n}\n","import { Matrix4x4, Vector4 } from '../utils/linalg';\nimport Layer, { Input } from './Layer';\nimport { getPixelColor } from '../utils/image-loading';\n\nexport default class TextLayer extends Layer {\n  protected image: Input;\n\n  private context: CanvasRenderingContext2D;\n  private needsRerender: boolean = true;\n\n  constructor(canvas: HTMLCanvasElement, image: Input) {\n    super(canvas, image);\n    // Create canvas 2d drawing context\n    const context = canvas.getContext('2d');\n    if (context == null) {\n        throw new Error('Failed to create 2D context for TextOverlay');\n    }\n    this.context = context;\n\n    // Make sure 'this' is available even when these methods are passed as callbacks\n    this.checkRender = this.checkRender.bind(this);\n    this.invalidate  = this.invalidate.bind(this);\n\n    // Draw for the first time\n    this.needsRerender = true;\n    requestAnimationFrame(this.checkRender);\n  }\n\n  setTransformation(transformation: Matrix4x4) {\n    this.transformation = transformation;\n    this.invalidate();\n  }\n\n  setImage(image: Input) {\n    this.image = image;\n    this.invalidate();\n  }\n\n  /**\n   * Force a new draw\n   */\n  invalidate() {\n    this.needsRerender = true;\n  }\n\n  /**\n   * Render loop, will draw when this component is invalidated with\n   * this.needsRerender = true;\n   * or when the size of the container changed\n   */\n  private checkRender() {\n    if (this.resize() || this.needsRerender) {\n      this.needsRerender = false;\n      this.draw();\n    }\n    requestAnimationFrame(this.checkRender);\n  }\n\n  /**\n   * Paint a new overlay\n   */\n  private draw() {\n    const canvas = this.context.canvas;\n    let leftTop = Vector4.fromValues(-1, 1, 0.0, 1.0);\n    let rightBottom = Vector4.fromValues(1, -1, 0.0, 1.0);\n\n    const mvMatrix = this.getViewMatrix();\n    let invMvMatrix = Matrix4x4.create();\n    Matrix4x4.invert(invMvMatrix, mvMatrix);\n\n    const image = this.image;\n\n    Vector4.transformMat4(leftTop, leftTop, invMvMatrix);\n    Vector4.transformMat4(rightBottom, rightBottom, invMvMatrix);\n    this.convertClipToRaster(leftTop, leftTop, image.width, image.height);\n    this.convertClipToRaster(rightBottom, rightBottom, image.width, image.height);\n\n    const px = Math.floor(leftTop.data[0]);\n    const py = Math.floor(leftTop.data[1]);\n    const qx = Math.floor(rightBottom.data[0]);\n    const qy = Math.floor(rightBottom.data[1]);\n    const lineHeight = Math.floor(20 * window.devicePixelRatio);\n    const fontSize = Math.floor(16 * window.devicePixelRatio);\n    const nx = canvas.width / (lineHeight * 3 + 2);\n    const ny = canvas.height / (lineHeight * 3 + 2);\n\n    this.context.clearRect(0, 0, canvas.width, canvas.height);\n\n    if (image.type === 'Difference') {\n      // We don't have access to computed values, so won't show the HUD\n      return;\n    }\n    const zoomedInEnough = rightBottom.data[0] - leftTop.data[0] < nx && rightBottom.data[1] - leftTop.data[1] < ny;\n    if (zoomedInEnough) {\n      this.context.font = `${fontSize}px sans-serif`;\n      for (let y = Math.max(0, py); y <= Math.min(image.height - 1, qy); y++) {\n        for (let x = Math.max(0, px); x <= Math.min(image.width - 1, qx); x++) {\n          Vector4.set(leftTop, x, y, 0.0, 1.0);\n          this.convertRasterToClip(leftTop, leftTop, image.width, image.height);\n          Vector4.transformMat4(leftTop, leftTop, mvMatrix);\n          this.convertClipToRaster(leftTop, leftTop, canvas.width, canvas.height);\n          let r, g, b;\n          if (image.nChannels === 1) {\n            r = getPixelColor(image, x, y, 0);\n            this.context.fillStyle = '#888888';\n            this.context.fillText(r.toFixed(4), leftTop.data[0], leftTop.data[1] + fontSize);\n          } else {\n            r = getPixelColor(image, x, y, 0);\n            g = getPixelColor(image, x, y, 1);\n            b = getPixelColor(image, x, y, 2);\n            this.context.fillStyle = '#990000';\n            this.context.fillText(r.toFixed(4), leftTop.data[0], leftTop.data[1] + fontSize);\n            this.context.fillStyle = '#009900';\n            this.context.fillText(g.toFixed(4), leftTop.data[0], leftTop.data[1] + fontSize + lineHeight);\n            this.context.fillStyle = '#0000FF';\n            this.context.fillText(b.toFixed(4), leftTop.data[0], leftTop.data[1] + fontSize + 2 * lineHeight);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Convert coordinates from clip space to raster space\n   * @param out coordinates in raster space (0, xres) x (0, yres)\n   * @param a coordinates in clip space (-1,1) x (-1,1)\n   * @param xres\n   * @param yres\n   */\n  private convertClipToRaster(out: Vector4, a: Vector4, xres: number, yres: number) {\n      out.data[0] = (a.data[0] + 1.0) * 0.5 * xres;\n      out.data[1] = (1.0 - a.data[1]) * 0.5 * yres;\n      return out;\n  }\n\n  /**\n   * Convert coordinates from raster space to clip space\n   * @param out coordinates in raster space (0, xres) x (0, yres)\n   * @param a coordinates in clip space (-1,1) x (-1,1)\n   * @param xres\n   * @param yres\n   */\n  private convertRasterToClip(out: Vector4, a: Vector4, xres: number, yres: number) {\n    out.data[0] = a.data[0] * 2.0 / xres - 1.0;\n    out.data[1] = 1.0 - (a.data[1] * 2.0 / yres);\n    return out;\n  }\n}\n","import { Matrix4x4, Vector4 } from '../utils/linalg';\nimport Layer, { Input } from './Layer';\nconst normalizeWheel = require('normalize-wheel');\n\nconst SCROLL_FACTOR = 1.001;\n\n/**\n * Mouse Layer\n * @todo add some proper documentation\n */\nexport default class MouseLayer extends Layer {\n  private pointCallback?: Function;\n  private transformationCallback?: (t: Matrix4x4) => void;\n  private panningState: null | { transformationAtStart: Matrix4x4, previousMouse: { x: number, y: number } } = null;\n  private unsubscribeFunctions: Function[] = []; /** To be called on destruct */\n\n  private enableMouseEvents: boolean;\n\n  constructor(canvas: HTMLCanvasElement, image: Input, enableMouseEvents: boolean) {\n    super(canvas, image);\n    this.handleMouseMove = this.handleMouseMove.bind(this);\n    this.handleMouseDown = this.handleMouseDown.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n    this.handleScroll = this.handleScroll.bind(this);\n    this.handlePointReporting = this.handlePointReporting.bind(this);\n\n    this.enableMouseEvents = enableMouseEvents;\n\n    // Subscribe to changes in the layers reactive inputs and window size\n    let unsubscribe;\n    document.addEventListener('mouseup', this.handleMouseUp);\n    unsubscribe = document.removeEventListener.bind(document, 'mouseup', this.handleMouseUp);\n    this.unsubscribeFunctions.push(unsubscribe);\n\n    document.addEventListener('mousemove', this.handleMouseMove);\n    unsubscribe = document.removeEventListener.bind(document, 'mousemove', this.handleMouseMove);\n    this.unsubscribeFunctions.push(unsubscribe);\n\n    canvas.addEventListener('wheel', this.handleScroll);\n    unsubscribe = canvas.removeEventListener.bind(canvas, 'wheel', this.handleScroll);\n    this.unsubscribeFunctions.push(unsubscribe);\n\n    canvas.addEventListener('mousedown', this.handleMouseDown);\n    unsubscribe = canvas.removeEventListener.bind(canvas, 'mousedown', this.handleMouseDown);\n    this.unsubscribeFunctions.push(unsubscribe);\n\n    canvas.addEventListener('mousemove', this.handlePointReporting);\n    unsubscribe = canvas.removeEventListener.bind(canvas, 'mousemove', this.handlePointReporting);\n    this.unsubscribeFunctions.push(unsubscribe);\n  }\n\n  setTransformation(transformation: Matrix4x4, broadcast: boolean = false) {\n    this.transformation = transformation;\n    if (broadcast && this.transformationCallback != null) {\n      this.transformationCallback(transformation);\n    }\n  }\n\n  setEnableMouseEvents(enable: boolean) {\n    this.enableMouseEvents = enable;\n  }\n\n  onTransformationChange(callback?: (t: Matrix4x4) => void) {\n    this.transformationCallback = callback;\n  }\n\n  setImage(image: Input) {\n    this.image = image;\n  }\n\n  onPointAt(callback?: Function) {\n    this.pointCallback = callback;\n  }\n\n  destruct() {\n    this.unsubscribeFunctions.forEach(fn => fn());\n  }\n\n  private handleMouseMove(event: MouseEvent) {\n    if (!this.enableMouseEvents) {\n      return;\n    }\n    if (this.panningState) {\n      const { x, y } = this.relativeMousePosition(event.clientX, event.clientY);\n      const dx = x - this.panningState.previousMouse.x;\n      const dy = y - this.panningState.previousMouse.y;\n      const transformation = Matrix4x4.create();\n      const aspect = this.getAspect();\n      Matrix4x4.translate(transformation, transformation, [dx / aspect.x, dy / aspect.y, 0.0]);\n      Matrix4x4.multiply(transformation, transformation, this.transformation);\n      this.setTransformation(transformation, true);\n      this.panningState.previousMouse = { x, y };\n    }\n  }\n\n  private handleMouseUp(event: MouseEvent) {\n    if (this.panningState) {\n      this.panningState = null;\n    }\n  }\n\n  private handleMouseDown(event: MouseEvent) {\n    const mousePosition = this.relativeMousePosition(event.clientX, event.clientY);\n    this.panningState = {\n      transformationAtStart: Matrix4x4.clone(this.transformation),\n      previousMouse: mousePosition,\n    };\n  }\n\n  private handleScroll(event: WheelEvent) {\n    if (!this.enableMouseEvents) {\n      return;\n    }\n    event.preventDefault();\n    const {pixelY} = normalizeWheel(event);\n    const mouse = this.relativeMousePosition(event.clientX, event.clientY);\n    const transformation = Matrix4x4.create();\n    const deltaMatrix = Matrix4x4.create();\n    const aspect = this.getAspect();\n    Matrix4x4.translate(deltaMatrix, deltaMatrix, [mouse.x / aspect.x, mouse.y / aspect.y, 0.0]);\n    const scaleFactor = Math.pow(SCROLL_FACTOR, pixelY);\n    Matrix4x4.scale(deltaMatrix, deltaMatrix, [scaleFactor, scaleFactor, 1.0]);\n    Matrix4x4.translate(deltaMatrix, deltaMatrix, [-mouse.x / aspect.x, -mouse.y / aspect.y, 0.0]);\n    Matrix4x4.multiply(transformation, deltaMatrix, this.transformation);\n    this.setTransformation(transformation, true);\n  }\n\n  /**\n   * Event handler for reporting mouse movement.\n   *\n   * Only applicable when the options 'onPoint' property is set on this component.\n   */\n  private handlePointReporting(event: MouseEvent): void {\n    if (this.pointCallback) {\n      if (!this.panningState) {\n        const { x, y } = this.relativeMousePosition(event.clientX, event.clientY);\n        const imageCoordinates = this.canvasToImage(x, y);\n        this.pointCallback(imageCoordinates.x, imageCoordinates.y);\n      }\n    }\n  }\n\n  /**\n   * Translate clientX and clientY values to relative positions within the bounding box\n   * of the viewer.\n   */\n  private relativeMousePosition(clientX: number, clientY: number): { x: number, y: number } {\n    const { clientWidth, clientHeight } = this.canvas;\n    const { left, top } = this.canvas.getBoundingClientRect();\n    return {\n      x: -1.0 + 2.0 * (clientX - left) / clientWidth,\n      y:  1.0 - 2.0 * (clientY - top) / clientHeight,\n    };\n  }\n\n  /**\n   * Translate canvas coordinates to image coodrinates\n   */\n  private canvasToImage(x: number, y: number): { x: number, y: number } {\n      const point = Vector4.create();\n      Vector4.set(point, x, y, 1.0, 1.0);\n      const inverseViewMatrix = Matrix4x4.create();\n      const viewMatrix = this.getViewMatrix();\n      Matrix4x4.invert(inverseViewMatrix, viewMatrix);\n      Vector4.transformMat4(point, point, inverseViewMatrix);\n      return { x: point.data[0], y: point.data[1] };\n  }\n}\n","(function (factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? (module['exports'] = factory()) :\n\t\ttypeof define === 'function' && define['amd'] ? define(factory()) :\n\t\t\t(window['stylisRuleSheet'] = factory())\n}(function () {\n\n\t'use strict'\n\n\treturn function (insertRule) {\n\t\tvar delimiter = '/*|*/'\n\t\tvar needle = delimiter+'}'\n\n\t\tfunction toSheet (block) {\n\t\t\tif (block)\n\t\t\t\ttry {\n\t\t\t\t\tinsertRule(block + '}')\n\t\t\t\t} catch (e) {}\n\t\t}\n\n\t\treturn function ruleSheet (context, content, selectors, parents, line, column, length, ns, depth, at) {\n\t\t\tswitch (context) {\n\t\t\t\t// property\n\t\t\t\tcase 1:\n\t\t\t\t\t// @import\n\t\t\t\t\tif (depth === 0 && content.charCodeAt(0) === 64)\n\t\t\t\t\t\treturn insertRule(content+';'), ''\n\t\t\t\t\tbreak\n\t\t\t\t// selector\n\t\t\t\tcase 2:\n\t\t\t\t\tif (ns === 0)\n\t\t\t\t\t\treturn content + delimiter\n\t\t\t\t\tbreak\n\t\t\t\t// at-rule\n\t\t\t\tcase 3:\n\t\t\t\t\tswitch (ns) {\n\t\t\t\t\t\t// @font-face, @page\n\t\t\t\t\t\tcase 102:\n\t\t\t\t\t\tcase 112:\n\t\t\t\t\t\t\treturn insertRule(selectors[0]+content), ''\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\treturn content + (at === 0 ? delimiter : '')\n\t\t\t\t\t}\n\t\t\t\tcase -2:\n\t\t\t\t\tcontent.split(needle).forEach(toSheet)\n\t\t\t}\n\t\t}\n\t}\n}))\n","var unitlessKeys = {\n  animationIterationCount: 1,\n  borderImageOutset: 1,\n  borderImageSlice: 1,\n  borderImageWidth: 1,\n  boxFlex: 1,\n  boxFlexGroup: 1,\n  boxOrdinalGroup: 1,\n  columnCount: 1,\n  columns: 1,\n  flex: 1,\n  flexGrow: 1,\n  flexPositive: 1,\n  flexShrink: 1,\n  flexNegative: 1,\n  flexOrder: 1,\n  gridRow: 1,\n  gridRowEnd: 1,\n  gridRowSpan: 1,\n  gridRowStart: 1,\n  gridColumn: 1,\n  gridColumnEnd: 1,\n  gridColumnSpan: 1,\n  gridColumnStart: 1,\n  msGridRow: 1,\n  msGridRowSpan: 1,\n  msGridColumn: 1,\n  msGridColumnSpan: 1,\n  fontWeight: 1,\n  lineHeight: 1,\n  opacity: 1,\n  order: 1,\n  orphans: 1,\n  tabSize: 1,\n  widows: 1,\n  zIndex: 1,\n  zoom: 1,\n  WebkitLineClamp: 1,\n  // SVG-related properties\n  fillOpacity: 1,\n  floodOpacity: 1,\n  stopOpacity: 1,\n  strokeDasharray: 1,\n  strokeDashoffset: 1,\n  strokeMiterlimit: 1,\n  strokeOpacity: 1,\n  strokeWidth: 1\n};\n\nexport default unitlessKeys;\n","function memoize(fn) {\n  var cache = {};\n  return function (arg) {\n    if (cache[arg] === undefined) cache[arg] = fn(arg);\n    return cache[arg];\n  };\n}\n\nexport default memoize;\n","import memoize from '@emotion/memoize';\n\nvar reactPropsRegex = /^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|default|defer|dir|disabled|download|draggable|encType|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|itemProp|itemScope|itemType|itemID|itemRef|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/; // https://esbench.com/bench/5bfee68a4cd7e6009ef61d23\n\nvar index = memoize(function (prop) {\n  return reactPropsRegex.test(prop) || prop.charCodeAt(0) === 111\n  /* o */\n  && prop.charCodeAt(1) === 110\n  /* n */\n  && prop.charCodeAt(2) < 91;\n}\n/* Z+1 */\n);\n\nexport default index;\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport ImageFrame from './components/ImageFrame';\nimport ImageViewer, { InputTree } from './components/ImageViewer';\nimport ImageLayer from './layers/ImageLayer';\nimport TextLayer from './layers/TextLayer';\nimport MouseLayer from './layers/MouseLayer';\nimport { loadImage, ImageCache } from './utils/image-loading';\nimport { Matrix4x4, Vector4 } from './utils/linalg';\n\nexport {\n    loadImage,\n    ImageCache,\n    ImageFrame,\n    ImageLayer,\n    ImageViewer,\n    TextLayer,\n    MouseLayer,\n    Matrix4x4,\n    Vector4\n};\n\nexport function renderViewer(\n        elem: HTMLElement,\n        data: InputTree,\n        baseUrl: string = '',\n        sortMenu: boolean = false,\n        removeCommonPrefix: boolean = false,\n        clearColor: number[] = [0.25, 0.25, 0.25],\n        framerates: number[] = [1, 2, 5, 10, 15, 24, 30, 48, 60, 90, 120]\n) {\n    const component = (\n        <ImageViewer\n            data={data}\n            baseUrl={baseUrl}\n            sortMenu={sortMenu}\n            removeCommonPrefix={removeCommonPrefix}\n            clearColor={clearColor}\n            framerates={framerates}\n        />\n    );\n    return ReactDOM.render(component, elem);\n}\n\nexport default ImageViewer;\n","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"ca17c4b91e3f9037cd0b.worker.js\");\n};","module.exports = require('./src/normalizeWheel.js');\n","/**\n * Copyright (c) 2015, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule normalizeWheel\n * @typechecks\n */\n\n'use strict';\n\nvar UserAgent_DEPRECATED = require('./UserAgent_DEPRECATED');\n\nvar isEventSupported = require('./isEventSupported');\n\n\n// Reasonable defaults\nvar PIXEL_STEP  = 10;\nvar LINE_HEIGHT = 40;\nvar PAGE_HEIGHT = 800;\n\n/**\n * Mouse wheel (and 2-finger trackpad) support on the web sucks.  It is\n * complicated, thus this doc is long and (hopefully) detailed enough to answer\n * your questions.\n *\n * If you need to react to the mouse wheel in a predictable way, this code is\n * like your bestest friend. * hugs *\n *\n * As of today, there are 4 DOM event types you can listen to:\n *\n *   'wheel'                -- Chrome(31+), FF(17+), IE(9+)\n *   'mousewheel'           -- Chrome, IE(6+), Opera, Safari\n *   'MozMousePixelScroll'  -- FF(3.5 only!) (2010-2013) -- don't bother!\n *   'DOMMouseScroll'       -- FF(0.9.7+) since 2003\n *\n * So what to do?  The is the best:\n *\n *   normalizeWheel.getEventType();\n *\n * In your event callback, use this code to get sane interpretation of the\n * deltas.  This code will return an object with properties:\n *\n *   spinX   -- normalized spin speed (use for zoom) - x plane\n *   spinY   -- \" - y plane\n *   pixelX  -- normalized distance (to pixels) - x plane\n *   pixelY  -- \" - y plane\n *\n * Wheel values are provided by the browser assuming you are using the wheel to\n * scroll a web page by a number of lines or pixels (or pages).  Values can vary\n * significantly on different platforms and browsers, forgetting that you can\n * scroll at different speeds.  Some devices (like trackpads) emit more events\n * at smaller increments with fine granularity, and some emit massive jumps with\n * linear speed or acceleration.\n *\n * This code does its best to normalize the deltas for you:\n *\n *   - spin is trying to normalize how far the wheel was spun (or trackpad\n *     dragged).  This is super useful for zoom support where you want to\n *     throw away the chunky scroll steps on the PC and make those equal to\n *     the slow and smooth tiny steps on the Mac. Key data: This code tries to\n *     resolve a single slow step on a wheel to 1.\n *\n *   - pixel is normalizing the desired scroll delta in pixel units.  You'll\n *     get the crazy differences between browsers, but at least it'll be in\n *     pixels!\n *\n *   - positive value indicates scrolling DOWN/RIGHT, negative UP/LEFT.  This\n *     should translate to positive value zooming IN, negative zooming OUT.\n *     This matches the newer 'wheel' event.\n *\n * Why are there spinX, spinY (or pixels)?\n *\n *   - spinX is a 2-finger side drag on the trackpad, and a shift + wheel turn\n *     with a mouse.  It results in side-scrolling in the browser by default.\n *\n *   - spinY is what you expect -- it's the classic axis of a mouse wheel.\n *\n *   - I dropped spinZ/pixelZ.  It is supported by the DOM 3 'wheel' event and\n *     probably is by browsers in conjunction with fancy 3D controllers .. but\n *     you know.\n *\n * Implementation info:\n *\n * Examples of 'wheel' event if you scroll slowly (down) by one step with an\n * average mouse:\n *\n *   OS X + Chrome  (mouse)     -    4   pixel delta  (wheelDelta -120)\n *   OS X + Safari  (mouse)     -  N/A   pixel delta  (wheelDelta  -12)\n *   OS X + Firefox (mouse)     -    0.1 line  delta  (wheelDelta  N/A)\n *   Win8 + Chrome  (mouse)     -  100   pixel delta  (wheelDelta -120)\n *   Win8 + Firefox (mouse)     -    3   line  delta  (wheelDelta -120)\n *\n * On the trackpad:\n *\n *   OS X + Chrome  (trackpad)  -    2   pixel delta  (wheelDelta   -6)\n *   OS X + Firefox (trackpad)  -    1   pixel delta  (wheelDelta  N/A)\n *\n * On other/older browsers.. it's more complicated as there can be multiple and\n * also missing delta values.\n *\n * The 'wheel' event is more standard:\n *\n * http://www.w3.org/TR/DOM-Level-3-Events/#events-wheelevents\n *\n * The basics is that it includes a unit, deltaMode (pixels, lines, pages), and\n * deltaX, deltaY and deltaZ.  Some browsers provide other values to maintain\n * backward compatibility with older events.  Those other values help us\n * better normalize spin speed.  Example of what the browsers provide:\n *\n *                          | event.wheelDelta | event.detail\n *        ------------------+------------------+--------------\n *          Safari v5/OS X  |       -120       |       0\n *          Safari v5/Win7  |       -120       |       0\n *         Chrome v17/OS X  |       -120       |       0\n *         Chrome v17/Win7  |       -120       |       0\n *                IE9/Win7  |       -120       |   undefined\n *         Firefox v4/OS X  |     undefined    |       1\n *         Firefox v4/Win7  |     undefined    |       3\n *\n */\nfunction normalizeWheel(/*object*/ event) /*object*/ {\n  var sX = 0, sY = 0,       // spinX, spinY\n      pX = 0, pY = 0;       // pixelX, pixelY\n\n  // Legacy\n  if ('detail'      in event) { sY = event.detail; }\n  if ('wheelDelta'  in event) { sY = -event.wheelDelta / 120; }\n  if ('wheelDeltaY' in event) { sY = -event.wheelDeltaY / 120; }\n  if ('wheelDeltaX' in event) { sX = -event.wheelDeltaX / 120; }\n\n  // side scrolling on FF with DOMMouseScroll\n  if ( 'axis' in event && event.axis === event.HORIZONTAL_AXIS ) {\n    sX = sY;\n    sY = 0;\n  }\n\n  pX = sX * PIXEL_STEP;\n  pY = sY * PIXEL_STEP;\n\n  if ('deltaY' in event) { pY = event.deltaY; }\n  if ('deltaX' in event) { pX = event.deltaX; }\n\n  if ((pX || pY) && event.deltaMode) {\n    if (event.deltaMode == 1) {          // delta in LINE units\n      pX *= LINE_HEIGHT;\n      pY *= LINE_HEIGHT;\n    } else {                             // delta in PAGE units\n      pX *= PAGE_HEIGHT;\n      pY *= PAGE_HEIGHT;\n    }\n  }\n\n  // Fall-back if spin cannot be determined\n  if (pX && !sX) { sX = (pX < 1) ? -1 : 1; }\n  if (pY && !sY) { sY = (pY < 1) ? -1 : 1; }\n\n  return { spinX  : sX,\n           spinY  : sY,\n           pixelX : pX,\n           pixelY : pY };\n}\n\n\n/**\n * The best combination if you prefer spinX + spinY normalization.  It favors\n * the older DOMMouseScroll for Firefox, as FF does not include wheelDelta with\n * 'wheel' event, making spin speed determination impossible.\n */\nnormalizeWheel.getEventType = function() /*string*/ {\n  return (UserAgent_DEPRECATED.firefox())\n           ? 'DOMMouseScroll'\n           : (isEventSupported('wheel'))\n               ? 'wheel'\n               : 'mousewheel';\n};\n\nmodule.exports = normalizeWheel;\n","/**\n * Copyright 2004-present Facebook. All Rights Reserved.\n *\n * @providesModule UserAgent_DEPRECATED\n */\n\n/**\n *  Provides entirely client-side User Agent and OS detection. You should prefer\n *  the non-deprecated UserAgent module when possible, which exposes our\n *  authoritative server-side PHP-based detection to the client.\n *\n *  Usage is straightforward:\n *\n *    if (UserAgent_DEPRECATED.ie()) {\n *      //  IE\n *    }\n *\n *  You can also do version checks:\n *\n *    if (UserAgent_DEPRECATED.ie() >= 7) {\n *      //  IE7 or better\n *    }\n *\n *  The browser functions will return NaN if the browser does not match, so\n *  you can also do version compares the other way:\n *\n *    if (UserAgent_DEPRECATED.ie() < 7) {\n *      //  IE6 or worse\n *    }\n *\n *  Note that the version is a float and may include a minor version number,\n *  so you should always use range operators to perform comparisons, not\n *  strict equality.\n *\n *  **Note:** You should **strongly** prefer capability detection to browser\n *  version detection where it's reasonable:\n *\n *    http://www.quirksmode.org/js/support.html\n *\n *  Further, we have a large number of mature wrapper functions and classes\n *  which abstract away many browser irregularities. Check the documentation,\n *  grep for things, or ask on javascript@lists.facebook.com before writing yet\n *  another copy of \"event || window.event\".\n *\n */\n\nvar _populated = false;\n\n// Browsers\nvar _ie, _firefox, _opera, _webkit, _chrome;\n\n// Actual IE browser for compatibility mode\nvar _ie_real_version;\n\n// Platforms\nvar _osx, _windows, _linux, _android;\n\n// Architectures\nvar _win64;\n\n// Devices\nvar _iphone, _ipad, _native;\n\nvar _mobile;\n\nfunction _populate() {\n  if (_populated) {\n    return;\n  }\n\n  _populated = true;\n\n  // To work around buggy JS libraries that can't handle multi-digit\n  // version numbers, Opera 10's user agent string claims it's Opera\n  // 9, then later includes a Version/X.Y field:\n  //\n  // Opera/9.80 (foo) Presto/2.2.15 Version/10.10\n  var uas = navigator.userAgent;\n  var agent = /(?:MSIE.(\\d+\\.\\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\\d+\\.\\d+))|(?:Opera(?:.+Version.|.)(\\d+\\.\\d+))|(?:AppleWebKit.(\\d+(?:\\.\\d+)?))|(?:Trident\\/\\d+\\.\\d+.*rv:(\\d+\\.\\d+))/.exec(uas);\n  var os    = /(Mac OS X)|(Windows)|(Linux)/.exec(uas);\n\n  _iphone = /\\b(iPhone|iP[ao]d)/.exec(uas);\n  _ipad = /\\b(iP[ao]d)/.exec(uas);\n  _android = /Android/i.exec(uas);\n  _native = /FBAN\\/\\w+;/i.exec(uas);\n  _mobile = /Mobile/i.exec(uas);\n\n  // Note that the IE team blog would have you believe you should be checking\n  // for 'Win64; x64'.  But MSDN then reveals that you can actually be coming\n  // from either x64 or ia64;  so ultimately, you should just check for Win64\n  // as in indicator of whether you're in 64-bit IE.  32-bit IE on 64-bit\n  // Windows will send 'WOW64' instead.\n  _win64 = !!(/Win64/.exec(uas));\n\n  if (agent) {\n    _ie = agent[1] ? parseFloat(agent[1]) : (\n          agent[5] ? parseFloat(agent[5]) : NaN);\n    // IE compatibility mode\n    if (_ie && document && document.documentMode) {\n      _ie = document.documentMode;\n    }\n    // grab the \"true\" ie version from the trident token if available\n    var trident = /(?:Trident\\/(\\d+.\\d+))/.exec(uas);\n    _ie_real_version = trident ? parseFloat(trident[1]) + 4 : _ie;\n\n    _firefox = agent[2] ? parseFloat(agent[2]) : NaN;\n    _opera   = agent[3] ? parseFloat(agent[3]) : NaN;\n    _webkit  = agent[4] ? parseFloat(agent[4]) : NaN;\n    if (_webkit) {\n      // We do not add the regexp to the above test, because it will always\n      // match 'safari' only since 'AppleWebKit' appears before 'Chrome' in\n      // the userAgent string.\n      agent = /(?:Chrome\\/(\\d+\\.\\d+))/.exec(uas);\n      _chrome = agent && agent[1] ? parseFloat(agent[1]) : NaN;\n    } else {\n      _chrome = NaN;\n    }\n  } else {\n    _ie = _firefox = _opera = _chrome = _webkit = NaN;\n  }\n\n  if (os) {\n    if (os[1]) {\n      // Detect OS X version.  If no version number matches, set _osx to true.\n      // Version examples:  10, 10_6_1, 10.7\n      // Parses version number as a float, taking only first two sets of\n      // digits.  If only one set of digits is found, returns just the major\n      // version number.\n      var ver = /(?:Mac OS X (\\d+(?:[._]\\d+)?))/.exec(uas);\n\n      _osx = ver ? parseFloat(ver[1].replace('_', '.')) : true;\n    } else {\n      _osx = false;\n    }\n    _windows = !!os[2];\n    _linux   = !!os[3];\n  } else {\n    _osx = _windows = _linux = false;\n  }\n}\n\nvar UserAgent_DEPRECATED = {\n\n  /**\n   *  Check if the UA is Internet Explorer.\n   *\n   *\n   *  @return float|NaN Version number (if match) or NaN.\n   */\n  ie: function() {\n    return _populate() || _ie;\n  },\n\n  /**\n   * Check if we're in Internet Explorer compatibility mode.\n   *\n   * @return bool true if in compatibility mode, false if\n   * not compatibility mode or not ie\n   */\n  ieCompatibilityMode: function() {\n    return _populate() || (_ie_real_version > _ie);\n  },\n\n\n  /**\n   * Whether the browser is 64-bit IE.  Really, this is kind of weak sauce;  we\n   * only need this because Skype can't handle 64-bit IE yet.  We need to remove\n   * this when we don't need it -- tracked by #601957.\n   */\n  ie64: function() {\n    return UserAgent_DEPRECATED.ie() && _win64;\n  },\n\n  /**\n   *  Check if the UA is Firefox.\n   *\n   *\n   *  @return float|NaN Version number (if match) or NaN.\n   */\n  firefox: function() {\n    return _populate() || _firefox;\n  },\n\n\n  /**\n   *  Check if the UA is Opera.\n   *\n   *\n   *  @return float|NaN Version number (if match) or NaN.\n   */\n  opera: function() {\n    return _populate() || _opera;\n  },\n\n\n  /**\n   *  Check if the UA is WebKit.\n   *\n   *\n   *  @return float|NaN Version number (if match) or NaN.\n   */\n  webkit: function() {\n    return _populate() || _webkit;\n  },\n\n  /**\n   *  For Push\n   *  WILL BE REMOVED VERY SOON. Use UserAgent_DEPRECATED.webkit\n   */\n  safari: function() {\n    return UserAgent_DEPRECATED.webkit();\n  },\n\n  /**\n   *  Check if the UA is a Chrome browser.\n   *\n   *\n   *  @return float|NaN Version number (if match) or NaN.\n   */\n  chrome : function() {\n    return _populate() || _chrome;\n  },\n\n\n  /**\n   *  Check if the user is running Windows.\n   *\n   *  @return bool `true' if the user's OS is Windows.\n   */\n  windows: function() {\n    return _populate() || _windows;\n  },\n\n\n  /**\n   *  Check if the user is running Mac OS X.\n   *\n   *  @return float|bool   Returns a float if a version number is detected,\n   *                       otherwise true/false.\n   */\n  osx: function() {\n    return _populate() || _osx;\n  },\n\n  /**\n   * Check if the user is running Linux.\n   *\n   * @return bool `true' if the user's OS is some flavor of Linux.\n   */\n  linux: function() {\n    return _populate() || _linux;\n  },\n\n  /**\n   * Check if the user is running on an iPhone or iPod platform.\n   *\n   * @return bool `true' if the user is running some flavor of the\n   *    iPhone OS.\n   */\n  iphone: function() {\n    return _populate() || _iphone;\n  },\n\n  mobile: function() {\n    return _populate() || (_iphone || _ipad || _android || _mobile);\n  },\n\n  nativeApp: function() {\n    // webviews inside of the native apps\n    return _populate() || _native;\n  },\n\n  android: function() {\n    return _populate() || _android;\n  },\n\n  ipad: function() {\n    return _populate() || _ipad;\n  }\n};\n\nmodule.exports = UserAgent_DEPRECATED;\n","/**\n * Copyright 2013-2015, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule isEventSupported\n */\n\n'use strict';\n\nvar ExecutionEnvironment = require('./ExecutionEnvironment');\n\nvar useHasFeature;\nif (ExecutionEnvironment.canUseDOM) {\n  useHasFeature =\n    document.implementation &&\n    document.implementation.hasFeature &&\n    // always returns true in newer browsers as per the standard.\n    // @see http://dom.spec.whatwg.org/#dom-domimplementation-hasfeature\n    document.implementation.hasFeature('', '') !== true;\n}\n\n/**\n * Checks if an event is supported in the current execution environment.\n *\n * NOTE: This will not work correctly for non-generic events such as `change`,\n * `reset`, `load`, `error`, and `select`.\n *\n * Borrows from Modernizr.\n *\n * @param {string} eventNameSuffix Event name, e.g. \"click\".\n * @param {?boolean} capture Check if the capture phase is supported.\n * @return {boolean} True if the event is supported.\n * @internal\n * @license Modernizr 3.0.0pre (Custom Build) | MIT\n */\nfunction isEventSupported(eventNameSuffix, capture) {\n  if (!ExecutionEnvironment.canUseDOM ||\n      capture && !('addEventListener' in document)) {\n    return false;\n  }\n\n  var eventName = 'on' + eventNameSuffix;\n  var isSupported = eventName in document;\n\n  if (!isSupported) {\n    var element = document.createElement('div');\n    element.setAttribute(eventName, 'return;');\n    isSupported = typeof element[eventName] === 'function';\n  }\n\n  if (!isSupported && useHasFeature && eventNameSuffix === 'wheel') {\n    // This is the only way to test support for the `wheel` event in IE9+.\n    isSupported = document.implementation.hasFeature('Events.wheel', '3.0');\n  }\n\n  return isSupported;\n}\n\nmodule.exports = isEventSupported;\n","/**\n * Copyright (c) 2015, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule ExecutionEnvironment\n */\n\n/*jslint evil: true */\n\n'use strict';\n\nvar canUseDOM = !!(\n  typeof window !== 'undefined' &&\n  window.document &&\n  window.document.createElement\n);\n\n/**\n * Simple, lightweight module assisting with the detection and context of\n * Worker. Helps avoid circular dependencies and allows code to reason about\n * whether or not they are in a Worker, even if they never include the main\n * `ReactWorker` dependency.\n */\nvar ExecutionEnvironment = {\n\n  canUseDOM: canUseDOM,\n\n  canUseWorkers: typeof Worker !== 'undefined',\n\n  canUseEventListeners:\n    canUseDOM && !!(window.addEventListener || window.attachEvent),\n\n  canUseViewport: canUseDOM && !!window.screen,\n\n  isInWorker: !canUseDOM // For now, this is true - might change in the future.\n\n};\n\nmodule.exports = ExecutionEnvironment;\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","/** @license React v16.7.0\n * react-is.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';Object.defineProperty(exports,\"__esModule\",{value:!0});\nvar b=\"function\"===typeof Symbol&&Symbol.for,c=b?Symbol.for(\"react.element\"):60103,d=b?Symbol.for(\"react.portal\"):60106,e=b?Symbol.for(\"react.fragment\"):60107,f=b?Symbol.for(\"react.strict_mode\"):60108,g=b?Symbol.for(\"react.profiler\"):60114,h=b?Symbol.for(\"react.provider\"):60109,k=b?Symbol.for(\"react.context\"):60110,l=b?Symbol.for(\"react.async_mode\"):60111,m=b?Symbol.for(\"react.concurrent_mode\"):60111,n=b?Symbol.for(\"react.forward_ref\"):60112,p=b?Symbol.for(\"react.suspense\"):60113,q=b?Symbol.for(\"react.memo\"):\n60115,r=b?Symbol.for(\"react.lazy\"):60116;function t(a){if(\"object\"===typeof a&&null!==a){var u=a.$$typeof;switch(u){case c:switch(a=a.type,a){case l:case m:case e:case g:case f:case p:return a;default:switch(a=a&&a.$$typeof,a){case k:case n:case h:return a;default:return u}}case r:case q:case d:return u}}}function v(a){return t(a)===m}exports.typeOf=t;exports.AsyncMode=l;exports.ConcurrentMode=m;exports.ContextConsumer=k;exports.ContextProvider=h;exports.Element=c;exports.ForwardRef=n;\nexports.Fragment=e;exports.Lazy=r;exports.Memo=q;exports.Portal=d;exports.Profiler=g;exports.StrictMode=f;exports.Suspense=p;exports.isValidElementType=function(a){return\"string\"===typeof a||\"function\"===typeof a||a===e||a===m||a===g||a===f||a===p||\"object\"===typeof a&&null!==a&&(a.$$typeof===r||a.$$typeof===q||a.$$typeof===h||a.$$typeof===k||a.$$typeof===n)};exports.isAsyncMode=function(a){return v(a)||t(a)===l};exports.isConcurrentMode=v;exports.isContextConsumer=function(a){return t(a)===k};\nexports.isContextProvider=function(a){return t(a)===h};exports.isElement=function(a){return\"object\"===typeof a&&null!==a&&a.$$typeof===c};exports.isForwardRef=function(a){return t(a)===n};exports.isFragment=function(a){return t(a)===e};exports.isLazy=function(a){return t(a)===r};exports.isMemo=function(a){return t(a)===q};exports.isPortal=function(a){return t(a)===d};exports.isProfiler=function(a){return t(a)===g};exports.isStrictMode=function(a){return t(a)===f};\nexports.isSuspense=function(a){return t(a)===p};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nif (process.env.NODE_ENV !== 'production') {\n  var REACT_ELEMENT_TYPE = (typeof Symbol === 'function' &&\n    Symbol.for &&\n    Symbol.for('react.element')) ||\n    0xeac7;\n\n  var isValidElement = function(object) {\n    return typeof object === 'object' &&\n      object !== null &&\n      object.$$typeof === REACT_ELEMENT_TYPE;\n  };\n\n  // By explicitly using `prop-types` you are opting into new development behavior.\n  // http://fb.me/prop-types-in-prod\n  var throwOnDirectAccess = true;\n  module.exports = require('./factoryWithTypeCheckers')(isValidElement, throwOnDirectAccess);\n} else {\n  // By explicitly using `prop-types` you are opting into new production behavior.\n  // http://fb.me/prop-types-in-prod\n  module.exports = require('./factoryWithThrowingShims')();\n}\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = require('./lib/ReactPropTypesSecret');\n\nfunction emptyFunction() {}\n\nmodule.exports = function() {\n  function shim(props, propName, componentName, location, propFullName, secret) {\n    if (secret === ReactPropTypesSecret) {\n      // It is still safe when called from React.\n      return;\n    }\n    var err = new Error(\n      'Calling PropTypes validators directly is not supported by the `prop-types` package. ' +\n      'Use PropTypes.checkPropTypes() to call them. ' +\n      'Read more at http://fb.me/use-check-prop-types'\n    );\n    err.name = 'Invariant Violation';\n    throw err;\n  };\n  shim.isRequired = shim;\n  function getShim() {\n    return shim;\n  };\n  // Important!\n  // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.\n  var ReactPropTypes = {\n    array: shim,\n    bool: shim,\n    func: shim,\n    number: shim,\n    object: shim,\n    string: shim,\n    symbol: shim,\n\n    any: shim,\n    arrayOf: getShim,\n    element: shim,\n    instanceOf: getShim,\n    node: shim,\n    objectOf: getShim,\n    oneOf: getShim,\n    oneOfType: getShim,\n    shape: getShim,\n    exact: getShim\n  };\n\n  ReactPropTypes.checkPropTypes = emptyFunction;\n  ReactPropTypes.PropTypes = ReactPropTypes;\n\n  return ReactPropTypes;\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';\n\nmodule.exports = ReactPropTypesSecret;\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { Matrix4x4 } from '../../utils/linalg';\n\nimport numberAwareCompare from '../../utils/number-aware-compare';\nimport requestFullscreen from '../../utils/fullscreen';\n\nimport HelpScreen from './HelpScreen';\nimport ImageFrame from '../ImageFrame';\nimport { lossFunctionFromString } from '../../layers/Layer';\nimport ImageFrameWithLoading, { ImageSpec } from '../ImageFrameWithLoading';\nimport { NavRow } from './navigation';\n\nconst MainDiv = styled.div`\n  background-color: #333;\n  font-size: .9em;\n  position: absolute;\n  top: 0; bottom: 0; left: 0; right: 0;\n  display: flex;\n  flex-direction: column;\n  color: #AAA;\n`;\n\nconst ImageArea = styled.div`\n  flex-grow: 1;\n  position: relative;\n`;\n\nexport type InputTree = InputNode | InputLeaf;\n\nexport interface InputNode {\n  title: string;\n  children: InputTree[];\n}\n\nexport type InputLeaf = InputLeafImage | InputLeafLossMap;\n\nexport interface InputLeafImage {\n  title: string;\n  image: string | string[];\n}\nexport interface InputLeafLossMap {\n  title: string;\n  lossMap: {\n    function: string;\n    imageA: string;\n    imageB: string;\n  };\n}\n\nexport interface ImageViewerState {\n  activeRow: number;             /** The number of the row that is currently active for keyboard toggling */\n  selection: string[];           /** List of item titles that are selected */\n  viewTransform: { [tonemapGroup: string]: number }; /** Image view transform, a number between 0 and 1 for each tonemapGroup (string) */\n  exposure: { [tonemapGroup: string]: number }; /** Image exposure, a number > 0 for each tonemapGroup (string) */\n  helpIsOpen: boolean;           /** Whether the help screen overlay is currently open */\n  defaultTransformation: Matrix4x4;\n  transformationNeedsUpdate: boolean;\n  hasFocus: boolean; /** The viewer has 'focus', i.e. the user clicked on it */\n  isPlaying: boolean;\n  playbackPosition: number;\n  framerateIndex: number;\n}\n\nexport interface ImageViewerProps {\n  data: InputTree;             /** Unsorted input tree, use the sorted this.menuData instead */\n  baseUrl: string;             /** Prefix for all images */\n  sortMenu?: boolean;           /** Whether to sort the menu-items automatically */\n  removeCommonPrefix?: boolean; /** Should common prefices of menu names be shortened. */\n  clearColor?: number[];        /** Color of the background */\n  framerates?: number[];\n}\n\n// A little hack to allow detecting shift click\nlet SHIFT_IS_DOWN: boolean = false;\ndocument.addEventListener('keydown', (ev) => {\n  if (ev.key === 'Shift') {\n    SHIFT_IS_DOWN = true;\n  }\n});\ndocument.addEventListener('keyup', (ev) => {\n  if (ev.key === 'Shift') {\n    SHIFT_IS_DOWN = false;\n  }\n});\n\nexport default class ImageViewer extends React.Component<ImageViewerProps, ImageViewerState> {\n  public static defaultProps: Partial<ImageViewerProps> = {\n    baseUrl: '',\n    sortMenu: false,\n    removeCommonPrefix: false,\n    clearColor: [0.25, 0.25, 0.25],\n    framerates: [1, 2, 5, 10, 15, 24, 30, 48, 60, 90, 120],\n  };\n\n  /** A sorted version of props.data, cached for efficiency and recomputed when props change */\n  private menuData: InputTree;\n  /** A reference the the imageFrame element, ready once the ImageViewer is loaded */\n  private imageFrame: ImageFrame | null;\n  /** A reference to the div element of the containing div */\n  private mainContainer: HTMLDivElement;\n\n  constructor(props: ImageViewerProps) {\n    super(props);\n    this.menuData = this.props.data;\n    if (props.sortMenu) {\n      this.menuData = this.sortMenuRows(this.menuData);\n    }\n    // Set the initial state\n    this.state = {\n      activeRow: 0,\n      selection: this.getDefaultSelection(this.menuData).slice(1),\n      viewTransform: { default: 0.0 },\n      exposure: { default: 1.0 },\n      helpIsOpen: false,\n      defaultTransformation: Matrix4x4.create(),\n      transformationNeedsUpdate: true,\n      hasFocus: false,\n      isPlaying: false,\n      playbackPosition: 0,\n      framerateIndex: 6,\n    };\n    // Make sure 'this' is available in the keyboard handler when assigned to the keyup event\n    this.keyboardHandler = this.keyboardHandler.bind(this);\n    this.setFocus = this.setFocus.bind(this);\n    this.unsetFocus = this.unsetFocus.bind(this);\n  }\n\n  componentDidMount() {\n    this.mainContainer.setAttribute('tabindex', '1');\n    this.mainContainer.addEventListener('keydown', this.keyboardHandler);\n    this.mainContainer.addEventListener('focus', this.setFocus);\n    this.mainContainer.addEventListener('focusout', this.unsetFocus);\n  }\n\n  componentDidUpdate() {\n    if (this.imageFrame && this.state.transformationNeedsUpdate) {\n      this.imageFrame.setTransformation(this.state.defaultTransformation);\n      this.setState({ transformationNeedsUpdate: false });\n    }\n  }\n\n  componentWillReceiveProps(nextProps: ImageViewerProps) {\n    this.menuData = nextProps.data;\n    if (this.props.sortMenu) {\n      this.menuData = this.sortMenuRows(this.menuData);\n    }\n    this.validateSelection(this.state.selection, this.state.activeRow);\n  }\n\n  componentWillUnmount() {\n    this.mainContainer.removeEventListener('keydown', this.keyboardHandler);\n  }\n\n  setTransformation(transformation: Matrix4x4) {\n    if (this.imageFrame != null) {\n      this.imageFrame.setTransformation(transformation);\n    }\n    this.setState({ defaultTransformation: transformation });\n  }\n\n  render() {\n    const rows = this.activeRows(this.menuData, this.state.selection);\n    const imageSpec = this.imageSpec();\n    return (\n      <MainDiv ref={(div: HTMLDivElement) => this.mainContainer = div} className=\"jeri-main\">\n        <div>\n          {rows.map((row, i) => (\n            <NavRow\n              key={row.title}\n              row={row}\n              selection={this.state.selection[i]}\n              handleClick={this.navigateTo.bind(this, rows, i)}\n              removeCommonPrefix={this.props.removeCommonPrefix ? this.props.removeCommonPrefix : false}\n              active={this.state.activeRow === i}\n            />\n          ))}\n        </div>\n        <ImageArea className=\"jeri-image-area\">\n          <ImageFrameWithLoading\n            viewTransform={this.state.viewTransform[imageSpec.tonemapGroup]}\n            clearColor={this.props.clearColor ? this.props.clearColor : [0, 0, 0]}\n            exposure={this.state.exposure[imageSpec.tonemapGroup] || 1.0}\n            gamma={1.0}\n            offset={0.0}\n            imageSpec={imageSpec}\n            ref={(frame) => this.imageFrame = (frame != null) ? frame.imageFrame : null}\n            allowMovement={true}\n            enableMouseEvents={this.state.hasFocus}\n          />\n          {this.state.helpIsOpen ? <HelpScreen /> : null}\n        </ImageArea>\n      </MainDiv>\n    );\n  }\n\n  /**\n   * Select the active rows from the navigation data tree, according to the given selection\n   *\n   * @param tree navigation datastructure\n   * @param selection array of the titles of selected items from top to bottom\n   */\n  private activeRows(tree: InputTree, selection: string[]): InputNode[] {\n    if (selection.length === 0) {\n      // Base case of the recursion\n      return [];\n    } else {\n      // Find the child with this name\n      if (!tree.hasOwnProperty('children')) {\n        throw new Error(`Can't find match for ${selection}`);\n      }\n      const node = (tree as InputNode);\n      const res = node.children.find(child => child.title === selection[0]);\n      if (res == null) {\n        throw new Error(`Failed to find a match for ${selection}`);\n      } else {\n        return [node].concat(this.activeRows(res, selection.slice(1)));\n      }\n    }\n  }\n\n  /**\n   * Recursively sort the input data\n   *\n   * It's a bit smart, for example bathroom-32 will come before bathroom-128,\n   * and the word Color always goes first.\n   * @param tree to be sored\n   */\n  private sortMenuRows(tree: InputTree): InputTree {\n    if (tree.hasOwnProperty('children')) {\n      const node = tree as InputNode;\n      const children = node.children.map(child => this.sortMenuRows(child));\n      children.sort((a, b) => {\n        if (a.title === b.title) {\n          return 0;\n        } else if (a.title === 'Color') {\n          return -1;\n        } else if (b.title === 'Color') {\n          return 1;\n        } else {\n          return numberAwareCompare(a.title, b.title);\n        }\n      });\n      return {\n        title: node.title,\n        children: children,\n      };\n    } else {\n      return tree;\n    }\n  }\n\n  /**\n   * Find the image to be shown based on the current selection\n   */\n  private currentImage(currentSelection: string[] = this.state.selection): InputLeaf {\n    let selection = [...currentSelection];\n    let tree: InputNode = this.menuData as InputNode;\n    while (selection.length > 0) {\n      let entry = selection.shift();\n      tree = tree.children.find(item => item.title === entry) as InputNode;\n    }\n    return tree as any; // tslint:disable-line\n  }\n\n  /**\n   * Return a string from an array of strings at a given position.\n   * If the first argument is a string (not an array), then it will return the string.\n   */\n  private getStringAtPos(input: string | string[], position: number): string {\n    if (Array.isArray(input)) {\n      return this.props.baseUrl + input[position % input.length];\n    } else {\n      return this.props.baseUrl + input;\n    }\n  }\n\n  /**\n   * Specification for the current image to load\n   */\n  private imageSpec(currentSelection: string[] = this.state.selection): ImageSpec {\n    const img = this.currentImage(currentSelection);\n    if (img.hasOwnProperty('lossMap')) {\n      const config = img as InputLeafLossMap;\n      return {\n        type: 'Difference',\n        lossFunction: lossFunctionFromString(config.lossMap.function),\n        urlA: this.getStringAtPos(config.lossMap.imageA, this.state.playbackPosition),\n        urlB: this.getStringAtPos(config.lossMap.imageB, this.state.playbackPosition),\n        tonemapGroup: (config as any).tonemapGroup || 'default', // tslint:disable-line\n      };\n    } else {\n      return {\n        type: 'Url',\n        url: this.getStringAtPos((img as InputLeafImage).image, this.state.playbackPosition),\n        tonemapGroup: (img as any).tonemapGroup || 'default', // tslint:disable-line\n      };\n    }\n  }\n\n  /**\n   * Navigate to a particular image\n   *\n   * @param rows: a list of the rows currently visible\n   * @param rowIndex: the index of the row in which to switch tabs\n   * @param title: the title of the requested node\n   *\n   * For rows > rowIndex, we select children matching the current selection titles\n   * if they exist. Otherwise, we resort to the default selection (first elements).\n   */\n  private navigateTo(rows: InputNode[], rowIndex: number, title: string) {\n    let selection = [...this.state.selection];\n    selection[rowIndex] = title;\n    let activeRow = this.state.activeRow;\n    if (SHIFT_IS_DOWN) {\n      // Set active row on shift click\n      activeRow = rowIndex;\n    }\n    this.validateSelection(selection, activeRow);\n  }\n\n  /**\n   * Make sure that the current selection is valid given the current menuData\n   *\n   * If a title in the selection does not exist in the respective row, take the default\n   * (first) element of the row.\n   * @param wishes the desired selection, which might not be valid given the selected menu items\n   */\n  private validateSelection(wishes: string[], activeRow: number) {\n    let selection = [];\n    let i = 0;\n    let root = this.menuData as InputNode;\n    while (root.hasOwnProperty('children')) {\n      let candidate = root.children.find(row => row.title === wishes[i]);\n      if (candidate) {\n        root = candidate as InputNode;\n        selection.push(candidate.title);\n      } else {\n        root = root.children[0] as InputNode; // resort to the first\n        selection.push(root.title);\n      }\n      i++;\n    }\n    this.setState({\n      selection: selection,\n      activeRow: Math.min(activeRow, selection.length - 1),\n    });\n  }\n\n  /**\n   * Return the titles of the first items of a sorted tree\n   * @param tree a sorted navigation data structure\n   */\n  private getDefaultSelection(tree: InputTree): string[] {\n    if (tree.hasOwnProperty('children')) {\n      const node = tree as InputNode;\n      if (node.children.length > 0) {\n        return [node.title].concat(this.getDefaultSelection(node.children[0]));\n      } else {\n        return [node.title];\n      }\n    } else {\n      return [tree.title];\n    }\n  }\n\n  private dumpTransformation(): void {\n    if (this.imageFrame != null) {\n      const transformation = this.imageFrame.getTransformation();\n      console.log(transformation.data);\n    }\n  }\n\n  private advanceAnimationFrame(currentPos: number): void {\n    if (this.state.isPlaying) {\n      const pos = this.state.playbackPosition;\n      // This condition prevents multiple timers advancing the position\n      if (currentPos === pos) {\n        let delay = 1.0 / 30.0;\n        if (this.props.framerates) {\n          delay = 1.0 / this.props.framerates[this.state.framerateIndex] * 1000;\n        }\n        const advanceF = this.advanceAnimationFrame.bind(this);\n        setTimeout(advanceF, delay, pos + 1);\n        this.setState({ playbackPosition: pos + 1 });\n      }\n    }\n  }\n\n  private keyboardHandler(event: KeyboardEvent) {\n    const { key } = event;\n\n    const actions: { [x: string]: Function } = {};\n    const actionsUnderShift: { [x: string]: Function } = {};\n\n    // Number keys\n    const goToNumber = (i: number) => () => {\n      const rows = this.activeRows(this.menuData, this.state.selection);\n      const activeRow = this.state.activeRow;\n      const goTo = rows[activeRow].children[i];\n      if (goTo != null) {\n        this.navigateTo(rows, activeRow, goTo.title);\n      }\n    };\n    actions['0'] = goToNumber(9);\n    for (let i = 1; i <= 9; ++i) {\n      actions[i.toString()] = goToNumber(i - 1);\n    }\n\n    // Arrows\n    const moveInLine = (offset: number) => () => {\n      const rows = this.activeRows(this.menuData, this.state.selection);\n      const activeRow = this.state.activeRow;\n      const currentTitle = this.state.selection[activeRow];\n      const currentIndex = rows[activeRow].children.findIndex(n => n.title === currentTitle);\n      const nextIndex = (currentIndex + offset + rows[activeRow].children.length) % rows[activeRow].children.length;\n      const goTo = rows[activeRow].children[nextIndex];\n      this.navigateTo(rows, activeRow, goTo.title);\n    };\n    actionsUnderShift.ArrowLeft = moveInLine(-1);\n    actionsUnderShift.ArrowRight = moveInLine(1);\n    actions['-'] = moveInLine(-1);\n    actions['='] = moveInLine(1);\n    const moveUpDown = (offset: number) => () => {\n      let nextRow = this.state.activeRow + offset;\n      if (nextRow < 0) {\n        nextRow = 0;\n      }\n      if (nextRow >= this.state.selection.length - 1) {\n        nextRow = this.state.selection.length - 1;\n      }\n      this.setState({ activeRow: nextRow });\n    };\n    actionsUnderShift.ArrowUp = moveUpDown(-1);\n    actionsUnderShift.ArrowDown = moveUpDown(1);\n    actions['['] = moveUpDown(-1);\n    actions[']'] = moveUpDown(1);\n\n    // ViewTransform controls\n    const changeViewTransform = () => () => {\n      const tonemapGroup = this.imageSpec().tonemapGroup;\n      const viewTransform = {\n        ...this.state.viewTransform,\n        [tonemapGroup]: (Math.abs(this.state.viewTransform[tonemapGroup] - 1))\n      };\n      this.setState({ viewTransform });\n    };\n    actions.t = changeViewTransform();\n\n    // Exposure controls\n    const changeExposure = (multiplier: number) => () => {\n      const tonemapGroup = this.imageSpec().tonemapGroup;\n      const exposure = {\n        ...this.state.exposure,\n        [tonemapGroup]: multiplier * (this.state.exposure[tonemapGroup] || 1.0)\n      };\n      this.setState({ exposure });\n    };\n    actions.e = changeExposure(1.1);\n    actions.E = changeExposure(1.0 / 1.1);\n\n    // Reset\n    actions.r = () => {\n      this.setState({ viewTransform: { default: 0.0 } });\n      this.setState({ exposure: { default: 1.0 } });\n      if (this.imageFrame) {\n        this.imageFrame.reset();\n      }\n    };\n\n    // Toggle help\n    actions['/'] = actions['?'] = () => {\n      this.setState({ helpIsOpen: !this.state.helpIsOpen });\n    };\n    actions.Escape = () => {\n      this.setState({ helpIsOpen: false });\n    };\n\n    // Go fullscreen\n    actions.f = () => requestFullscreen(this.mainContainer);\n\n    // Dump the current transformation\n    actions.d = () => this.dumpTransformation();\n\n    actions[' '] = () => {\n      const isPlaying = !this.state.isPlaying;\n      this.setState({ isPlaying: isPlaying });\n      this.advanceAnimationFrame(this.state.playbackPosition);\n    };\n\n    actions['<'] = () => {\n      if (this.props.framerates) {\n        const newIndex = this.state.framerateIndex - 1 > 0 ?\n          this.state.framerateIndex - 1 : 0;\n        console.log('Framerate:', this.props.framerates[newIndex]);\n        this.setState({ framerateIndex: newIndex });\n      }\n    };\n\n    actions['>'] = () => {\n      if (this.props.framerates) {\n        const newIndex = this.state.framerateIndex + 1 < this.props.framerates.length ?\n          this.state.framerateIndex + 1 : this.state.framerateIndex;\n        console.log('Framerate:', this.props.framerates[newIndex]);\n        this.setState({ framerateIndex: newIndex });\n      }\n    };\n\n    actions[','] = () => {\n      this.setState({\n        isPlaying: false,\n        playbackPosition: this.state.playbackPosition - 1\n      });\n    };\n\n    actions['.'] = () => {\n      this.setState({\n        isPlaying: false,\n        playbackPosition: this.state.playbackPosition + 1\n      });\n    };\n\n    if (actions.hasOwnProperty(key) && !event.metaKey && !event.altKey && !event.ctrlKey) {\n      event.preventDefault();\n      actions[key]();\n      return;\n    }\n    if (actionsUnderShift.hasOwnProperty(key) && event.shiftKey) {\n      event.preventDefault();\n      actionsUnderShift[key]();\n      return;\n    }\n  }\n\n  private setFocus() {\n    this.setState({ hasFocus: true });\n  }\n\n  private unsetFocus() {\n    this.setState({ hasFocus: false });\n  }\n}\n","const splitPartsPattern = /\\d+|\\D+/g;\n\nexport default function numberAwareCompare(a: string, b: string): number {\n    const aComponents = a.match(splitPartsPattern) || [];\n    const bComponents = b.match(splitPartsPattern) || [];\n\n    while (aComponents.length > 0 && bComponents.length > 0) {\n        const currentA = aComponents.shift() as string;\n        const currentB = bComponents.shift() as string;\n        const aAsInteger = parseInt(currentA, 10);\n        const bAsInteger = parseInt(currentB, 10);\n\n        if (!isNaN(aAsInteger) && !isNaN(bAsInteger)) {\n            // Compare integers\n            if (aAsInteger < bAsInteger) {\n                return -1;\n            } else if (aAsInteger > bAsInteger) {\n                return 1;\n            }\n        } else if (isNaN(aAsInteger) && isNaN(bAsInteger)) {\n            // Compare non-integer strings\n            if (currentA < currentB) {\n                return -1;\n            } else if (currentA > currentB) {\n                return 1;\n            }\n        } else {\n            // If one block is an integer and the other a string,\n            // the number is smaller\n            if (isNaN(bAsInteger)) {\n                return -1;\n            } else {\n                return 1;\n            }\n        }\n    }\n\n    if (aComponents.length === 0 && bComponents.length === 0) {\n        return 0;\n    } else if (aComponents.length === 0) {\n        return -1;\n    } else {\n        return 1;\n    }\n}\n\n// console.log(numberAwareCompare(\"bathroom10\", \"bathroom2\"), 1)\n// console.log(numberAwareCompare(\"bathroom2\", \"bathroom10\"), -1)\n// console.log(numberAwareCompare(\"2bathroom\", \"10bathroom\"), -1)\n// console.log(numberAwareCompare(\"10bathroom\", \"2bathroom\"), 1)\n// console.log(numberAwareCompare(\"1bathroom\", \"bathroom1\"), -1)\n// console.log(numberAwareCompare(\"bathroom1\", \"1bathroom\"), 1)\n// console.log(numberAwareCompare(\"bla\", \"bla\"), 0)\n// console.log(numberAwareCompare(\"bla1\", \"bla1\"), 0)\n// console.log(numberAwareCompare(\"bla1a4\", \"bla1a4\"), 0)\n// console.log(numberAwareCompare(\"\", \"\"), 0)\n// console.log(numberAwareCompare(\"a\", \"\"), 1)\n// console.log(numberAwareCompare(\"\", \"a\"), -1)\n// console.log(numberAwareCompare(\"2017.07.14\", \"2017.07.13\"), 1)\n// console.log(numberAwareCompare(\"bathroom-1\", \"bathroom1\"), 1)\n","export default function requestFullscreen(element: any) { //tslint:disable-line\n    if (element.requestFullscreen) {\n        element.requestFullscreen();\n    } else if (element.mozRequestFullScreen) {\n        element.mozRequestFullScreen();\n    } else if (element.webkitRequestFullScreen) {\n        element.webkitRequestFullScreen((Element as any).ALLOW_KEYBOARD_INPUT); //tslint:disable-line\n    }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\n\nconst HelpScreenDiv = styled.div`\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  padding: 2em 0;\n  background-color: rgba(0, 0, 0, 0.8);\n  line-height: 1.4em;\n  color: white;\n  table {\n    width: 40em;\n    margin: 0 auto;\n  }\n  h1 {\n    font-size: 1em;\n    margin: 0;\n    padding: 0;\n    line-height: 2em;\n    text-align: center;\n    padding-bottom: .5em;\n  }\n  th, td {\n    text-align: left;\n    padding: .4em 1em;\n    vertical-align: top;\n  }\n  th {\n    width: 10em;\n  }\n`;\n\nexport default () => {\n  return (\n    <HelpScreenDiv className=\"jeri-help\">\n      <h1>Shortcuts</h1>\n      <table>\n        <tbody>\n          <tr>\n            <th>0-9</th>\n            <td>Switch images</td>\n          </tr>\n          <tr>\n            <th>Shift + 0-9</th>\n            <td>Switch comparison (to for example reference or input)</td>\n          </tr>\n          <tr>\n            <th>Shift + Arrows</th>\n            <td>Navigate through the menu</td>\n          </tr>\n          <tr>\n            <th>Shift + click</th>\n            <td>Open a tab, and activate keyboard shortcuts for the row clicked</td>\n          </tr>\n          <tr>\n            <th>e / E</th>\n            <td>Increase / decrease <strong>e</strong>xposure</td>\n          </tr>\n          <tr>\n            <th>r</th>\n            <td>Reset exposure, view transform, positioning and zooming</td>\n          </tr>\n          <tr>\n            <th>t</th>\n            <td>Toggle between the Gamma 2.2 and the Pseudo ARRI K1S1 view transforms</td>\n          </tr>\n          <tr>\n            <th>f</th>\n            <td>Enter <strong>f</strong>ullscreen mode</td>\n          </tr>\n          <tr>\n            <th>?</th>\n            <td>Toggle this help screen</td>\n          </tr>\n          <tr>\n            <th>space</th>\n            <td>Toggle animation playback</td>\n          </tr>\n          <tr>\n            <th>, / .</th>\n            <td>Jump to previous/next animation frame</td>\n          </tr>\n        </tbody>\n      </table>\n    </HelpScreenDiv>\n  );\n};\n","import * as React from 'react';\nimport { Matrix4x4 } from '../utils/linalg';\nimport styled from 'styled-components';\n\nimport ImageFrame from './ImageFrame';\nimport { LossFunction, Input as ImageInput } from '../layers/Layer';\nimport { ImageCache } from '../utils/image-loading';\n\nconst StretchingDiv = styled.div`\n  position: absolute;\n  top: 0; bottom: 0;\n  left: 0; right: 0;\n  width: 100%; height: 100%;\n`;\n\nconst LoadingOverlay = styled.div`\n  display: block;\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  text-align: left;\n  padding: .6em;\n  background-color: rgb(64, 64, 64);\n`;\n\nexport interface ImageSpecUrl {\n  type: 'Url';\n  url: string;\n  tonemapGroup: string;\n}\n\nexport interface ImageSpecLossMap {\n  type: 'Difference';\n  lossFunction: LossFunction;\n  urlA: string;\n  urlB: string;\n  tonemapGroup: string;\n}\n\nexport type ImageSpec = ImageSpecUrl | ImageSpecLossMap;\n\nexport interface ImageFrameWithLoadingProps {\n  imageSpec: ImageSpec;\n  viewTransform: number;\n  clearColor: number[];\n  exposure: number;\n  gamma: number;\n  offset: number;\n  allowMovement: boolean;\n  /** Optional callback to be called when the mouse moves */\n  onPoint?: (x: number, y: number) => void;\n  /** Optional callback to be called when the canvas is panned or zoomed */\n  onTransform?: (transformation: Matrix4x4) => void;\n  enableMouseEvents: boolean;\n}\n\nexport interface ImageFrameWithLoadingState {\n  isLoading: boolean;\n  errorMsg: string | null;\n  image: ImageInput | null;\n}\n\n/**\n * A wrapper around ImageFrame that deals with the loading of images\n * It takes an `ImageSpec` instead of an `InputImage`.\n */\nexport default class ImageFrameWithLoading extends\n  React.Component<ImageFrameWithLoadingProps, ImageFrameWithLoadingState> {\n\n  public imageFrame: ImageFrame | null;\n\n  private cache: ImageCache = new ImageCache();\n  private requestId: number = 0;\n\n  // Counter to ensure that returning downloads are still relevant to the current app state.\n  private currentRequest: number = 0;\n\n  constructor(props: ImageFrameWithLoadingProps) {\n    super(props);\n    this.state = {\n      isLoading: false,\n      errorMsg: null,\n      image: null,\n    };\n    this.handleImageChange(props, false);\n  }\n\n  componentWillReceiveProps(nextProps: ImageFrameWithLoadingProps) {\n    if (nextProps.imageSpec !== this.props.imageSpec) { // Assumes imageSpec to be immutable\n      this.handleImageChange(nextProps);\n    }\n  }\n\n  componentWillUnmount() {\n    // Don't handle any returning downloads anymore after unmount.\n    this.requestId = -1;\n  }\n\n  render() {\n    return (\n      <StretchingDiv>\n      {this.state.image != null ?\n        <ImageFrame\n          viewTransform={this.props.viewTransform}\n          clearColor={this.props.clearColor}\n          exposure={this.props.exposure}\n          gamma={this.props.gamma}\n          offset={this.props.offset}\n          image={this.state.image}\n          ref={(frame) => this.imageFrame = frame}\n          allowMovement={this.props.allowMovement}\n          enableMouseEvents={this.props.enableMouseEvents}\n        />\n        : null}\n        {this.state.isLoading ? <LoadingOverlay className=\"jeri-overlay\">Downloading ...</LoadingOverlay> : null}\n        {this.state.errorMsg ? <LoadingOverlay className=\"jeri-overlay\">{this.state.errorMsg}</LoadingOverlay> : null}\n      </StretchingDiv>\n    );\n  }\n\n  /**\n   * Initiate the download of the current spec.\n   * Sets the state in case of correct or incorrect loads.\n   */\n  private handleImageChange(props: ImageFrameWithLoadingProps, shouldSetLoadingState: boolean = true) {\n    this.currentRequest++;\n    const handledRequest = this.currentRequest;\n\n    if (shouldSetLoadingState) {\n      this.setState({\n        isLoading: true,\n        errorMsg: null,\n      });\n    }\n\n    this.downloadImage(props.imageSpec)\n      .then(image => {\n        if (handledRequest !== this.currentRequest) {\n          // This download does not correspond to the latest request, so should not be shown.\n          return;\n        }\n        this.setState({\n          errorMsg: null,\n          isLoading: false,\n          image: image,\n        });\n      })\n      .catch(error => {\n        if (handledRequest !== this.requestId) {\n          // This download does not correspond to the latest request, so should not be shown.\n          return;\n        }\n        this.setState({\n          errorMsg: error.message,\n          isLoading: false,\n        });\n      });\n  }\n\n  /**\n   * Download an image\n   * @param image specification of the image to download (url or difference of two images)\n   * @return Promise of a loaded image\n   */\n  private downloadImage(spec: ImageSpec): Promise<ImageInput> {\n    if (spec.type === 'Url') {\n      return this.cache.get(spec.url);\n    } else if (spec.type === 'Difference') {\n      return Promise.all([spec.urlA, spec.urlB].map(url => this.cache.get(url)))\n        .then(([imageA, imageB]) => {\n          // Make sure images have the same size and number of channels;\n          const height = imageA.height;\n          const width = imageA.width;\n          const nChannels = imageA.nChannels;\n          if (height !== imageB.height) {\n            throw Error(`${spec.urlA} & ${spec.urlB} with heights ${height} & ${imageB.height} cannot be compared.`);\n          }\n          if (width !== imageB.width) {\n            throw Error(`${spec.urlA} & ${spec.urlB} with widths ${width} & ${imageB.width} cannot be compared.`);\n          }\n          if (nChannels !== imageB.nChannels) {\n            throw Error(`${spec.urlA} & ${spec.urlB} with unequal nChannels ${nChannels} & ${imageB.nChannels}.`);\n          }\n          return {\n            type: spec.type,\n            imageA,\n            imageB,\n            width,\n            height,\n            nChannels,\n            lossFunction: spec.lossFunction,\n          };\n        });\n    } else {\n      throw Error(`Unkonwn imageSpec type for ${spec}.`);\n    }\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { InputNode } from './index';\n\nconst commonPrefix = require('common-prefix');\n\n/** Helper to reverse string */\nconst reverse = (x: string) => x.split('').reverse().join('');\n\n// tslint:disable\nconst NavLink = styled.a`\n  cursor: pointer;\n  display: inline-block;\n  margin: 0;\n  flex-grow: 0;\n  flex-shrink: ${(props: any) => props.active ? '0' : '1'};\n  padding: .4em .7em;\n  overflow: hidden;\n  text-decoration: none;\n  white-space: nowrap;\n  position: relative;\n  background-color: ${(props: any) => props.active ? '#7DC6C6' : 'inherit'};\n  color: ${(props: any) => props.active ? '#FFFFFF !important' : '#AAA !important'};\n  &:active {\n    background-color: ${(props: any) => props.active ? '#6DB6B6' : '#222'};\n  }\n  &:hover {\n    flex-shrink: 0;\n  }\n  user-select: none;\n  -moz-user-select: none;\n` as any;\n// tslint:enable\n\nconst NavRowDiv = styled.div`\n  display: block;\n  padding: 0;\n  border-bottom: 1px solid #333;\n  background: #333;\n  color: #ccc;\n  display: flex;\n  &:first-child {\n    border-top: 1px solid #333;\n  }\n  &:hover ${NavLink} {\n    flex-shrink: 1;\n  }\n  &:hover ${NavLink}:hover {\n    flex-shrink: 0;\n  }\n`;\n\nconst NavLinkNumber = styled.span`\n  color: white;\n  font-size: .6em;\n  position: absolute;\n  top: .3em;\n  right: .4em;\n`;\n\nexport interface NavRowProps {\n  row: InputNode;\n  active: boolean;       // Is this row currently active for mouse events\n  selection: string;     // Title of the selected button\n  handleClick: Function;\n  removeCommonPrefix: boolean;\n}\n\nexport const NavRow = ({ row, active, selection, handleClick, removeCommonPrefix }: NavRowProps) => {\n  const titlesInRow = row.children.map(child => child.title);\n\n  // Trim common prefices and suffices from the row's entries\n  let trimmedTitles: string[];\n  if (removeCommonPrefix) {\n    const prefix: string = commonPrefix(titlesInRow);\n    const suffix: string = reverse(commonPrefix(titlesInRow.map(reverse)));\n    trimmedTitles = titlesInRow.map(t => t.slice(prefix.lastIndexOf('/') + 1, t.length - suffix.length));\n  } else {\n    trimmedTitles = titlesInRow;\n  }\n\n  return (\n    <NavRowDiv className=\"jeri-nav-row\">\n      {row.children.map((child, i) => (\n        <NavLink\n          onClick={() => handleClick(child.title)}\n          key={child.title}\n          active={child.title === selection}\n          className={child.title === selection ? 'jeri-nav-link selected' : 'jeri-nav-link'}\n        >\n          {i === 0 ? titlesInRow[i] : trimmedTitles[i]}\n          {active && i < 10 ? <NavLinkNumber className=\"jeri-nav-link-number\">{(i + 1) % 10}</NavLinkNumber> : null}\n        </NavLink>\n      ))}\n    </NavRowDiv>\n  );\n};\n","module.exports = common\n\nfunction common (strings) {\n  if (!Array.isArray(strings)) {\n    throw new Error('common-prefix expects an array of strings')\n  }\n\n  var first = strings[0] || ''\n  var commonLength = first.length\n\n  for (var i = 1; i < strings.length; ++i) {\n    for (var j = 0; j < commonLength; ++j) {\n      if (strings[i].charAt(j) !== first.charAt(j)) {\n        commonLength = j\n        break\n      }\n    }\n  }\n\n  return first.slice(0, commonLength)\n}\n"],"sourceRoot":""}